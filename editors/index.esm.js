import{useEditor as t}from"@tiptap/react";export*from"@tiptap/react";import e from"@tiptap/extension-blockquote";import n from"@tiptap/extension-bold";import r from"@tiptap/extension-bullet-list";import o from"@tiptap/extension-code";import i from"@tiptap/extension-code-block";import s from"@tiptap/extension-document";import a from"@tiptap/extension-gapcursor";import l from"@tiptap/extension-hard-break";import u from"@tiptap/extension-heading";import c from"@tiptap/extension-history";import p from"@tiptap/extension-italic";import h from"@tiptap/extension-underline";import f from"@tiptap/extension-horizontal-rule";import d from"@tiptap/extension-list-item";import m from"@tiptap/extension-ordered-list";import g from"@tiptap/extension-paragraph";import w from"@tiptap/extension-placeholder";import v from"@tiptap/extension-strike";import y from"@tiptap/extension-text";import{Node as S,combineTransactionSteps as k,getChangedRanges as b,getMarksBetween as x,findChildrenInRange as M,getAttributes as O,Mark as T,mergeAttributes as N,markPasteRule as A}from"@tiptap/core";import{test as E,find as z,registerCustomProtocol as R,reset as J}from"linkifyjs";import C from"@tiptap/suggestion";var I=function(){return I=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},I.apply(this,arguments)};function L(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]])}return n}function $(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let o=t.child(r),i=e.child(r);if(o!=i){if(!o.sameMarkup(i))return n;if(o.isText&&o.text!=i.text){for(let t=0;o.text[t]==i.text[t];t++)n++;return n}if(o.content.size||i.content.size){let t=$(o.content,i.content,n+1);if(null!=t)return t}n+=o.nodeSize}else n+=o.nodeSize}}function F(t,e,n,r){for(let o=t.childCount,i=e.childCount;;){if(0==o||0==i)return o==i?null:{a:n,b:r};let s=t.child(--o),a=e.child(--i),l=s.nodeSize;if(s!=a){if(!s.sameMarkup(a))return{a:n,b:r};if(s.isText&&s.text!=a.text){let t=0,e=Math.min(s.text.length,a.text.length);for(;t<e&&s.text[s.text.length-t-1]==a.text[a.text.length-t-1];)t++,n--,r--;return{a:n,b:r}}if(s.content.size||a.content.size){let t=F(s.content,a.content,n-1,r-1);if(t)return t}n-=l,r-=l}else n-=l,r-=l}}class j{constructor(t,e){if(this.content=t,this.size=e||0,null==e)for(let e=0;e<t.length;e++)this.size+=t[e].nodeSize}nodesBetween(t,e,n,r=0,o){for(let i=0,s=0;s<e;i++){let a=this.content[i],l=s+a.nodeSize;if(l>t&&!1!==n(a,r+s,o||null,i)&&a.content.size){let o=s+1;a.nodesBetween(Math.max(0,t-o),Math.min(a.content.size,e-o),n,r+o)}s=l}}descendants(t){this.nodesBetween(0,this.size,t)}textBetween(t,e,n,r){let o="",i=!0;return this.nodesBetween(t,e,((s,a)=>{s.isText?(o+=s.text.slice(Math.max(t,a)-a,e-a),i=!n):s.isLeaf?(r?o+="function"==typeof r?r(s):r:s.type.spec.leafText&&(o+=s.type.spec.leafText(s)),i=!n):!i&&s.isBlock&&(o+=n,i=!0)}),0),o}append(t){if(!t.size)return this;if(!this.size)return t;let e=this.lastChild,n=t.firstChild,r=this.content.slice(),o=0;for(e.isText&&e.sameMarkup(n)&&(r[r.length-1]=e.withText(e.text+n.text),o=1);o<t.content.length;o++)r.push(t.content[o]);return new j(r,this.size+t.size)}cut(t,e=this.size){if(0==t&&e==this.size)return this;let n=[],r=0;if(e>t)for(let o=0,i=0;i<e;o++){let s=this.content[o],a=i+s.nodeSize;a>t&&((i<t||a>e)&&(s=s.isText?s.cut(Math.max(0,t-i),Math.min(s.text.length,e-i)):s.cut(Math.max(0,t-i-1),Math.min(s.content.size,e-i-1))),n.push(s),r+=s.nodeSize),i=a}return new j(n,r)}cutByIndex(t,e){return t==e?j.empty:0==t&&e==this.content.length?this:new j(this.content.slice(t,e))}replaceChild(t,e){let n=this.content[t];if(n==e)return this;let r=this.content.slice(),o=this.size+e.nodeSize-n.nodeSize;return r[t]=e,new j(r,o)}addToStart(t){return new j([t].concat(this.content),this.size+t.nodeSize)}addToEnd(t){return new j(this.content.concat(t),this.size+t.nodeSize)}eq(t){if(this.content.length!=t.content.length)return!1;for(let e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(t){let e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e}maybeChild(t){return this.content[t]||null}forEach(t){for(let e=0,n=0;e<this.content.length;e++){let r=this.content[e];t(r,n,e),n+=r.nodeSize}}findDiffStart(t,e=0){return $(this,t,e)}findDiffEnd(t,e=this.size,n=t.size){return F(this,t,e,n)}findIndex(t,e=-1){if(0==t)return P(0,t);if(t==this.size)return P(this.content.length,t);if(t>this.size||t<0)throw new RangeError(`Position ${t} outside of fragment (${this})`);for(let n=0,r=0;;n++){let o=r+this.child(n).nodeSize;if(o>=t)return o==t||e>0?P(n+1,o):P(n,r);r=o}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map((t=>t.toJSON())):null}static fromJSON(t,e){if(!e)return j.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new j(e.map(t.nodeFromJSON))}static fromArray(t){if(!t.length)return j.empty;let e,n=0;for(let r=0;r<t.length;r++){let o=t[r];n+=o.nodeSize,r&&o.isText&&t[r-1].sameMarkup(o)?(e||(e=t.slice(0,r)),e[e.length-1]=o.withText(e[e.length-1].text+o.text)):e&&e.push(o)}return new j(e||t,n)}static from(t){if(!t)return j.empty;if(t instanceof j)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new j([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}j.empty=new j([],0);const H={index:0,offset:0};function P(t,e){return H.index=t,H.offset=e,H}class B extends Error{}class D{constructor(t,e,n){this.content=t,this.openStart=e,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(t,e){let n=_(this.content,t+this.openStart,e);return n&&new D(n,this.openStart,this.openEnd)}removeBetween(t,e){return new D(q(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)}eq(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t}static fromJSON(t,e){if(!e)return D.empty;let n=e.openStart||0,r=e.openEnd||0;if("number"!=typeof n||"number"!=typeof r)throw new RangeError("Invalid input for Slice.fromJSON");return new D(j.fromJSON(t,e.content),n,r)}static maxOpen(t,e=!0){let n=0,r=0;for(let r=t.firstChild;r&&!r.isLeaf&&(e||!r.type.spec.isolating);r=r.firstChild)n++;for(let n=t.lastChild;n&&!n.isLeaf&&(e||!n.type.spec.isolating);n=n.lastChild)r++;return new D(t,n,r)}}function q(t,e,n){let{index:r,offset:o}=t.findIndex(e),i=t.maybeChild(r),{index:s,offset:a}=t.findIndex(n);if(o==e||i.isText){if(a!=n&&!t.child(s).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=s)throw new RangeError("Removing non-flat range");return t.replaceChild(r,i.copy(q(i.content,e-o-1,n-o-1)))}function _(t,e,n,r){let{index:o,offset:i}=t.findIndex(e),s=t.maybeChild(o);if(i==e||s.isText)return r&&!r.canReplace(o,o,n)?null:t.cut(0,e).append(n).append(t.cut(e));let a=_(s.content,e-i-1,n);return a&&t.replaceChild(o,s.copy(a))}D.empty=new D(j.empty,0,0);const W=65535,K=Math.pow(2,16);function U(t){return t&W}class G{constructor(t,e,n){this.pos=t,this.delInfo=e,this.recover=n}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}}class V{constructor(t,e=!1){if(this.ranges=t,this.inverted=e,!t.length&&V.empty)return V.empty}recover(t){let e=0,n=U(t);if(!this.inverted)for(let t=0;t<n;t++)e+=this.ranges[3*t+2]-this.ranges[3*t+1];return this.ranges[3*n]+e+function(t){return(t-(t&W))/K}(t)}mapResult(t,e=1){return this._map(t,e,!1)}map(t,e=1){return this._map(t,e,!0)}_map(t,e,n){let r=0,o=this.inverted?2:1,i=this.inverted?1:2;for(let s=0;s<this.ranges.length;s+=3){let a=this.ranges[s]-(this.inverted?r:0);if(a>t)break;let l=this.ranges[s+o],u=this.ranges[s+i],c=a+l;if(t<=c){let o=a+r+((l?t==a?-1:t==c?1:e:e)<0?0:u);if(n)return o;let i=t==(e<0?a:c)?null:s/3+(t-a)*K,p=t==a?2:t==c?1:4;return(e<0?t!=a:t!=c)&&(p|=8),new G(o,p,i)}r+=u-l}return n?t+r:new G(t+r,0,null)}touches(t,e){let n=0,r=U(e),o=this.inverted?2:1,i=this.inverted?1:2;for(let e=0;e<this.ranges.length;e+=3){let s=this.ranges[e]-(this.inverted?n:0);if(s>t)break;let a=this.ranges[e+o];if(t<=s+a&&e==3*r)return!0;n+=this.ranges[e+i]-a}return!1}forEach(t){let e=this.inverted?2:1,n=this.inverted?1:2;for(let r=0,o=0;r<this.ranges.length;r+=3){let i=this.ranges[r],s=i-(this.inverted?o:0),a=i+(this.inverted?0:o),l=this.ranges[r+e],u=this.ranges[r+n];t(s,s+l,a,a+u),o+=u-l}}invert(){return new V(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(t){return 0==t?V.empty:new V(t<0?[0,-t,0]:[0,0,t])}}V.empty=new V([]);const Q=Object.create(null);class X{getMap(){return V.empty}merge(t){return null}static fromJSON(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=Q[e.stepType];if(!n)throw new RangeError(`No step type ${e.stepType} defined`);return n.fromJSON(t,e)}static jsonID(t,e){if(t in Q)throw new RangeError("Duplicate use of step JSON ID "+t);return Q[t]=e,e.prototype.jsonID=t,e}}class Y{constructor(t,e){this.doc=t,this.failed=e}static ok(t){return new Y(t,null)}static fail(t){return new Y(null,t)}static fromReplace(t,e,n,r){try{return Y.ok(t.replace(e,n,r))}catch(t){if(t instanceof B)return Y.fail(t.message);throw t}}}function Z(t,e,n){let r=[];for(let o=0;o<t.childCount;o++){let i=t.child(o);i.content.size&&(i=i.copy(Z(i.content,e,i))),i.isInline&&(i=e(i,n,o)),r.push(i)}return j.fromArray(r)}class tt extends X{constructor(t,e,n){super(),this.from=t,this.to=e,this.mark=n}apply(t){let e=t.slice(this.from,this.to),n=t.resolve(this.from),r=n.node(n.sharedDepth(this.to)),o=new D(Z(e.content,((t,e)=>t.isAtom&&e.type.allowsMarkType(this.mark.type)?t.mark(this.mark.addToSet(t.marks)):t),r),e.openStart,e.openEnd);return Y.fromReplace(t,this.from,this.to,o)}invert(){return new et(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deleted&&n.deleted||e.pos>=n.pos?null:new tt(e.pos,n.pos,this.mark)}merge(t){return t instanceof tt&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new tt(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new tt(e.from,e.to,t.markFromJSON(e.mark))}}X.jsonID("addMark",tt);class et extends X{constructor(t,e,n){super(),this.from=t,this.to=e,this.mark=n}apply(t){let e=t.slice(this.from,this.to),n=new D(Z(e.content,(t=>t.mark(this.mark.removeFromSet(t.marks))),t),e.openStart,e.openEnd);return Y.fromReplace(t,this.from,this.to,n)}invert(){return new tt(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deleted&&n.deleted||e.pos>=n.pos?null:new et(e.pos,n.pos,this.mark)}merge(t){return t instanceof et&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new et(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new et(e.from,e.to,t.markFromJSON(e.mark))}}X.jsonID("removeMark",et);class nt extends X{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return Y.fail("No node at mark step's position");let n=e.type.create(e.attrs,null,this.mark.addToSet(e.marks));return Y.fromReplace(t,this.pos,this.pos+1,new D(j.from(n),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);if(e){let t=this.mark.addToSet(e.marks);if(t.length==e.marks.length){for(let n=0;n<e.marks.length;n++)if(!e.marks[n].isInSet(t))return new nt(this.pos,e.marks[n]);return new nt(this.pos,this.mark)}}return new rt(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new nt(e.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if("number"!=typeof e.pos)throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new nt(e.pos,t.markFromJSON(e.mark))}}X.jsonID("addNodeMark",nt);class rt extends X{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return Y.fail("No node at mark step's position");let n=e.type.create(e.attrs,null,this.mark.removeFromSet(e.marks));return Y.fromReplace(t,this.pos,this.pos+1,new D(j.from(n),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);return e&&this.mark.isInSet(e.marks)?new nt(this.pos,this.mark):this}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new rt(e.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if("number"!=typeof e.pos)throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new rt(e.pos,t.markFromJSON(e.mark))}}X.jsonID("removeNodeMark",rt);class ot extends X{constructor(t,e,n,r=!1){super(),this.from=t,this.to=e,this.slice=n,this.structure=r}apply(t){return this.structure&&st(t,this.from,this.to)?Y.fail("Structure replace would overwrite content"):Y.fromReplace(t,this.from,this.to,this.slice)}getMap(){return new V([this.from,this.to-this.from,this.slice.size])}invert(t){return new ot(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deletedAcross&&n.deletedAcross?null:new ot(e.pos,Math.max(e.pos,n.pos),this.slice)}merge(t){if(!(t instanceof ot)||t.structure||this.structure)return null;if(this.from+this.slice.size!=t.from||this.slice.openEnd||t.slice.openStart){if(t.to!=this.from||this.slice.openStart||t.slice.openEnd)return null;{let e=this.slice.size+t.slice.size==0?D.empty:new D(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new ot(t.from,this.to,e,this.structure)}}{let e=this.slice.size+t.slice.size==0?D.empty:new D(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new ot(this.from,this.to+(t.to-t.from),e,this.structure)}}toJSON(){let t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new ot(e.from,e.to,D.fromJSON(t,e.slice),!!e.structure)}}X.jsonID("replace",ot);class it extends X{constructor(t,e,n,r,o,i,s=!1){super(),this.from=t,this.to=e,this.gapFrom=n,this.gapTo=r,this.slice=o,this.insert=i,this.structure=s}apply(t){if(this.structure&&(st(t,this.from,this.gapFrom)||st(t,this.gapTo,this.to)))return Y.fail("Structure gap-replace would overwrite content");let e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return Y.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,e.content);return n?Y.fromReplace(t,this.from,this.to,n):Y.fail("Content does not fit in gap")}getMap(){return new V([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let e=this.gapTo-this.gapFrom;return new it(this.from,this.from+this.slice.size+e,this.from+this.insert,this.from+this.insert+e,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1),r=t.map(this.gapFrom,-1),o=t.map(this.gapTo,1);return e.deletedAcross&&n.deletedAcross||r<e.pos||o>n.pos?null:new it(e.pos,n.pos,r,o,this.slice,this.insert,this.structure)}toJSON(){let t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to||"number"!=typeof e.gapFrom||"number"!=typeof e.gapTo||"number"!=typeof e.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new it(e.from,e.to,e.gapFrom,e.gapTo,D.fromJSON(t,e.slice),e.insert,!!e.structure)}}function st(t,e,n){let r=t.resolve(e),o=n-e,i=r.depth;for(;o>0&&i>0&&r.indexAfter(i)==r.node(i).childCount;)i--,o--;if(o>0){let t=r.node(i).maybeChild(r.indexAfter(i));for(;o>0;){if(!t||t.isLeaf)return!0;t=t.firstChild,o--}}return!1}X.jsonID("replaceAround",it);class at extends X{constructor(t,e,n){super(),this.pos=t,this.attr=e,this.value=n}apply(t){let e=t.nodeAt(this.pos);if(!e)return Y.fail("No node at attribute step's position");let n=Object.create(null);for(let t in e.attrs)n[t]=e.attrs[t];n[this.attr]=this.value;let r=e.type.create(n,null,e.marks);return Y.fromReplace(t,this.pos,this.pos+1,new D(j.from(r),0,e.isLeaf?0:1))}getMap(){return V.empty}invert(t){return new at(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new at(e.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,e){if("number"!=typeof e.pos||"string"!=typeof e.attr)throw new RangeError("Invalid input for AttrStep.fromJSON");return new at(e.pos,e.attr,e.value)}}X.jsonID("attr",at);let lt=class extends Error{};lt=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n},(lt.prototype=Object.create(Error.prototype)).constructor=lt,lt.prototype.name="TransformError";const ut=Object.create(null);class ct{constructor(t,e,n){this.$anchor=t,this.$head=e,this.ranges=n||[new pt(t.min(e),t.max(e))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let t=this.ranges;for(let e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(t,e=D.empty){let n=e.content.lastChild,r=null;for(let t=0;t<e.openEnd;t++)r=n,n=n.lastChild;let o=t.steps.length,i=this.ranges;for(let s=0;s<i.length;s++){let{$from:a,$to:l}=i[s],u=t.mapping.slice(o);t.replaceRange(u.map(a.pos),u.map(l.pos),s?D.empty:e),0==s&&kt(t,o,(n?n.isInline:r&&r.isTextblock)?-1:1)}}replaceWith(t,e){let n=t.steps.length,r=this.ranges;for(let o=0;o<r.length;o++){let{$from:i,$to:s}=r[o],a=t.mapping.slice(n),l=a.map(i.pos),u=a.map(s.pos);o?t.deleteRange(l,u):(t.replaceRangeWith(l,u,e),kt(t,n,e.isInline?-1:1))}}static findFrom(t,e,n=!1){let r=t.parent.inlineContent?new dt(t):St(t.node(0),t.parent,t.pos,t.index(),e,n);if(r)return r;for(let r=t.depth-1;r>=0;r--){let o=e<0?St(t.node(0),t.node(r),t.before(r+1),t.index(r),e,n):St(t.node(0),t.node(r),t.after(r+1),t.index(r)+1,e,n);if(o)return o}return null}static near(t,e=1){return this.findFrom(t,e)||this.findFrom(t,-e)||new vt(t.node(0))}static atStart(t){return St(t,t,0,0,1)||new vt(t)}static atEnd(t){return St(t,t,t.content.size,t.childCount,-1)||new vt(t)}static fromJSON(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=ut[e.type];if(!n)throw new RangeError(`No selection type ${e.type} defined`);return n.fromJSON(t,e)}static jsonID(t,e){if(t in ut)throw new RangeError("Duplicate use of selection JSON ID "+t);return ut[t]=e,e.prototype.jsonID=t,e}getBookmark(){return dt.between(this.$anchor,this.$head).getBookmark()}}ct.prototype.visible=!0;class pt{constructor(t,e){this.$from=t,this.$to=e}}let ht=!1;function ft(t){ht||t.parent.inlineContent||(ht=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class dt extends ct{constructor(t,e=t){ft(t),ft(e),super(t,e)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(t,e){let n=t.resolve(e.map(this.head));if(!n.parent.inlineContent)return ct.near(n);let r=t.resolve(e.map(this.anchor));return new dt(r.parent.inlineContent?r:n,n)}replace(t,e=D.empty){if(super.replace(t,e),e==D.empty){let e=this.$from.marksAcross(this.$to);e&&t.ensureMarks(e)}}eq(t){return t instanceof dt&&t.anchor==this.anchor&&t.head==this.head}getBookmark(){return new mt(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(t,e){if("number"!=typeof e.anchor||"number"!=typeof e.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new dt(t.resolve(e.anchor),t.resolve(e.head))}static create(t,e,n=e){let r=t.resolve(e);return new this(r,n==e?r:t.resolve(n))}static between(t,e,n){let r=t.pos-e.pos;if(n&&!r||(n=r>=0?1:-1),!e.parent.inlineContent){let t=ct.findFrom(e,n,!0)||ct.findFrom(e,-n,!0);if(!t)return ct.near(e,n);e=t.$head}return t.parent.inlineContent||(0==r||(t=(ct.findFrom(t,-n,!0)||ct.findFrom(t,n,!0)).$anchor).pos<e.pos!=r<0)&&(t=e),new dt(t,e)}}ct.jsonID("text",dt);class mt{constructor(t,e){this.anchor=t,this.head=e}map(t){return new mt(t.map(this.anchor),t.map(this.head))}resolve(t){return dt.between(t.resolve(this.anchor),t.resolve(this.head))}}class gt extends ct{constructor(t){let e=t.nodeAfter,n=t.node(0).resolve(t.pos+e.nodeSize);super(t,n),this.node=e}map(t,e){let{deleted:n,pos:r}=e.mapResult(this.anchor),o=t.resolve(r);return n?ct.near(o):new gt(o)}content(){return new D(j.from(this.node),0,0)}eq(t){return t instanceof gt&&t.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new wt(this.anchor)}static fromJSON(t,e){if("number"!=typeof e.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new gt(t.resolve(e.anchor))}static create(t,e){return new gt(t.resolve(e))}static isSelectable(t){return!t.isText&&!1!==t.type.spec.selectable}}gt.prototype.visible=!1,ct.jsonID("node",gt);class wt{constructor(t){this.anchor=t}map(t){let{deleted:e,pos:n}=t.mapResult(this.anchor);return e?new mt(n,n):new wt(n)}resolve(t){let e=t.resolve(this.anchor),n=e.nodeAfter;return n&&gt.isSelectable(n)?new gt(e):ct.near(e)}}class vt extends ct{constructor(t){super(t.resolve(0),t.resolve(t.content.size))}replace(t,e=D.empty){if(e==D.empty){t.delete(0,t.doc.content.size);let e=ct.atStart(t.doc);e.eq(t.selection)||t.setSelection(e)}else super.replace(t,e)}toJSON(){return{type:"all"}}static fromJSON(t){return new vt(t)}map(t){return new vt(t)}eq(t){return t instanceof vt}getBookmark(){return yt}}ct.jsonID("all",vt);const yt={map(){return this},resolve:t=>new vt(t)};function St(t,e,n,r,o,i=!1){if(e.inlineContent)return dt.create(t,n);for(let s=r-(o>0?0:1);o>0?s<e.childCount:s>=0;s+=o){let r=e.child(s);if(r.isAtom){if(!i&&gt.isSelectable(r))return gt.create(t,n-(o<0?r.nodeSize:0))}else{let e=St(t,r,n+o,o<0?r.childCount:0,o,i);if(e)return e}n+=r.nodeSize*o}return null}function kt(t,e,n){let r=t.steps.length-1;if(r<e)return;let o,i=t.steps[r];(i instanceof ot||i instanceof it)&&(t.mapping.maps[r].forEach(((t,e,n,r)=>{null==o&&(o=r)})),t.setSelection(ct.near(t.doc.resolve(o),n)))}function bt(t,e){return e&&t?t.bind(e):t}class xt{constructor(t,e,n){this.name=t,this.init=bt(e.init,n),this.apply=bt(e.apply,n)}}function Mt(t,e,n){for(let r in t){let o=t[r];o instanceof Function?o=o.bind(e):"handleDOMEvents"==r&&(o=Mt(o,e,{})),n[r]=o}return n}new xt("doc",{init:t=>t.doc||t.schema.topNodeType.createAndFill(),apply:t=>t.doc}),new xt("selection",{init:(t,e)=>t.selection||ct.atStart(e.doc),apply:t=>t.selection}),new xt("storedMarks",{init:t=>t.storedMarks||null,apply:(t,e,n,r)=>r.selection.$cursor?t.storedMarks:null}),new xt("scrollToSelection",{init:()=>0,apply:(t,e)=>t.scrolledIntoView?e+1:e});class Ot{constructor(t){this.spec=t,this.props={},t.props&&Mt(t.props,this,this.props),this.key=t.key?t.key.key:Nt("plugin")}getState(t){return t[this.key]}}const Tt=Object.create(null);function Nt(t){return t in Tt?t+"$"+ ++Tt[t]:(Tt[t]=0,t+"$")}class At{constructor(t="key"){this.key=Nt(t)}get(t){return t.config.pluginsByKey[this.key]}getState(t){return t[this.key]}}var Et=S.create({name:"figureAudio",group:"block",content:"inline*",draggable:!0,isolating:!0,addAttributes:function(){return{src:{default:null,parseHTML:function(t){var e;return null===(e=t.querySelector("source"))||void 0===e?void 0:e.getAttribute("src")}},title:{default:"",parseHTML:function(t){var e;return null===(e=t.querySelector(".title"))||void 0===e?void 0:e.textContent}},duration:{default:"00:00",parseHTML:function(t){var e,n=t.querySelector(".duration");return null===(e=null==n?void 0:n.dataset)||void 0===e?void 0:e.time}}}},parseHTML:function(){return[{tag:'figure[class="audio"]',contentElement:"figcaption"}]},renderHTML:function(t){var e=t.HTMLAttributes;return["figure",{class:"audio"},["audio",{controls:!0},["source",{src:e.src,type:"audio/mp3",draggable:!1,contenteditable:!1}]],["div",{class:"player"},["header",["div",{class:"meta"},["h4",{class:"title"},e.title],["div",{class:"time"},["span",{class:"current","data-time":"00:00"}],["span",{class:"duration","data-time":e.duration}]]],["span",{class:"play"}]],["footer",["div",{class:"progress-bar"},["span",{}]]]],["figcaption",0]]},addCommands:function(){var t=this;return{setFigureAudio:function(e){var n=e.caption,r=L(e,["caption"]);return function(e){return(0,e.chain)().insertContent({type:t.name,attrs:r,content:n?[{type:"text",text:n}]:[]}).command((function(t){var e=t.tr,n=t.commands,r=e.doc,o=e.selection,i=r.resolve(o.to-2).end();return n.setTextSelection(i)})).run()}}}},addProseMirrorPlugins:function(){return[new Ot({key:new At("removePastedFigureAudio"),props:{transformPastedHTML:function(t){return t=t.replace(/<figure.*class=.audio.*[\n]*.*?<\/figure>/g,"")}}})]}}),zt=S.create({name:"figureEmbed",group:"block",content:"inline*",draggable:!0,isolating:!0,addAttributes:function(){return{class:{default:null,parseHTML:function(t){return t.getAttribute("class")}},src:{default:null,parseHTML:function(t){var e;return null===(e=t.querySelector("iframe"))||void 0===e?void 0:e.getAttribute("src")}}}},parseHTML:function(){return[{tag:'figure[class^="embed"]',contentElement:"figcaption"}]},renderHTML:function(t){var e=function(t){var e,n={url:"",allowfullscreen:!1,sandbox:[]};try{e=new URL(t)}catch(t){return n}var r=e.hostname,o=e.pathname,i=e.searchParams;if(["youtube.com","youtu.be","www.youtu.be","www.youtube.com"].includes(r)){var s=i.get("v"),a=i.get("t"),l=new URLSearchParams(I({rel:"0"},a?{start:a}:{})).toString(),u="";return s?u=s:o.match("/embed/")?u=o.split("/embed/")[1]:r.includes("youtu.be")&&(u=o.split("/")[1]),{url:"https://www.youtube.com/embed/".concat(u)+(l?"?=".concat(l):""),provider:"youtube",allowfullscreen:!0,sandbox:[]}}if(["vimeo.com","www.vimeo.com","player.vimeo.com"].includes(r))return u=o.replace(/\/$/,"").split("/").slice(-1)[0],{url:"https://player.vimeo.com/video/".concat(u),provider:"vimeo",allowfullscreen:!0,sandbox:[]};if(["bilibili.com","player.bilibili.com","www.bilibili.com"].includes(r)){return u="",u=i.get("bvid")||o.replace(/\/$/,"").split("/").slice(-1)[0],{url:"https://player.bilibili.com/player.html?bvid=".concat(u),provider:"bilibili",allowfullscreen:!0,sandbox:[]}}if(["instagram.com","www.instagram.com"].includes(r))return u=o.replace("/embed","").replace(/\/$/,"").split("/").slice(-1)[0],{url:"https://www.instagram.com/p/".concat(u,"/embed"),provider:"instagram",allowfullscreen:!1,sandbox:[]};if(["jsfiddle.net","www.jsfiddle.net"].includes(r)){var c=o.replace("/embedded","").replace(/\/$/,"").split("/").filter(Boolean);return u=1===c.length?c[0]:c[1],{url:"https://jsfiddle.net/".concat(u,"/embedded/"),provider:"jsfiddle",allowfullscreen:!1,sandbox:[]}}if(["codepen.io","www.codepen.io"].includes(r)){var p=o.split("/")[1];return u=o.replace(/\/$/,"").split("/").slice(-1)[0],{url:"https://codepen.io/".concat(p,"/embed/preview/").concat(u),provider:"codepen",allowfullscreen:!1,sandbox:[]}}return n}(t.HTMLAttributes.src),n=e.url,r=e.provider,o=e.allowfullscreen,i=e.sandbox;return["figure",I({class:"embed"},r?{"data-provider":r}:{}),["div",{class:"iframe-container"},["iframe",I(I(I({src:n,loading:"lazy"},i&&i.length>0?{sandbox:i.join(" ")}:{}),o?{allowfullscreen:!0}:{}),{frameborder:"0",draggable:!1,contenteditable:!1})]],["figcaption",0]]},addCommands:function(){var t=this;return{setFigureEmbed:function(e){var n=e.caption,r=L(e,["caption"]);return function(e){return(0,e.chain)().insertContent({type:t.name,attrs:r,content:n?[{type:"text",text:n}]:[]}).command((function(t){var e=t.tr,n=t.commands,r=e.doc,o=e.selection,i=r.resolve(o.to-2).end();return n.setTextSelection(i)})).run()}}}},addProseMirrorPlugins:function(){return[new Ot({key:new At("removePastedFigureEmbed"),props:{transformPastedHTML:function(t){return t=t.replace(/<figure.*class=.embed.*[\n]*.*?<\/figure>/g,"")}}})]}}),Rt=S.create({name:"figureImage",group:"block",content:"inline*",draggable:!0,isolating:!0,addAttributes:function(){return{class:{default:null,parseHTML:function(t){return t.getAttribute("class")}},src:{default:null,parseHTML:function(t){var e;return null===(e=t.querySelector("img"))||void 0===e?void 0:e.getAttribute("src")}}}},parseHTML:function(){return[{tag:'figure[class="image"]',contentElement:"figcaption"}]},renderHTML:function(t){return["figure",{class:"image"},["img",{src:t.HTMLAttributes.src,draggable:!1,contenteditable:!1}],["figcaption",0]]},addCommands:function(){var t=this;return{setFigureImage:function(e){var n=e.caption,r=L(e,["caption"]);return function(e){return(0,e.chain)().insertContent({type:t.name,attrs:r,content:n?[{type:"text",text:n}]:[]}).command((function(t){var e=t.tr,n=t.commands,r=e.doc,o=e.selection,i=r.resolve(o.to-2).end();return n.setTextSelection(i)})).run()}}}},addProseMirrorPlugins:function(){return[new Ot({key:new At("removePastedFigureImage"),props:{transformPastedHTML:function(t){return t=t.replace(/<figure.*class=.image.*[\n]*.*?<\/figure>/g,"")}}})]}});function Jt(t){return new Ot({key:new At("autolink"),appendTransaction:function(e,n,r){var o=e.some((function(t){return t.docChanged}))&&!n.doc.eq(r.doc),i=e.some((function(t){return t.getMeta("preventAutolink")}));if(o&&!i){var s=r.tr,a=k(n.doc,function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))}([],e,!0)),l=a.mapping;if(b(a).forEach((function(e){var o=e.oldRange,i=e.newRange;x(o.from,o.to,n.doc).filter((function(e){return e.mark.type===t.type})).forEach((function(e){var o=l.map(e.from),i=l.map(e.to),a=x(o,i,r.doc).filter((function(e){return e.mark.type===t.type}));if(a.length){var u=a[0],c=n.doc.textBetween(e.from,e.to,void 0," "),p=r.doc.textBetween(u.from,u.to,void 0," "),h=E(c),f=E(p);h&&!f&&s.removeMark(u.from,u.to,t.type)}}));var a,u,c=M(r.doc,i,(function(t){return t.isTextblock}));if(c.length>1?(a=c[0],u=r.doc.textBetween(a.pos,a.pos+a.node.nodeSize,void 0," ")):c.length&&r.doc.textBetween(i.from,i.to," "," ").endsWith(" ")&&(a=c[0],u=r.doc.textBetween(a.pos,i.to,void 0," ")),a&&u){var p=u.split(" ").filter((function(t){return""!==t}));if(p.length<=0)return!1;var h=p[p.length-1],f=a.pos+u.lastIndexOf(h);if(!h)return!1;z(h).filter((function(t){return t.isLink})).filter((function(e){return!t.validate||t.validate(e.value)})).map((function(t){return I(I({},t),{from:f+t.start+1,to:f+t.end+1})})).forEach((function(e){s.addMark(e.from,e.to,t.type.create({href:e.href}))}))}})),s.steps.length)return s}}})}var Ct=T.create({name:"link",keepOnSplit:!1,onCreate:function(){this.options.protocols.forEach((function(t){"string"!=typeof t?R(t.scheme,t.optionalSlashes):R(t)}))},onDestroy:function(){J()},inclusive:function(){return this.options.autolink},addOptions:function(){return{openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},validate:void 0}},addAttributes:function(){return{href:{default:null},target:{default:this.options.HTMLAttributes.target},class:{default:this.options.HTMLAttributes.class}}},parseHTML:function(){return[{tag:'a[href]:not([href *= "javascript:" i]):not([class="mention"])'}]},renderHTML:function(t){var e=t.HTMLAttributes;return["a",N(this.options.HTMLAttributes,e),0]},addCommands:function(){var t=this;return{setLink:function(e){return function(n){return(0,n.chain)().setMark(t.name,e).setMeta("preventAutolink",!0).run()}},toggleLink:function(e){return function(n){return(0,n.chain)().toggleMark(t.name,e,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},unsetLink:function(){return function(e){return(0,e.chain)().unsetMark(t.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}}}},addPasteRules:function(){var t=this;return[A({find:function(e){return z(e).filter((function(e){return!t.options.validate||t.options.validate(e.value)})).filter((function(t){return t.isLink})).map((function(t){return{text:t.value,index:t.start,data:t}}))},type:this.type,getAttributes:function(t){var e;return{href:null===(e=t.data)||void 0===e?void 0:e.href}}})]},addProseMirrorPlugins:function(){var t,e=[];return this.options.autolink&&e.push(Jt({type:this.type,validate:this.options.validate})),this.options.openOnClick&&e.push((t={type:this.type},new Ot({key:new At("handleClickLink"),props:{handleClick:function(e,n,r){var o,i,s;if(1!==r.button)return!1;var a=O(e.state,t.type.name),l=null===(o=r.target)||void 0===o?void 0:o.closest("a"),u=null!==(i=null==l?void 0:l.href)&&void 0!==i?i:a.href,c=null!==(s=null==l?void 0:l.target)&&void 0!==s?s:a.target;return!(!l||!u||(window.open(u,c),0))}}}))),this.options.linkOnPaste&&e.push(function(t){return new Ot({key:new At("handlePasteLink"),props:{handlePaste:function(e,n,r){if(e.state.selection.empty)return!1;var o="";r.content.forEach((function(t){o+=t.textContent}));var i=z(o).find((function(t){return t.isLink&&t.value===o}));return!(!o||!i||(t.editor.commands.setMark(t.type,{href:i.href}),0))}}})}({editor:this.editor,type:this.type})),e}}),It=new At("mention"),Lt=S.create({name:"mention",group:"inline",inline:!0,selectable:!1,atom:!0,addOptions:function(){var t=this;return{suggestion:{char:"@",allowedPrefixes:null,pluginKey:It,command:function(e){var n,r,o,i=e.editor,s=e.range,a=e.props,l=i.view.state.selection,u=l.$from,c=l.$to,p=1===u.parentOffset,h=c.nodeBefore,f=c.nodeAfter,d=null===(n=null==h?void 0:h.text)||void 0===n?void 0:n.startsWith(" "),m=null===(r=null==f?void 0:f.text)||void 0===r?void 0:r.startsWith(" "),g=[];p||d||g.push({type:"text",text:" "}),g.push({type:t.name,attrs:a}),m||g.push({type:"text",text:" "}),i.chain().focus().insertContentAt(s,g).run(),null===(o=window.getSelection())||void 0===o||o.collapseToEnd()},allow:function(e){var n=e.state,r=e.range,o=n.doc.resolve(r.from),i=n.schema.nodes[t.name];return!!o.parent.type.contentMatch.matchType(i)}}}},addAttributes:function(){return{id:{default:null,parseHTML:function(t){return t.getAttribute("data-id")}},userName:{default:null,parseHTML:function(t){return t.getAttribute("data-user-name")}},displayName:{default:null,parseHTML:function(t){return t.getAttribute("data-display-name")}}}},parseHTML:function(){return[{tag:'a[class="mention"]'}]},renderHTML:function(t){var e,n=t.node;return["a",{class:"mention",href:"/"+this.options.suggestion.char+n.attrs.userName,"data-id":n.attrs.id,"data-user-name":n.attrs.userName,"data-display-name":n.attrs.displayName,ref:"noopener noreferrer nofollow"},["span","@".concat(null!==(e=n.attrs.displayName)&&void 0!==e?e:n.attrs.userName)]]},addKeyboardShortcuts:function(){var t=this;return{Backspace:function(){return t.editor.commands.command((function(e){var n=e.tr,r=e.state,o=!1,i=r.selection,s=i.empty,a=i.anchor;return!!s&&(r.doc.nodesBetween(a-1,a,(function(e,r){if(e.type.name===t.name)return o=!0,n.insertText(t.options.suggestion.char||"",r,r+e.nodeSize),!1})),o)}))}}},addProseMirrorPlugins:function(){return[C(I({editor:this.editor},this.options.suggestion))]}}),$t=function(t){var S=t.placeholder,k=t.mentionSuggestion;return[s,c,a,w.configure({placeholder:S}),y,g,u.configure({levels:[2,3]}),n,v,h,p,o,i,e,l,f,m,d,r,Ct,Rt,Et,zt,Lt.configure({suggestion:k})]},Ft=function(e){var n=e.content,r=e.placeholder,o=e.mentionSuggestion,i=L(e,["content","placeholder","mentionSuggestion"]);return t(I({extensions:$t({placeholder:r,mentionSuggestion:o}),content:n},i))},jt=function(t){var a=t.placeholder,u=t.mentionSuggestion;return[s,c,w.configure({placeholder:a}),y,g,n,v,h,p,o,i,e,l,f,d,m,r,Ct,Lt.configure({suggestion:u})]},Ht=function(e){var n=e.content,r=e.placeholder,o=e.mentionSuggestion,i=L(e,["content","placeholder","mentionSuggestion"]);return t(I({extensions:jt({placeholder:r,mentionSuggestion:o}),content:n},i))};export{$t as makeArticleEditorExtensions,jt as makeCommentEditorExtensions,Ft as useArticleEdtor,Ht as useCommentEditor};
