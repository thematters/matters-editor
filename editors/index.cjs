"use strict";var t=require("@tiptap/react"),e=require("@tiptap/extension-blockquote"),r=require("@tiptap/extension-bold"),n=require("@tiptap/extension-bullet-list"),i=require("@tiptap/extension-code"),o=require("@tiptap/extension-code-block"),s=require("@tiptap/extension-document"),a=require("@tiptap/extension-gapcursor"),l=require("@tiptap/extension-hard-break"),u=require("@tiptap/extension-heading"),c=require("@tiptap/extension-history"),p=require("@tiptap/extension-italic"),h=require("@tiptap/extension-underline"),f=require("@tiptap/extension-horizontal-rule"),d=require("@tiptap/extension-list-item"),m=require("@tiptap/extension-ordered-list"),g=require("@tiptap/extension-paragraph"),w=require("@tiptap/extension-placeholder"),v=require("@tiptap/extension-strike"),y=require("@tiptap/extension-text"),S=require("@tiptap/core"),k=require("linkifyjs"),b=require("@tiptap/suggestion"),x=function(){return x=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},x.apply(this,arguments)};function M(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]])}return r}function O(t,e,r){for(let n=0;;n++){if(n==t.childCount||n==e.childCount)return t.childCount==e.childCount?null:r;let i=t.child(n),o=e.child(n);if(i!=o){if(!i.sameMarkup(o))return r;if(i.isText&&i.text!=o.text){for(let t=0;i.text[t]==o.text[t];t++)r++;return r}if(i.content.size||o.content.size){let t=O(i.content,o.content,r+1);if(null!=t)return t}r+=i.nodeSize}else r+=i.nodeSize}}function T(t,e,r,n){for(let i=t.childCount,o=e.childCount;;){if(0==i||0==o)return i==o?null:{a:r,b:n};let s=t.child(--i),a=e.child(--o),l=s.nodeSize;if(s!=a){if(!s.sameMarkup(a))return{a:r,b:n};if(s.isText&&s.text!=a.text){let t=0,e=Math.min(s.text.length,a.text.length);for(;t<e&&s.text[s.text.length-t-1]==a.text[a.text.length-t-1];)t++,r--,n--;return{a:r,b:n}}if(s.content.size||a.content.size){let t=T(s.content,a.content,r-1,n-1);if(t)return t}r-=l,n-=l}else r-=l,n-=l}}class N{constructor(t,e){if(this.content=t,this.size=e||0,null==e)for(let e=0;e<t.length;e++)this.size+=t[e].nodeSize}nodesBetween(t,e,r,n=0,i){for(let o=0,s=0;s<e;o++){let a=this.content[o],l=s+a.nodeSize;if(l>t&&!1!==r(a,n+s,i||null,o)&&a.content.size){let i=s+1;a.nodesBetween(Math.max(0,t-i),Math.min(a.content.size,e-i),r,n+i)}s=l}}descendants(t){this.nodesBetween(0,this.size,t)}textBetween(t,e,r,n){let i="",o=!0;return this.nodesBetween(t,e,((s,a)=>{s.isText?(i+=s.text.slice(Math.max(t,a)-a,e-a),o=!r):s.isLeaf?(n?i+="function"==typeof n?n(s):n:s.type.spec.leafText&&(i+=s.type.spec.leafText(s)),o=!r):!o&&s.isBlock&&(i+=r,o=!0)}),0),i}append(t){if(!t.size)return this;if(!this.size)return t;let e=this.lastChild,r=t.firstChild,n=this.content.slice(),i=0;for(e.isText&&e.sameMarkup(r)&&(n[n.length-1]=e.withText(e.text+r.text),i=1);i<t.content.length;i++)n.push(t.content[i]);return new N(n,this.size+t.size)}cut(t,e=this.size){if(0==t&&e==this.size)return this;let r=[],n=0;if(e>t)for(let i=0,o=0;o<e;i++){let s=this.content[i],a=o+s.nodeSize;a>t&&((o<t||a>e)&&(s=s.isText?s.cut(Math.max(0,t-o),Math.min(s.text.length,e-o)):s.cut(Math.max(0,t-o-1),Math.min(s.content.size,e-o-1))),r.push(s),n+=s.nodeSize),o=a}return new N(r,n)}cutByIndex(t,e){return t==e?N.empty:0==t&&e==this.content.length?this:new N(this.content.slice(t,e))}replaceChild(t,e){let r=this.content[t];if(r==e)return this;let n=this.content.slice(),i=this.size+e.nodeSize-r.nodeSize;return n[t]=e,new N(n,i)}addToStart(t){return new N([t].concat(this.content),this.size+t.nodeSize)}addToEnd(t){return new N(this.content.concat(t),this.size+t.nodeSize)}eq(t){if(this.content.length!=t.content.length)return!1;for(let e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(t){let e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e}maybeChild(t){return this.content[t]||null}forEach(t){for(let e=0,r=0;e<this.content.length;e++){let n=this.content[e];t(n,r,e),r+=n.nodeSize}}findDiffStart(t,e=0){return O(this,t,e)}findDiffEnd(t,e=this.size,r=t.size){return T(this,t,e,r)}findIndex(t,e=-1){if(0==t)return A(0,t);if(t==this.size)return A(this.content.length,t);if(t>this.size||t<0)throw new RangeError(`Position ${t} outside of fragment (${this})`);for(let r=0,n=0;;r++){let i=n+this.child(r).nodeSize;if(i>=t)return i==t||e>0?A(r+1,i):A(r,n);n=i}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map((t=>t.toJSON())):null}static fromJSON(t,e){if(!e)return N.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new N(e.map(t.nodeFromJSON))}static fromArray(t){if(!t.length)return N.empty;let e,r=0;for(let n=0;n<t.length;n++){let i=t[n];r+=i.nodeSize,n&&i.isText&&t[n-1].sameMarkup(i)?(e||(e=t.slice(0,n)),e[e.length-1]=i.withText(e[e.length-1].text+i.text)):e&&e.push(i)}return new N(e||t,r)}static from(t){if(!t)return N.empty;if(t instanceof N)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new N([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}N.empty=new N([],0);const E={index:0,offset:0};function A(t,e){return E.index=t,E.offset=e,E}class R extends Error{}class z{constructor(t,e,r){this.content=t,this.openStart=e,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(t,e){let r=J(this.content,t+this.openStart,e);return r&&new z(r,this.openStart,this.openEnd)}removeBetween(t,e){return new z(C(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)}eq(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t}static fromJSON(t,e){if(!e)return z.empty;let r=e.openStart||0,n=e.openEnd||0;if("number"!=typeof r||"number"!=typeof n)throw new RangeError("Invalid input for Slice.fromJSON");return new z(N.fromJSON(t,e.content),r,n)}static maxOpen(t,e=!0){let r=0,n=0;for(let n=t.firstChild;n&&!n.isLeaf&&(e||!n.type.spec.isolating);n=n.firstChild)r++;for(let r=t.lastChild;r&&!r.isLeaf&&(e||!r.type.spec.isolating);r=r.lastChild)n++;return new z(t,r,n)}}function C(t,e,r){let{index:n,offset:i}=t.findIndex(e),o=t.maybeChild(n),{index:s,offset:a}=t.findIndex(r);if(i==e||o.isText){if(a!=r&&!t.child(s).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(r))}if(n!=s)throw new RangeError("Removing non-flat range");return t.replaceChild(n,o.copy(C(o.content,e-i-1,r-i-1)))}function J(t,e,r,n){let{index:i,offset:o}=t.findIndex(e),s=t.maybeChild(i);if(o==e||s.isText)return n&&!n.canReplace(i,i,r)?null:t.cut(0,e).append(r).append(t.cut(e));let a=J(s.content,e-o-1,r);return a&&t.replaceChild(i,s.copy(a))}z.empty=new z(N.empty,0,0);const I=65535,L=Math.pow(2,16);function $(t){return t&I}class q{constructor(t,e,r){this.pos=t,this.delInfo=e,this.recover=r}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}}class F{constructor(t,e=!1){if(this.ranges=t,this.inverted=e,!t.length&&F.empty)return F.empty}recover(t){let e=0,r=$(t);if(!this.inverted)for(let t=0;t<r;t++)e+=this.ranges[3*t+2]-this.ranges[3*t+1];return this.ranges[3*r]+e+function(t){return(t-(t&I))/L}(t)}mapResult(t,e=1){return this._map(t,e,!1)}map(t,e=1){return this._map(t,e,!0)}_map(t,e,r){let n=0,i=this.inverted?2:1,o=this.inverted?1:2;for(let s=0;s<this.ranges.length;s+=3){let a=this.ranges[s]-(this.inverted?n:0);if(a>t)break;let l=this.ranges[s+i],u=this.ranges[s+o],c=a+l;if(t<=c){let i=a+n+((l?t==a?-1:t==c?1:e:e)<0?0:u);if(r)return i;let o=t==(e<0?a:c)?null:s/3+(t-a)*L,p=t==a?2:t==c?1:4;return(e<0?t!=a:t!=c)&&(p|=8),new q(i,p,o)}n+=u-l}return r?t+n:new q(t+n,0,null)}touches(t,e){let r=0,n=$(e),i=this.inverted?2:1,o=this.inverted?1:2;for(let e=0;e<this.ranges.length;e+=3){let s=this.ranges[e]-(this.inverted?r:0);if(s>t)break;let a=this.ranges[e+i];if(t<=s+a&&e==3*n)return!0;r+=this.ranges[e+o]-a}return!1}forEach(t){let e=this.inverted?2:1,r=this.inverted?1:2;for(let n=0,i=0;n<this.ranges.length;n+=3){let o=this.ranges[n],s=o-(this.inverted?i:0),a=o+(this.inverted?0:i),l=this.ranges[n+e],u=this.ranges[n+r];t(s,s+l,a,a+u),i+=u-l}}invert(){return new F(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(t){return 0==t?F.empty:new F(t<0?[0,-t,0]:[0,0,t])}}F.empty=new F([]);const j=Object.create(null);class P{getMap(){return F.empty}merge(t){return null}static fromJSON(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=j[e.stepType];if(!r)throw new RangeError(`No step type ${e.stepType} defined`);return r.fromJSON(t,e)}static jsonID(t,e){if(t in j)throw new RangeError("Duplicate use of step JSON ID "+t);return j[t]=e,e.prototype.jsonID=t,e}}class H{constructor(t,e){this.doc=t,this.failed=e}static ok(t){return new H(t,null)}static fail(t){return new H(null,t)}static fromReplace(t,e,r,n){try{return H.ok(t.replace(e,r,n))}catch(t){if(t instanceof R)return H.fail(t.message);throw t}}}function B(t,e,r){let n=[];for(let i=0;i<t.childCount;i++){let o=t.child(i);o.content.size&&(o=o.copy(B(o.content,e,o))),o.isInline&&(o=e(o,r,i)),n.push(o)}return N.fromArray(n)}class D extends P{constructor(t,e,r){super(),this.from=t,this.to=e,this.mark=r}apply(t){let e=t.slice(this.from,this.to),r=t.resolve(this.from),n=r.node(r.sharedDepth(this.to)),i=new z(B(e.content,((t,e)=>t.isAtom&&e.type.allowsMarkType(this.mark.type)?t.mark(this.mark.addToSet(t.marks)):t),n),e.openStart,e.openEnd);return H.fromReplace(t,this.from,this.to,i)}invert(){return new _(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return e.deleted&&r.deleted||e.pos>=r.pos?null:new D(e.pos,r.pos,this.mark)}merge(t){return t instanceof D&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new D(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new D(e.from,e.to,t.markFromJSON(e.mark))}}P.jsonID("addMark",D);class _ extends P{constructor(t,e,r){super(),this.from=t,this.to=e,this.mark=r}apply(t){let e=t.slice(this.from,this.to),r=new z(B(e.content,(t=>t.mark(this.mark.removeFromSet(t.marks))),t),e.openStart,e.openEnd);return H.fromReplace(t,this.from,this.to,r)}invert(){return new D(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return e.deleted&&r.deleted||e.pos>=r.pos?null:new _(e.pos,r.pos,this.mark)}merge(t){return t instanceof _&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new _(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new _(e.from,e.to,t.markFromJSON(e.mark))}}P.jsonID("removeMark",_);class W extends P{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return H.fail("No node at mark step's position");let r=e.type.create(e.attrs,null,this.mark.addToSet(e.marks));return H.fromReplace(t,this.pos,this.pos+1,new z(N.from(r),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);if(e){let t=this.mark.addToSet(e.marks);if(t.length==e.marks.length){for(let r=0;r<e.marks.length;r++)if(!e.marks[r].isInSet(t))return new W(this.pos,e.marks[r]);return new W(this.pos,this.mark)}}return new K(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new W(e.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if("number"!=typeof e.pos)throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new W(e.pos,t.markFromJSON(e.mark))}}P.jsonID("addNodeMark",W);class K extends P{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return H.fail("No node at mark step's position");let r=e.type.create(e.attrs,null,this.mark.removeFromSet(e.marks));return H.fromReplace(t,this.pos,this.pos+1,new z(N.from(r),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);return e&&this.mark.isInSet(e.marks)?new W(this.pos,this.mark):this}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new K(e.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if("number"!=typeof e.pos)throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new K(e.pos,t.markFromJSON(e.mark))}}P.jsonID("removeNodeMark",K);class U extends P{constructor(t,e,r,n=!1){super(),this.from=t,this.to=e,this.slice=r,this.structure=n}apply(t){return this.structure&&V(t,this.from,this.to)?H.fail("Structure replace would overwrite content"):H.fromReplace(t,this.from,this.to,this.slice)}getMap(){return new F([this.from,this.to-this.from,this.slice.size])}invert(t){return new U(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let e=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return e.deletedAcross&&r.deletedAcross?null:new U(e.pos,Math.max(e.pos,r.pos),this.slice)}merge(t){if(!(t instanceof U)||t.structure||this.structure)return null;if(this.from+this.slice.size!=t.from||this.slice.openEnd||t.slice.openStart){if(t.to!=this.from||this.slice.openStart||t.slice.openEnd)return null;{let e=this.slice.size+t.slice.size==0?z.empty:new z(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new U(t.from,this.to,e,this.structure)}}{let e=this.slice.size+t.slice.size==0?z.empty:new z(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new U(this.from,this.to+(t.to-t.from),e,this.structure)}}toJSON(){let t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new U(e.from,e.to,z.fromJSON(t,e.slice),!!e.structure)}}P.jsonID("replace",U);class G extends P{constructor(t,e,r,n,i,o,s=!1){super(),this.from=t,this.to=e,this.gapFrom=r,this.gapTo=n,this.slice=i,this.insert=o,this.structure=s}apply(t){if(this.structure&&(V(t,this.from,this.gapFrom)||V(t,this.gapTo,this.to)))return H.fail("Structure gap-replace would overwrite content");let e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return H.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,e.content);return r?H.fromReplace(t,this.from,this.to,r):H.fail("Content does not fit in gap")}getMap(){return new F([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let e=this.gapTo-this.gapFrom;return new G(this.from,this.from+this.slice.size+e,this.from+this.insert,this.from+this.insert+e,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let e=t.mapResult(this.from,1),r=t.mapResult(this.to,-1),n=t.map(this.gapFrom,-1),i=t.map(this.gapTo,1);return e.deletedAcross&&r.deletedAcross||n<e.pos||i>r.pos?null:new G(e.pos,r.pos,n,i,this.slice,this.insert,this.structure)}toJSON(){let t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to||"number"!=typeof e.gapFrom||"number"!=typeof e.gapTo||"number"!=typeof e.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new G(e.from,e.to,e.gapFrom,e.gapTo,z.fromJSON(t,e.slice),e.insert,!!e.structure)}}function V(t,e,r){let n=t.resolve(e),i=r-e,o=n.depth;for(;i>0&&o>0&&n.indexAfter(o)==n.node(o).childCount;)o--,i--;if(i>0){let t=n.node(o).maybeChild(n.indexAfter(o));for(;i>0;){if(!t||t.isLeaf)return!0;t=t.firstChild,i--}}return!1}P.jsonID("replaceAround",G);class Q extends P{constructor(t,e,r){super(),this.pos=t,this.attr=e,this.value=r}apply(t){let e=t.nodeAt(this.pos);if(!e)return H.fail("No node at attribute step's position");let r=Object.create(null);for(let t in e.attrs)r[t]=e.attrs[t];r[this.attr]=this.value;let n=e.type.create(r,null,e.marks);return H.fromReplace(t,this.pos,this.pos+1,new z(N.from(n),0,e.isLeaf?0:1))}getMap(){return F.empty}invert(t){return new Q(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new Q(e.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,e){if("number"!=typeof e.pos||"string"!=typeof e.attr)throw new RangeError("Invalid input for AttrStep.fromJSON");return new Q(e.pos,e.attr,e.value)}}P.jsonID("attr",Q);let X=class extends Error{};X=function t(e){let r=Error.call(this,e);return r.__proto__=t.prototype,r},(X.prototype=Object.create(Error.prototype)).constructor=X,X.prototype.name="TransformError";const Y=Object.create(null);class Z{constructor(t,e,r){this.$anchor=t,this.$head=e,this.ranges=r||[new tt(t.min(e),t.max(e))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let t=this.ranges;for(let e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(t,e=z.empty){let r=e.content.lastChild,n=null;for(let t=0;t<e.openEnd;t++)n=r,r=r.lastChild;let i=t.steps.length,o=this.ranges;for(let s=0;s<o.length;s++){let{$from:a,$to:l}=o[s],u=t.mapping.slice(i);t.replaceRange(u.map(a.pos),u.map(l.pos),s?z.empty:e),0==s&&ct(t,i,(r?r.isInline:n&&n.isTextblock)?-1:1)}}replaceWith(t,e){let r=t.steps.length,n=this.ranges;for(let i=0;i<n.length;i++){let{$from:o,$to:s}=n[i],a=t.mapping.slice(r),l=a.map(o.pos),u=a.map(s.pos);i?t.deleteRange(l,u):(t.replaceRangeWith(l,u,e),ct(t,r,e.isInline?-1:1))}}static findFrom(t,e,r=!1){let n=t.parent.inlineContent?new nt(t):ut(t.node(0),t.parent,t.pos,t.index(),e,r);if(n)return n;for(let n=t.depth-1;n>=0;n--){let i=e<0?ut(t.node(0),t.node(n),t.before(n+1),t.index(n),e,r):ut(t.node(0),t.node(n),t.after(n+1),t.index(n)+1,e,r);if(i)return i}return null}static near(t,e=1){return this.findFrom(t,e)||this.findFrom(t,-e)||new at(t.node(0))}static atStart(t){return ut(t,t,0,0,1)||new at(t)}static atEnd(t){return ut(t,t,t.content.size,t.childCount,-1)||new at(t)}static fromJSON(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=Y[e.type];if(!r)throw new RangeError(`No selection type ${e.type} defined`);return r.fromJSON(t,e)}static jsonID(t,e){if(t in Y)throw new RangeError("Duplicate use of selection JSON ID "+t);return Y[t]=e,e.prototype.jsonID=t,e}getBookmark(){return nt.between(this.$anchor,this.$head).getBookmark()}}Z.prototype.visible=!0;class tt{constructor(t,e){this.$from=t,this.$to=e}}let et=!1;function rt(t){et||t.parent.inlineContent||(et=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class nt extends Z{constructor(t,e=t){rt(t),rt(e),super(t,e)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(t,e){let r=t.resolve(e.map(this.head));if(!r.parent.inlineContent)return Z.near(r);let n=t.resolve(e.map(this.anchor));return new nt(n.parent.inlineContent?n:r,r)}replace(t,e=z.empty){if(super.replace(t,e),e==z.empty){let e=this.$from.marksAcross(this.$to);e&&t.ensureMarks(e)}}eq(t){return t instanceof nt&&t.anchor==this.anchor&&t.head==this.head}getBookmark(){return new it(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(t,e){if("number"!=typeof e.anchor||"number"!=typeof e.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new nt(t.resolve(e.anchor),t.resolve(e.head))}static create(t,e,r=e){let n=t.resolve(e);return new this(n,r==e?n:t.resolve(r))}static between(t,e,r){let n=t.pos-e.pos;if(r&&!n||(r=n>=0?1:-1),!e.parent.inlineContent){let t=Z.findFrom(e,r,!0)||Z.findFrom(e,-r,!0);if(!t)return Z.near(e,r);e=t.$head}return t.parent.inlineContent||(0==n||(t=(Z.findFrom(t,-r,!0)||Z.findFrom(t,r,!0)).$anchor).pos<e.pos!=n<0)&&(t=e),new nt(t,e)}}Z.jsonID("text",nt);class it{constructor(t,e){this.anchor=t,this.head=e}map(t){return new it(t.map(this.anchor),t.map(this.head))}resolve(t){return nt.between(t.resolve(this.anchor),t.resolve(this.head))}}class ot extends Z{constructor(t){let e=t.nodeAfter,r=t.node(0).resolve(t.pos+e.nodeSize);super(t,r),this.node=e}map(t,e){let{deleted:r,pos:n}=e.mapResult(this.anchor),i=t.resolve(n);return r?Z.near(i):new ot(i)}content(){return new z(N.from(this.node),0,0)}eq(t){return t instanceof ot&&t.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new st(this.anchor)}static fromJSON(t,e){if("number"!=typeof e.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new ot(t.resolve(e.anchor))}static create(t,e){return new ot(t.resolve(e))}static isSelectable(t){return!t.isText&&!1!==t.type.spec.selectable}}ot.prototype.visible=!1,Z.jsonID("node",ot);class st{constructor(t){this.anchor=t}map(t){let{deleted:e,pos:r}=t.mapResult(this.anchor);return e?new it(r,r):new st(r)}resolve(t){let e=t.resolve(this.anchor),r=e.nodeAfter;return r&&ot.isSelectable(r)?new ot(e):Z.near(e)}}class at extends Z{constructor(t){super(t.resolve(0),t.resolve(t.content.size))}replace(t,e=z.empty){if(e==z.empty){t.delete(0,t.doc.content.size);let e=Z.atStart(t.doc);e.eq(t.selection)||t.setSelection(e)}else super.replace(t,e)}toJSON(){return{type:"all"}}static fromJSON(t){return new at(t)}map(t){return new at(t)}eq(t){return t instanceof at}getBookmark(){return lt}}Z.jsonID("all",at);const lt={map(){return this},resolve:t=>new at(t)};function ut(t,e,r,n,i,o=!1){if(e.inlineContent)return nt.create(t,r);for(let s=n-(i>0?0:1);i>0?s<e.childCount:s>=0;s+=i){let n=e.child(s);if(n.isAtom){if(!o&&ot.isSelectable(n))return ot.create(t,r-(i<0?n.nodeSize:0))}else{let e=ut(t,n,r+i,i<0?n.childCount:0,i,o);if(e)return e}r+=n.nodeSize*i}return null}function ct(t,e,r){let n=t.steps.length-1;if(n<e)return;let i,o=t.steps[n];(o instanceof U||o instanceof G)&&(t.mapping.maps[n].forEach(((t,e,r,n)=>{null==i&&(i=n)})),t.setSelection(Z.near(t.doc.resolve(i),r)))}function pt(t,e){return e&&t?t.bind(e):t}class ht{constructor(t,e,r){this.name=t,this.init=pt(e.init,r),this.apply=pt(e.apply,r)}}function ft(t,e,r){for(let n in t){let i=t[n];i instanceof Function?i=i.bind(e):"handleDOMEvents"==n&&(i=ft(i,e,{})),r[n]=i}return r}new ht("doc",{init:t=>t.doc||t.schema.topNodeType.createAndFill(),apply:t=>t.doc}),new ht("selection",{init:(t,e)=>t.selection||Z.atStart(e.doc),apply:t=>t.selection}),new ht("storedMarks",{init:t=>t.storedMarks||null,apply:(t,e,r,n)=>n.selection.$cursor?t.storedMarks:null}),new ht("scrollToSelection",{init:()=>0,apply:(t,e)=>t.scrolledIntoView?e+1:e});class dt{constructor(t){this.spec=t,this.props={},t.props&&ft(t.props,this,this.props),this.key=t.key?t.key.key:gt("plugin")}getState(t){return t[this.key]}}const mt=Object.create(null);function gt(t){return t in mt?t+"$"+ ++mt[t]:(mt[t]=0,t+"$")}class wt{constructor(t="key"){this.key=gt(t)}get(t){return t.config.pluginsByKey[this.key]}getState(t){return t[this.key]}}var vt=S.Node.create({name:"figureAudio",group:"block",content:"inline*",draggable:!0,isolating:!0,addAttributes:function(){return{src:{default:null,parseHTML:function(t){var e;return null===(e=t.querySelector("source"))||void 0===e?void 0:e.getAttribute("src")}},title:{default:"",parseHTML:function(t){var e;return null===(e=t.querySelector(".title"))||void 0===e?void 0:e.textContent}},duration:{default:"00:00",parseHTML:function(t){var e,r=t.querySelector(".duration");return null===(e=null==r?void 0:r.dataset)||void 0===e?void 0:e.time}}}},parseHTML:function(){return[{tag:'figure[class="audio"]',contentElement:"figcaption"}]},renderHTML:function(t){var e=t.HTMLAttributes;return["figure",{class:"audio"},["audio",{controls:!0},["source",{src:e.src,type:"audio/mp3",draggable:!1,contenteditable:!1}]],["div",{class:"player"},["header",["div",{class:"meta"},["h4",{class:"title"},e.title],["div",{class:"time"},["span",{class:"current","data-time":"00:00"}],["span",{class:"duration","data-time":e.duration}]]],["span",{class:"play"}]],["footer",["div",{class:"progress-bar"},["span",{}]]]],["figcaption",0]]},addCommands:function(){var t=this;return{setFigureAudio:function(e){var r=e.caption,n=M(e,["caption"]);return function(e){return(0,e.chain)().insertContent({type:t.name,attrs:n,content:r?[{type:"text",text:r}]:[]}).command((function(t){var e=t.tr,r=t.commands,n=e.doc,i=e.selection,o=n.resolve(i.to-2).end();return r.setTextSelection(o)})).run()}}}},addProseMirrorPlugins:function(){return[new dt({key:new wt("removePastedFigureAudio"),props:{transformPastedHTML:function(t){return t=t.replace(/<figure.*class=.audio.*[\n]*.*?<\/figure>/g,"")}}})]}}),yt=S.Node.create({name:"figureEmbed",group:"block",content:"inline*",draggable:!0,isolating:!0,addAttributes:function(){return{class:{default:null,parseHTML:function(t){return t.getAttribute("class")}},src:{default:null,parseHTML:function(t){var e;return null===(e=t.querySelector("iframe"))||void 0===e?void 0:e.getAttribute("src")}}}},parseHTML:function(){return[{tag:'figure[class^="embed"]',contentElement:"figcaption"}]},renderHTML:function(t){var e=function(t){var e,r={url:"",allowfullscreen:!1,sandbox:[]};try{e=new URL(t)}catch(t){return r}var n=e.hostname,i=e.pathname,o=e.searchParams;if(["youtube.com","youtu.be","www.youtu.be","www.youtube.com"].includes(n)){var s=o.get("v"),a=o.get("t"),l=new URLSearchParams(x({rel:"0"},a?{start:a}:{})).toString(),u="";return s?u=s:i.match("/embed/")?u=i.split("/embed/")[1]:n.includes("youtu.be")&&(u=i.split("/")[1]),{url:"https://www.youtube.com/embed/".concat(u)+(l?"?=".concat(l):""),provider:"youtube",allowfullscreen:!0,sandbox:[]}}if(["vimeo.com","www.vimeo.com","player.vimeo.com"].includes(n))return u=i.replace(/\/$/,"").split("/").slice(-1)[0],{url:"https://player.vimeo.com/video/".concat(u),provider:"vimeo",allowfullscreen:!0,sandbox:[]};if(["bilibili.com","player.bilibili.com","www.bilibili.com"].includes(n)){return u="",u=o.get("bvid")||i.replace(/\/$/,"").split("/").slice(-1)[0],{url:"https://player.bilibili.com/player.html?bvid=".concat(u),provider:"bilibili",allowfullscreen:!0,sandbox:[]}}if(["instagram.com","www.instagram.com"].includes(n))return u=i.replace("/embed","").replace(/\/$/,"").split("/").slice(-1)[0],{url:"https://www.instagram.com/p/".concat(u,"/embed"),provider:"instagram",allowfullscreen:!1,sandbox:[]};if(["jsfiddle.net","www.jsfiddle.net"].includes(n)){var c=i.replace("/embedded","").replace(/\/$/,"").split("/").filter(Boolean);return u=1===c.length?c[0]:c[1],{url:"https://jsfiddle.net/".concat(u,"/embedded/"),provider:"jsfiddle",allowfullscreen:!1,sandbox:[]}}if(["codepen.io","www.codepen.io"].includes(n)){var p=i.split("/")[1];return u=i.replace(/\/$/,"").split("/").slice(-1)[0],{url:"https://codepen.io/".concat(p,"/embed/preview/").concat(u),provider:"codepen",allowfullscreen:!1,sandbox:[]}}return r}(t.HTMLAttributes.src),r=e.url,n=e.provider,i=e.allowfullscreen,o=e.sandbox;return["figure",x({class:"embed"},n?{"data-provider":n}:{}),["div",{class:"iframe-container"},["iframe",x(x(x({src:r,loading:"lazy"},o&&o.length>0?{sandbox:o.join(" ")}:{}),i?{allowfullscreen:!0}:{}),{frameborder:"0",draggable:!1,contenteditable:!1})]],["figcaption",0]]},addCommands:function(){var t=this;return{setFigureEmbed:function(e){var r=e.caption,n=M(e,["caption"]);return function(e){return(0,e.chain)().insertContent({type:t.name,attrs:n,content:r?[{type:"text",text:r}]:[]}).command((function(t){var e=t.tr,r=t.commands,n=e.doc,i=e.selection,o=n.resolve(i.to-2).end();return r.setTextSelection(o)})).run()}}}},addProseMirrorPlugins:function(){return[new dt({key:new wt("removePastedFigureEmbed"),props:{transformPastedHTML:function(t){return t=t.replace(/<figure.*class=.embed.*[\n]*.*?<\/figure>/g,"")}}})]}}),St=S.Node.create({name:"figureImage",group:"block",content:"inline*",draggable:!0,isolating:!0,addAttributes:function(){return{class:{default:null,parseHTML:function(t){return t.getAttribute("class")}},src:{default:null,parseHTML:function(t){var e;return null===(e=t.querySelector("img"))||void 0===e?void 0:e.getAttribute("src")}}}},parseHTML:function(){return[{tag:'figure[class="image"]',contentElement:"figcaption"}]},renderHTML:function(t){return["figure",{class:"image"},["img",{src:t.HTMLAttributes.src,draggable:!1,contenteditable:!1}],["figcaption",0]]},addCommands:function(){var t=this;return{setFigureImage:function(e){var r=e.caption,n=M(e,["caption"]);return function(e){return(0,e.chain)().insertContent({type:t.name,attrs:n,content:r?[{type:"text",text:r}]:[]}).command((function(t){var e=t.tr,r=t.commands,n=e.doc,i=e.selection,o=n.resolve(i.to-2).end();return r.setTextSelection(o)})).run()}}}},addProseMirrorPlugins:function(){return[new dt({key:new wt("removePastedFigureImage"),props:{transformPastedHTML:function(t){return t=t.replace(/<figure.*class=.image.*[\n]*.*?<\/figure>/g,"")}}})]}});function kt(t){return new dt({key:new wt("autolink"),appendTransaction:function(e,r,n){var i=e.some((function(t){return t.docChanged}))&&!r.doc.eq(n.doc),o=e.some((function(t){return t.getMeta("preventAutolink")}));if(i&&!o){var s=n.tr,a=S.combineTransactionSteps(r.doc,function(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))}([],e,!0)),l=a.mapping;if(S.getChangedRanges(a).forEach((function(e){var i=e.oldRange,o=e.newRange;S.getMarksBetween(i.from,i.to,r.doc).filter((function(e){return e.mark.type===t.type})).forEach((function(e){var i=l.map(e.from),o=l.map(e.to),a=S.getMarksBetween(i,o,n.doc).filter((function(e){return e.mark.type===t.type}));if(a.length){var u=a[0],c=r.doc.textBetween(e.from,e.to,void 0," "),p=n.doc.textBetween(u.from,u.to,void 0," "),h=k.test(c),f=k.test(p);h&&!f&&s.removeMark(u.from,u.to,t.type)}}));var a,u,c=S.findChildrenInRange(n.doc,o,(function(t){return t.isTextblock}));if(c.length>1?(a=c[0],u=n.doc.textBetween(a.pos,a.pos+a.node.nodeSize,void 0," ")):c.length&&n.doc.textBetween(o.from,o.to," "," ").endsWith(" ")&&(a=c[0],u=n.doc.textBetween(a.pos,o.to,void 0," ")),a&&u){var p=u.split(" ").filter((function(t){return""!==t}));if(p.length<=0)return!1;var h=p[p.length-1],f=a.pos+u.lastIndexOf(h);if(!h)return!1;k.find(h).filter((function(t){return t.isLink})).filter((function(e){return!t.validate||t.validate(e.value)})).map((function(t){return x(x({},t),{from:f+t.start+1,to:f+t.end+1})})).forEach((function(e){s.addMark(e.from,e.to,t.type.create({href:e.href}))}))}})),s.steps.length)return s}}})}var bt=S.Mark.create({name:"link",keepOnSplit:!1,onCreate:function(){this.options.protocols.forEach((function(t){"string"!=typeof t?k.registerCustomProtocol(t.scheme,t.optionalSlashes):k.registerCustomProtocol(t)}))},onDestroy:function(){k.reset()},inclusive:function(){return this.options.autolink},addOptions:function(){return{openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},validate:void 0}},addAttributes:function(){return{href:{default:null},target:{default:this.options.HTMLAttributes.target},class:{default:this.options.HTMLAttributes.class}}},parseHTML:function(){return[{tag:'a[href]:not([href *= "javascript:" i]):not([class="mention"])'}]},renderHTML:function(t){var e=t.HTMLAttributes;return["a",S.mergeAttributes(this.options.HTMLAttributes,e),0]},addCommands:function(){var t=this;return{setLink:function(e){return function(r){return(0,r.chain)().setMark(t.name,e).setMeta("preventAutolink",!0).run()}},toggleLink:function(e){return function(r){return(0,r.chain)().toggleMark(t.name,e,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},unsetLink:function(){return function(e){return(0,e.chain)().unsetMark(t.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}}}},addPasteRules:function(){var t=this;return[S.markPasteRule({find:function(e){return k.find(e).filter((function(e){return!t.options.validate||t.options.validate(e.value)})).filter((function(t){return t.isLink})).map((function(t){return{text:t.value,index:t.start,data:t}}))},type:this.type,getAttributes:function(t){var e;return{href:null===(e=t.data)||void 0===e?void 0:e.href}}})]},addProseMirrorPlugins:function(){var t,e=[];return this.options.autolink&&e.push(kt({type:this.type,validate:this.options.validate})),this.options.openOnClick&&e.push((t={type:this.type},new dt({key:new wt("handleClickLink"),props:{handleClick:function(e,r,n){var i,o,s;if(1!==n.button)return!1;var a=S.getAttributes(e.state,t.type.name),l=null===(i=n.target)||void 0===i?void 0:i.closest("a"),u=null!==(o=null==l?void 0:l.href)&&void 0!==o?o:a.href,c=null!==(s=null==l?void 0:l.target)&&void 0!==s?s:a.target;return!(!l||!u||(window.open(u,c),0))}}}))),this.options.linkOnPaste&&e.push(function(t){return new dt({key:new wt("handlePasteLink"),props:{handlePaste:function(e,r,n){if(e.state.selection.empty)return!1;var i="";n.content.forEach((function(t){i+=t.textContent}));var o=k.find(i).find((function(t){return t.isLink&&t.value===i}));return!(!i||!o||(t.editor.commands.setMark(t.type,{href:o.href}),0))}}})}({editor:this.editor,type:this.type})),e}}),xt=new wt("mention"),Mt=S.Node.create({name:"mention",group:"inline",inline:!0,selectable:!1,atom:!0,addOptions:function(){var t=this;return{suggestion:{char:"@",allowedPrefixes:null,pluginKey:xt,command:function(e){var r,n,i,o=e.editor,s=e.range,a=e.props,l=o.view.state.selection,u=l.$from,c=l.$to,p=1===u.parentOffset,h=c.nodeBefore,f=c.nodeAfter,d=null===(r=null==h?void 0:h.text)||void 0===r?void 0:r.startsWith(" "),m=null===(n=null==f?void 0:f.text)||void 0===n?void 0:n.startsWith(" "),g=[];p||d||g.push({type:"text",text:" "}),g.push({type:t.name,attrs:a}),m||g.push({type:"text",text:" "}),o.chain().focus().insertContentAt(s,g).run(),null===(i=window.getSelection())||void 0===i||i.collapseToEnd()},allow:function(e){var r=e.state,n=e.range,i=r.doc.resolve(n.from),o=r.schema.nodes[t.name];return!!i.parent.type.contentMatch.matchType(o)}}}},addAttributes:function(){return{id:{default:null,parseHTML:function(t){return t.getAttribute("data-id")}},userName:{default:null,parseHTML:function(t){return t.getAttribute("data-user-name")}},displayName:{default:null,parseHTML:function(t){return t.getAttribute("data-display-name")}}}},parseHTML:function(){return[{tag:'a[class="mention"]'}]},renderHTML:function(t){var e,r=t.node;return["a",{class:"mention",href:"/"+this.options.suggestion.char+r.attrs.userName,"data-id":r.attrs.id,"data-user-name":r.attrs.userName,"data-display-name":r.attrs.displayName,ref:"noopener noreferrer nofollow"},["span","@".concat(null!==(e=r.attrs.displayName)&&void 0!==e?e:r.attrs.userName)]]},addKeyboardShortcuts:function(){var t=this;return{Backspace:function(){return t.editor.commands.command((function(e){var r=e.tr,n=e.state,i=!1,o=n.selection,s=o.empty,a=o.anchor;return!!s&&(n.doc.nodesBetween(a-1,a,(function(e,n){if(e.type.name===t.name)return i=!0,r.insertText(t.options.suggestion.char||"",n,n+e.nodeSize),!1})),i)}))}}},addProseMirrorPlugins:function(){return[b(x({editor:this.editor},this.options.suggestion))]}}),Ot=function(t){var S=t.placeholder,k=t.mentionSuggestion;return[s,c,a,w.configure({placeholder:S}),y,g,u.configure({levels:[2,3]}),r,v,h,p,i,o,e,l,f,m,d,n,bt,St,vt,yt,Mt.configure({suggestion:k})]},Tt=function(t){var a=t.placeholder,u=t.mentionSuggestion;return[s,c,w.configure({placeholder:a}),y,g,r,v,h,p,i,o,e,l,f,d,m,n,bt,Mt.configure({suggestion:u})]};exports.makeArticleEditorExtensions=Ot,exports.makeCommentEditorExtensions=Tt,exports.useArticleEdtor=function(e){var r=e.content,n=e.placeholder,i=e.mentionSuggestion,o=M(e,["content","placeholder","mentionSuggestion"]);return t.useEditor(x({extensions:Ot({placeholder:n,mentionSuggestion:i}),content:r},o))},exports.useCommentEditor=function(e){var r=e.content,n=e.placeholder,i=e.mentionSuggestion,o=M(e,["content","placeholder","mentionSuggestion"]);return t.useEditor(x({extensions:Tt({placeholder:n,mentionSuggestion:i}),content:r},o))},Object.keys(t).forEach((function(e){"default"===e||exports.hasOwnProperty(e)||Object.defineProperty(exports,e,{enumerable:!0,get:function(){return t[e]}})}));
