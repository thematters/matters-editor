import{useEditor as t}from"@tiptap/react";export*from"@tiptap/react";import e from"@tiptap/extension-blockquote";import n from"@tiptap/extension-bold";import r from"@tiptap/extension-bullet-list";import i from"@tiptap/extension-code";import o from"@tiptap/extension-code-block";import s from"@tiptap/extension-document";import a from"@tiptap/extension-gapcursor";import l from"@tiptap/extension-hard-break";import h from"@tiptap/extension-heading";import c from"@tiptap/extension-history";import u from"@tiptap/extension-italic";import p from"@tiptap/extension-underline";import f from"@tiptap/extension-horizontal-rule";import d from"@tiptap/extension-list-item";import m from"@tiptap/extension-ordered-list";import g from"@tiptap/extension-paragraph";import y from"@tiptap/extension-placeholder";import k from"@tiptap/extension-strike";import w from"@tiptap/extension-text";import{Node as v,combineTransactionSteps as x,getChangedRanges as S,getMarksBetween as b,findChildrenInRange as M,getAttributes as O,Mark as T,mergeAttributes as N,markPasteRule as E,getSchema as C}from"@tiptap/core";import{test as A,find as z,registerCustomProtocol as I,reset as R}from"linkifyjs";import J from"@tiptap/suggestion";import{unified as F}from"unified";import P from"rehype-parse";import L from"rehype-remark";import $ from"remark-stringify";import{combineExtensions as B}from"micromark-util-combine-extensions";import{gfmStrikethrough as D}from"micromark-extension-gfm-strikethrough";import{gfmStrikethroughFromMarkdown as j,gfmStrikethroughToMarkdown as H}from"mdast-util-gfm-strikethrough";import q from"rehype-rewrite";import W,{defaultSchema as _}from"rehype-sanitize";import{toHtml as K}from"hast-util-to-html";import U from"remark-parse";import V from"remark-rehype";import G from"rehype-stringify";import Q from"rehype-raw";import X from"rehype-format";import Y from"remark-breaks";import Z from"remark-directive";import tt from"remark-directive-rehype";import{parseHTML as et,createHTMLDocument as nt}from"zeed-dom";var rt=function(){return rt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},rt.apply(this,arguments)};function it(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}function ot(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{l(r.next(t))}catch(t){o(t)}}function a(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}l((r=r.apply(t,e||[])).next())}))}function st(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}function at(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}function lt(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let i=t.child(r),o=e.child(r);if(i!=o){if(!i.sameMarkup(o))return n;if(i.isText&&i.text!=o.text){for(let t=0;i.text[t]==o.text[t];t++)n++;return n}if(i.content.size||o.content.size){let t=lt(i.content,o.content,n+1);if(null!=t)return t}n+=i.nodeSize}else n+=i.nodeSize}}function ht(t,e,n,r){for(let i=t.childCount,o=e.childCount;;){if(0==i||0==o)return i==o?null:{a:n,b:r};let s=t.child(--i),a=e.child(--o),l=s.nodeSize;if(s!=a){if(!s.sameMarkup(a))return{a:n,b:r};if(s.isText&&s.text!=a.text){let t=0,e=Math.min(s.text.length,a.text.length);for(;t<e&&s.text[s.text.length-t-1]==a.text[a.text.length-t-1];)t++,n--,r--;return{a:n,b:r}}if(s.content.size||a.content.size){let t=ht(s.content,a.content,n-1,r-1);if(t)return t}n-=l,r-=l}else n-=l,r-=l}}class ct{constructor(t,e){if(this.content=t,this.size=e||0,null==e)for(let e=0;e<t.length;e++)this.size+=t[e].nodeSize}nodesBetween(t,e,n,r=0,i){for(let o=0,s=0;s<e;o++){let a=this.content[o],l=s+a.nodeSize;if(l>t&&!1!==n(a,r+s,i||null,o)&&a.content.size){let i=s+1;a.nodesBetween(Math.max(0,t-i),Math.min(a.content.size,e-i),n,r+i)}s=l}}descendants(t){this.nodesBetween(0,this.size,t)}textBetween(t,e,n,r){let i="",o=!0;return this.nodesBetween(t,e,((s,a)=>{s.isText?(i+=s.text.slice(Math.max(t,a)-a,e-a),o=!n):s.isLeaf?(r?i+="function"==typeof r?r(s):r:s.type.spec.leafText&&(i+=s.type.spec.leafText(s)),o=!n):!o&&s.isBlock&&(i+=n,o=!0)}),0),i}append(t){if(!t.size)return this;if(!this.size)return t;let e=this.lastChild,n=t.firstChild,r=this.content.slice(),i=0;for(e.isText&&e.sameMarkup(n)&&(r[r.length-1]=e.withText(e.text+n.text),i=1);i<t.content.length;i++)r.push(t.content[i]);return new ct(r,this.size+t.size)}cut(t,e=this.size){if(0==t&&e==this.size)return this;let n=[],r=0;if(e>t)for(let i=0,o=0;o<e;i++){let s=this.content[i],a=o+s.nodeSize;a>t&&((o<t||a>e)&&(s=s.isText?s.cut(Math.max(0,t-o),Math.min(s.text.length,e-o)):s.cut(Math.max(0,t-o-1),Math.min(s.content.size,e-o-1))),n.push(s),r+=s.nodeSize),o=a}return new ct(n,r)}cutByIndex(t,e){return t==e?ct.empty:0==t&&e==this.content.length?this:new ct(this.content.slice(t,e))}replaceChild(t,e){let n=this.content[t];if(n==e)return this;let r=this.content.slice(),i=this.size+e.nodeSize-n.nodeSize;return r[t]=e,new ct(r,i)}addToStart(t){return new ct([t].concat(this.content),this.size+t.nodeSize)}addToEnd(t){return new ct(this.content.concat(t),this.size+t.nodeSize)}eq(t){if(this.content.length!=t.content.length)return!1;for(let e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(t){let e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e}maybeChild(t){return this.content[t]||null}forEach(t){for(let e=0,n=0;e<this.content.length;e++){let r=this.content[e];t(r,n,e),n+=r.nodeSize}}findDiffStart(t,e=0){return lt(this,t,e)}findDiffEnd(t,e=this.size,n=t.size){return ht(this,t,e,n)}findIndex(t,e=-1){if(0==t)return pt(0,t);if(t==this.size)return pt(this.content.length,t);if(t>this.size||t<0)throw new RangeError(`Position ${t} outside of fragment (${this})`);for(let n=0,r=0;;n++){let i=r+this.child(n).nodeSize;if(i>=t)return i==t||e>0?pt(n+1,i):pt(n,r);r=i}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map((t=>t.toJSON())):null}static fromJSON(t,e){if(!e)return ct.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new ct(e.map(t.nodeFromJSON))}static fromArray(t){if(!t.length)return ct.empty;let e,n=0;for(let r=0;r<t.length;r++){let i=t[r];n+=i.nodeSize,r&&i.isText&&t[r-1].sameMarkup(i)?(e||(e=t.slice(0,r)),e[e.length-1]=i.withText(e[e.length-1].text+i.text)):e&&e.push(i)}return new ct(e||t,n)}static from(t){if(!t)return ct.empty;if(t instanceof ct)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new ct([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}ct.empty=new ct([],0);const ut={index:0,offset:0};function pt(t,e){return ut.index=t,ut.offset=e,ut}function ft(t,e){if(t===e)return!0;if(!t||"object"!=typeof t||!e||"object"!=typeof e)return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!ft(t[n],e[n]))return!1}else{for(let n in t)if(!(n in e)||!ft(t[n],e[n]))return!1;for(let n in e)if(!(n in t))return!1}return!0}class dt{constructor(t,e){this.type=t,this.attrs=e}addToSet(t){let e,n=!1;for(let r=0;r<t.length;r++){let i=t[r];if(this.eq(i))return t;if(this.type.excludes(i.type))e||(e=t.slice(0,r));else{if(i.type.excludes(this.type))return t;!n&&i.type.rank>this.type.rank&&(e||(e=t.slice(0,r)),e.push(this),n=!0),e&&e.push(i)}}return e||(e=t.slice()),n||e.push(this),e}removeFromSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t}isInSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1}eq(t){return this==t||this.type==t.type&&ft(this.attrs,t.attrs)}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");let n=t.marks[e.type];if(!n)throw new RangeError(`There is no mark type ${e.type} in this schema`);return n.create(e.attrs)}static sameSet(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].eq(e[n]))return!1;return!0}static setFrom(t){if(!t||Array.isArray(t)&&0==t.length)return dt.none;if(t instanceof dt)return[t];let e=t.slice();return e.sort(((t,e)=>t.type.rank-e.type.rank)),e}}dt.none=[];class mt extends Error{}class gt{constructor(t,e,n){this.content=t,this.openStart=e,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(t,e){let n=kt(this.content,t+this.openStart,e);return n&&new gt(n,this.openStart,this.openEnd)}removeBetween(t,e){return new gt(yt(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)}eq(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t}static fromJSON(t,e){if(!e)return gt.empty;let n=e.openStart||0,r=e.openEnd||0;if("number"!=typeof n||"number"!=typeof r)throw new RangeError("Invalid input for Slice.fromJSON");return new gt(ct.fromJSON(t,e.content),n,r)}static maxOpen(t,e=!0){let n=0,r=0;for(let r=t.firstChild;r&&!r.isLeaf&&(e||!r.type.spec.isolating);r=r.firstChild)n++;for(let n=t.lastChild;n&&!n.isLeaf&&(e||!n.type.spec.isolating);n=n.lastChild)r++;return new gt(t,n,r)}}function yt(t,e,n){let{index:r,offset:i}=t.findIndex(e),o=t.maybeChild(r),{index:s,offset:a}=t.findIndex(n);if(i==e||o.isText){if(a!=n&&!t.child(s).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=s)throw new RangeError("Removing non-flat range");return t.replaceChild(r,o.copy(yt(o.content,e-i-1,n-i-1)))}function kt(t,e,n,r){let{index:i,offset:o}=t.findIndex(e),s=t.maybeChild(i);if(o==e||s.isText)return r&&!r.canReplace(i,i,n)?null:t.cut(0,e).append(n).append(t.cut(e));let a=kt(s.content,e-o-1,n);return a&&t.replaceChild(i,s.copy(a))}function wt(t,e,n){if(n.openStart>t.depth)throw new mt("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new mt("Inconsistent open depths");return vt(t,e,n,0)}function vt(t,e,n,r){let i=t.index(r),o=t.node(r);if(i==e.index(r)&&r<t.depth-n.openStart){let s=vt(t,e,n,r+1);return o.copy(o.content.replaceChild(i,s))}if(n.content.size){if(n.openStart||n.openEnd||t.depth!=r||e.depth!=r){let{start:i,end:s}=function(t,e){let n=e.depth-t.openStart,r=e.node(n).copy(t.content);for(let t=n-1;t>=0;t--)r=e.node(t).copy(ct.from(r));return{start:r.resolveNoCache(t.openStart+n),end:r.resolveNoCache(r.content.size-t.openEnd-n)}}(n,t);return Ot(o,Tt(t,i,s,e,r))}{let r=t.parent,i=r.content;return Ot(r,i.cut(0,t.parentOffset).append(n.content).append(i.cut(e.parentOffset)))}}return Ot(o,Nt(t,e,r))}function xt(t,e){if(!e.type.compatibleContent(t.type))throw new mt("Cannot join "+e.type.name+" onto "+t.type.name)}function St(t,e,n){let r=t.node(n);return xt(r,e.node(n)),r}function bt(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function Mt(t,e,n,r){let i=(e||t).node(n),o=0,s=e?e.index(n):i.childCount;t&&(o=t.index(n),t.depth>n?o++:t.textOffset&&(bt(t.nodeAfter,r),o++));for(let t=o;t<s;t++)bt(i.child(t),r);e&&e.depth==n&&e.textOffset&&bt(e.nodeBefore,r)}function Ot(t,e){return t.type.checkContent(e),t.copy(e)}function Tt(t,e,n,r,i){let o=t.depth>i&&St(t,e,i+1),s=r.depth>i&&St(n,r,i+1),a=[];return Mt(null,t,i,a),o&&s&&e.index(i)==n.index(i)?(xt(o,s),bt(Ot(o,Tt(t,e,n,r,i+1)),a)):(o&&bt(Ot(o,Nt(t,e,i+1)),a),Mt(e,n,i,a),s&&bt(Ot(s,Nt(n,r,i+1)),a)),Mt(r,null,i,a),new ct(a)}function Nt(t,e,n){let r=[];if(Mt(null,t,n,r),t.depth>n){bt(Ot(St(t,e,n+1),Nt(t,e,n+1)),r)}return Mt(e,null,n,r),new ct(r)}gt.empty=new gt(ct.empty,0,0);class Et{constructor(t,e,n){this.pos=t,this.path=e,this.parentOffset=n,this.depth=e.length/3-1}resolveDepth(t){return null==t?this.depth:t<0?this.depth+t:t}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(t){return this.path[3*this.resolveDepth(t)]}index(t){return this.path[3*this.resolveDepth(t)+1]}indexAfter(t){return t=this.resolveDepth(t),this.index(t)+(t!=this.depth||this.textOffset?1:0)}start(t){return 0==(t=this.resolveDepth(t))?0:this.path[3*t-1]+1}end(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size}before(t){if(!(t=this.resolveDepth(t)))throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]}after(t){if(!(t=this.resolveDepth(t)))throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]+this.path[3*t].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;let n=this.pos-this.path[this.path.length-1],r=t.child(e);return n?t.child(e).cut(n):r}get nodeBefore(){let t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):0==t?null:this.parent.child(t-1)}posAtIndex(t,e){e=this.resolveDepth(e);let n=this.path[3*e],r=0==e?0:this.path[3*e-1]+1;for(let e=0;e<t;e++)r+=n.child(e).nodeSize;return r}marks(){let t=this.parent,e=this.index();if(0==t.content.size)return dt.none;if(this.textOffset)return t.child(e).marks;let n=t.maybeChild(e-1),r=t.maybeChild(e);if(!n){let t=n;n=r,r=t}let i=n.marks;for(var o=0;o<i.length;o++)!1!==i[o].type.spec.inclusive||r&&i[o].isInSet(r.marks)||(i=i[o--].removeFromSet(i));return i}marksAcross(t){let e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;let n=e.marks,r=t.parent.maybeChild(t.index());for(var i=0;i<n.length;i++)!1!==n[i].type.spec.inclusive||r&&n[i].isInSet(r.marks)||(n=n[i--].removeFromSet(n));return n}sharedDepth(t){for(let e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0}blockRange(t=this,e){if(t.pos<this.pos)return t.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--)if(t.pos<=this.end(n)&&(!e||e(this.node(n))))return new It(this,t,n);return null}sameParent(t){return this.pos-this.parentOffset==t.pos-t.parentOffset}max(t){return t.pos>this.pos?t:this}min(t){return t.pos<this.pos?t:this}toString(){let t="";for(let e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset}static resolve(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");let n=[],r=0,i=e;for(let e=t;;){let{index:t,offset:o}=e.content.findIndex(i),s=i-o;if(n.push(e,t,r+o),!s)break;if(e=e.child(t),e.isText)break;i=s-1,r+=o+1}return new Et(e,n,i)}static resolveCached(t,e){for(let n=0;n<Ct.length;n++){let r=Ct[n];if(r.pos==e&&r.doc==t)return r}let n=Ct[At]=Et.resolve(t,e);return At=(At+1)%zt,n}}let Ct=[],At=0,zt=12;class It{constructor(t,e,n){this.$from=t,this.$to=e,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const Rt=Object.create(null);class Jt{constructor(t,e,n,r=dt.none){this.type=t,this.attrs=e,this.marks=r,this.content=n||ct.empty}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(t){return this.content.child(t)}maybeChild(t){return this.content.maybeChild(t)}forEach(t){this.content.forEach(t)}nodesBetween(t,e,n,r=0){this.content.nodesBetween(t,e,n,r,this)}descendants(t){this.nodesBetween(0,this.content.size,t)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(t,e,n,r){return this.content.textBetween(t,e,n,r)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)}sameMarkup(t){return this.hasMarkup(t.type,t.attrs,t.marks)}hasMarkup(t,e,n){return this.type==t&&ft(this.attrs,e||t.defaultAttrs||Rt)&&dt.sameSet(this.marks,n||dt.none)}copy(t=null){return t==this.content?this:new Jt(this.type,this.attrs,t,this.marks)}mark(t){return t==this.marks?this:new Jt(this.type,this.attrs,this.content,t)}cut(t,e=this.content.size){return 0==t&&e==this.content.size?this:this.copy(this.content.cut(t,e))}slice(t,e=this.content.size,n=!1){if(t==e)return gt.empty;let r=this.resolve(t),i=this.resolve(e),o=n?0:r.sharedDepth(e),s=r.start(o),a=r.node(o).content.cut(r.pos-s,i.pos-s);return new gt(a,r.depth-o,i.depth-o)}replace(t,e,n){return wt(this.resolve(t),this.resolve(e),n)}nodeAt(t){for(let e=this;;){let{index:n,offset:r}=e.content.findIndex(t);if(e=e.maybeChild(n),!e)return null;if(r==t||e.isText)return e;t-=r+1}}childAfter(t){let{index:e,offset:n}=this.content.findIndex(t);return{node:this.content.maybeChild(e),index:e,offset:n}}childBefore(t){if(0==t)return{node:null,index:0,offset:0};let{index:e,offset:n}=this.content.findIndex(t);if(n<t)return{node:this.content.child(e),index:e,offset:n};let r=this.content.child(e-1);return{node:r,index:e-1,offset:n-r.nodeSize}}resolve(t){return Et.resolveCached(this,t)}resolveNoCache(t){return Et.resolve(this,t)}rangeHasMark(t,e,n){let r=!1;return e>t&&this.nodesBetween(t,e,(t=>(n.isInSet(t.marks)&&(r=!0),!r))),r}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),function(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}(this.marks,t)}contentMatchAt(t){let e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e}canReplace(t,e,n=ct.empty,r=0,i=n.childCount){let o=this.contentMatchAt(t).matchFragment(n,r,i),s=o&&o.matchFragment(this.content,e);if(!s||!s.validEnd)return!1;for(let t=r;t<i;t++)if(!this.type.allowsMarks(n.child(t).marks))return!1;return!0}canReplaceWith(t,e,n,r){if(r&&!this.type.allowsMarks(r))return!1;let i=this.contentMatchAt(t).matchType(n),o=i&&i.matchFragment(this.content,e);return!!o&&o.validEnd}canAppend(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)}check(){this.type.checkContent(this.content);let t=dt.none;for(let e=0;e<this.marks.length;e++)t=this.marks[e].addToSet(t);if(!dt.sameSet(t,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map((t=>t.type.name))}`);this.content.forEach((t=>t.check()))}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map((t=>t.toJSON()))),t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");let n=null;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=e.marks.map(t.markFromJSON)}if("text"==e.type){if("string"!=typeof e.text)throw new RangeError("Invalid text node in JSON");return t.text(e.text,n)}let r=ct.fromJSON(t,e.content);return t.nodeType(e.type).create(e.attrs,r,n)}}Jt.prototype.text=void 0;class Ft{constructor(t,e){this.schema=t,this.rules=e,this.tags=[],this.styles=[],e.forEach((t=>{t.tag?this.tags.push(t):t.style&&this.styles.push(t)})),this.normalizeLists=!this.tags.some((e=>{if(!/^(ul|ol)\b/.test(e.tag)||!e.node)return!1;let n=t.nodes[e.node];return n.contentMatch.matchType(n)}))}parse(t,e={}){let n=new Wt(this,e,!1);return n.addAll(t,e.from,e.to),n.finish()}parseSlice(t,e={}){let n=new Wt(this,e,!0);return n.addAll(t,e.from,e.to),gt.maxOpen(n.finish())}matchTag(t,e,n){for(let r=n?this.tags.indexOf(n)+1:0;r<this.tags.length;r++){let n=this.tags[r];if(_t(t,n.tag)&&(void 0===n.namespace||t.namespaceURI==n.namespace)&&(!n.context||e.matchesContext(n.context))){if(n.getAttrs){let e=n.getAttrs(t);if(!1===e)continue;n.attrs=e||void 0}return n}}}matchStyle(t,e,n,r){for(let i=r?this.styles.indexOf(r)+1:0;i<this.styles.length;i++){let r=this.styles[i],o=r.style;if(!(0!=o.indexOf(t)||r.context&&!n.matchesContext(r.context)||o.length>t.length&&(61!=o.charCodeAt(t.length)||o.slice(t.length+1)!=e))){if(r.getAttrs){let t=r.getAttrs(e);if(!1===t)continue;r.attrs=t||void 0}return r}}}static schemaRules(t){let e=[];function n(t){let n=null==t.priority?50:t.priority,r=0;for(;r<e.length;r++){let t=e[r];if((null==t.priority?50:t.priority)<n)break}e.splice(r,0,t)}for(let e in t.marks){let r=t.marks[e].spec.parseDOM;r&&r.forEach((t=>{n(t=Kt(t)),t.mark||t.ignore||t.clearMark||(t.mark=e)}))}for(let e in t.nodes){let r=t.nodes[e].spec.parseDOM;r&&r.forEach((t=>{n(t=Kt(t)),t.node||t.ignore||t.mark||(t.node=e)}))}return e}static fromSchema(t){return t.cached.domParser||(t.cached.domParser=new Ft(t,Ft.schemaRules(t)))}}const Pt={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Lt={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},$t={ol:!0,ul:!0},Bt=1,Dt=2,jt=4;function Ht(t,e,n){return null!=e?(e?Bt:0)|("full"===e?Dt:0):t&&"pre"==t.whitespace?Bt|Dt:n&~jt}class qt{constructor(t,e,n,r,i,o,s){this.type=t,this.attrs=e,this.marks=n,this.pendingMarks=r,this.solid=i,this.options=s,this.content=[],this.activeMarks=dt.none,this.stashMarks=[],this.match=o||(s&jt?null:t.contentMatch)}findWrapping(t){if(!this.match){if(!this.type)return[];let e=this.type.contentMatch.fillBefore(ct.from(t));if(!e){let e,n=this.type.contentMatch;return(e=n.findWrapping(t.type))?(this.match=n,e):null}this.match=this.type.contentMatch.matchFragment(e)}return this.match.findWrapping(t.type)}finish(t){if(!(this.options&Bt)){let t,e=this.content[this.content.length-1];if(e&&e.isText&&(t=/[ \t\r\n\u000c]+$/.exec(e.text))){let n=e;e.text.length==t[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-t[0].length))}}let e=ct.from(this.content);return!t&&this.match&&(e=e.append(this.match.fillBefore(ct.empty,!0))),this.type?this.type.create(this.attrs,e,this.marks):e}popFromStashMark(t){for(let e=this.stashMarks.length-1;e>=0;e--)if(t.eq(this.stashMarks[e]))return this.stashMarks.splice(e,1)[0]}applyPending(t){for(let e=0,n=this.pendingMarks;e<n.length;e++){let r=n[e];(this.type?this.type.allowsMarkType(r.type):Ut(r.type,t))&&!r.isInSet(this.activeMarks)&&(this.activeMarks=r.addToSet(this.activeMarks),this.pendingMarks=r.removeFromSet(this.pendingMarks))}}inlineContext(t){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:t.parentNode&&!Pt.hasOwnProperty(t.parentNode.nodeName.toLowerCase())}}class Wt{constructor(t,e,n){this.parser=t,this.options=e,this.isOpen=n,this.open=0;let r,i=e.topNode,o=Ht(null,e.preserveWhitespace,0)|(n?jt:0);r=i?new qt(i.type,i.attrs,dt.none,dt.none,!0,e.topMatch||i.type.contentMatch,o):new qt(n?null:t.schema.topNodeType,null,dt.none,dt.none,!0,null,o),this.nodes=[r],this.find=e.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(t){if(3==t.nodeType)this.addTextNode(t);else if(1==t.nodeType){let e=t.getAttribute("style");if(e){let n=this.readStyles(function(t){let e,n=/\s*([\w-]+)\s*:\s*([^;]+)/g,r=[];for(;e=n.exec(t);)r.push(e[1],e[2].trim());return r}(e));if(!n)return;let[r,i]=n,o=this.top;for(let t=0;t<i.length;t++)this.removePendingMark(i[t],o);for(let t=0;t<r.length;t++)this.addPendingMark(r[t]);this.addElement(t);for(let t=0;t<r.length;t++)this.removePendingMark(r[t],o);for(let t=0;t<i.length;t++)this.addPendingMark(i[t])}else this.addElement(t)}}addTextNode(t){let e=t.nodeValue,n=this.top;if(n.options&Dt||n.inlineContext(t)||/[^ \t\r\n\u000c]/.test(e)){if(n.options&Bt)e=n.options&Dt?e.replace(/\r\n?/g,"\n"):e.replace(/\r?\n|\r/g," ");else if(e=e.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(e)&&this.open==this.nodes.length-1){let r=n.content[n.content.length-1],i=t.previousSibling;(!r||i&&"BR"==i.nodeName||r.isText&&/[ \t\r\n\u000c]$/.test(r.text))&&(e=e.slice(1))}e&&this.insertNode(this.parser.schema.text(e)),this.findInText(t)}else this.findInside(t)}addElement(t,e){let n,r=t.nodeName.toLowerCase();$t.hasOwnProperty(r)&&this.parser.normalizeLists&&function(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let t=1==e.nodeType?e.nodeName.toLowerCase():null;t&&$t.hasOwnProperty(t)&&n?(n.appendChild(e),e=n):"li"==t?n=e:t&&(n=null)}}(t);let i=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(n=this.parser.matchTag(t,this,e));if(i?i.ignore:Lt.hasOwnProperty(r))this.findInside(t),this.ignoreFallback(t);else if(!i||i.skip||i.closeParent){i&&i.closeParent?this.open=Math.max(0,this.open-1):i&&i.skip.nodeType&&(t=i.skip);let e,n=this.top,o=this.needsBlock;if(Pt.hasOwnProperty(r))n.content.length&&n.content[0].isInline&&this.open&&(this.open--,n=this.top),e=!0,n.type||(this.needsBlock=!0);else if(!t.firstChild)return void this.leafFallback(t);this.addAll(t),e&&this.sync(n),this.needsBlock=o}else this.addElementByRule(t,i,!1===i.consuming?n:void 0)}leafFallback(t){"BR"==t.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode("\n"))}ignoreFallback(t){"BR"!=t.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"))}readStyles(t){let e=dt.none,n=dt.none;t:for(let r=0;r<t.length;r+=2)for(let i;;){let o=this.parser.matchStyle(t[r],t[r+1],this,i);if(!o)continue t;if(o.ignore)return null;if(o.clearMark?this.top.pendingMarks.forEach((t=>{o.clearMark(t)&&(n=t.addToSet(n))})):e=this.parser.schema.marks[o.mark].create(o.attrs).addToSet(e),!1!==o.consuming)break;i=o}return[e,n]}addElementByRule(t,e,n){let r,i,o;if(e.node)i=this.parser.schema.nodes[e.node],i.isLeaf?this.insertNode(i.create(e.attrs))||this.leafFallback(t):r=this.enter(i,e.attrs||null,e.preserveWhitespace);else{o=this.parser.schema.marks[e.mark].create(e.attrs),this.addPendingMark(o)}let s=this.top;if(i&&i.isLeaf)this.findInside(t);else if(n)this.addElement(t,n);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach((t=>this.insertNode(t)));else{let n=t;"string"==typeof e.contentElement?n=t.querySelector(e.contentElement):"function"==typeof e.contentElement?n=e.contentElement(t):e.contentElement&&(n=e.contentElement),this.findAround(t,n,!0),this.addAll(n)}r&&this.sync(s)&&this.open--,o&&this.removePendingMark(o,s)}addAll(t,e,n){let r=e||0;for(let i=e?t.childNodes[e]:t.firstChild,o=null==n?null:t.childNodes[n];i!=o;i=i.nextSibling,++r)this.findAtPoint(t,r),this.addDOM(i);this.findAtPoint(t,r)}findPlace(t){let e,n;for(let r=this.open;r>=0;r--){let i=this.nodes[r],o=i.findWrapping(t);if(o&&(!e||e.length>o.length)&&(e=o,n=i,!o.length))break;if(i.solid)break}if(!e)return!1;this.sync(n);for(let t=0;t<e.length;t++)this.enterInner(e[t],null,!1);return!0}insertNode(t){if(t.isInline&&this.needsBlock&&!this.top.type){let t=this.textblockFromContext();t&&this.enterInner(t)}if(this.findPlace(t)){this.closeExtra();let e=this.top;e.applyPending(t.type),e.match&&(e.match=e.match.matchType(t.type));let n=e.activeMarks;for(let r=0;r<t.marks.length;r++)e.type&&!e.type.allowsMarkType(t.marks[r].type)||(n=t.marks[r].addToSet(n));return e.content.push(t.mark(n)),!0}return!1}enter(t,e,n){let r=this.findPlace(t.create(e));return r&&this.enterInner(t,e,!0,n),r}enterInner(t,e=null,n=!1,r){this.closeExtra();let i=this.top;i.applyPending(t),i.match=i.match&&i.match.matchType(t);let o=Ht(t,r,i.options);i.options&jt&&0==i.content.length&&(o|=jt),this.nodes.push(new qt(t,e,i.activeMarks,i.pendingMarks,n,null,o)),this.open++}closeExtra(t=!1){let e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(t){for(let e=this.open;e>=0;e--)if(this.nodes[e]==t)return this.open=e,!0;return!1}get currentPos(){this.closeExtra();let t=0;for(let e=this.open;e>=0;e--){let n=this.nodes[e].content;for(let e=n.length-1;e>=0;e--)t+=n[e].nodeSize;e&&t++}return t}findAtPoint(t,e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==t&&this.find[n].offset==e&&(this.find[n].pos=this.currentPos)}findInside(t){if(this.find)for(let e=0;e<this.find.length;e++)null==this.find[e].pos&&1==t.nodeType&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)}findAround(t,e,n){if(t!=e&&this.find)for(let r=0;r<this.find.length;r++)if(null==this.find[r].pos&&1==t.nodeType&&t.contains(this.find[r].node)){e.compareDocumentPosition(this.find[r].node)&(n?2:4)&&(this.find[r].pos=this.currentPos)}}findInText(t){if(this.find)for(let e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))}matchesContext(t){if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);let e=t.split("/"),n=this.options.context,r=!(this.isOpen||n&&n.parent.type!=this.nodes[0].type),i=-(n?n.depth+1:0)+(r?0:1),o=(t,s)=>{for(;t>=0;t--){let a=e[t];if(""==a){if(t==e.length-1||0==t)continue;for(;s>=i;s--)if(o(t-1,s))return!0;return!1}{let t=s>0||0==s&&r?this.nodes[s].type:n&&s>=i?n.node(s-i).type:null;if(!t||t.name!=a&&-1==t.groups.indexOf(a))return!1;s--}}return!0};return o(e.length-1,this.open)}textblockFromContext(){let t=this.options.context;if(t)for(let e=t.depth;e>=0;e--){let n=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let t in this.parser.schema.nodes){let e=this.parser.schema.nodes[t];if(e.isTextblock&&e.defaultAttrs)return e}}addPendingMark(t){let e=function(t,e){for(let n=0;n<e.length;n++)if(t.eq(e[n]))return e[n]}(t,this.top.pendingMarks);e&&this.top.stashMarks.push(e),this.top.pendingMarks=t.addToSet(this.top.pendingMarks)}removePendingMark(t,e){for(let n=this.open;n>=0;n--){let r=this.nodes[n];if(r.pendingMarks.lastIndexOf(t)>-1)r.pendingMarks=t.removeFromSet(r.pendingMarks);else{r.activeMarks=t.removeFromSet(r.activeMarks);let e=r.popFromStashMark(t);e&&r.type&&r.type.allowsMarkType(e.type)&&(r.activeMarks=e.addToSet(r.activeMarks))}if(r==e)break}}}function _t(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function Kt(t){let e={};for(let n in t)e[n]=t[n];return e}function Ut(t,e){let n=e.schema.nodes;for(let r in n){let i=n[r];if(!i.allowsMarkType(t))continue;let o=[],s=t=>{o.push(t);for(let n=0;n<t.edgeCount;n++){let{type:r,next:i}=t.edge(n);if(r==e)return!0;if(o.indexOf(i)<0&&s(i))return!0}};if(s(i.contentMatch))return!0}}class Vt{constructor(t,e){this.nodes=t,this.marks=e}serializeFragment(t,e={},n){n||(n=Qt(e).createDocumentFragment());let r=n,i=[];return t.forEach((t=>{if(i.length||t.marks.length){let n=0,o=0;for(;n<i.length&&o<t.marks.length;){let e=t.marks[o];if(this.marks[e.type.name]){if(!e.eq(i[n][0])||!1===e.type.spec.spanning)break;n++,o++}else o++}for(;n<i.length;)r=i.pop()[1];for(;o<t.marks.length;){let n=t.marks[o++],s=this.serializeMark(n,t.isInline,e);s&&(i.push([n,r]),r.appendChild(s.dom),r=s.contentDOM||s.dom)}}r.appendChild(this.serializeNodeInner(t,e))})),n}serializeNodeInner(t,e){let{dom:n,contentDOM:r}=Vt.renderSpec(Qt(e),this.nodes[t.type.name](t));if(r){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(t.content,e,r)}return n}serializeNode(t,e={}){let n=this.serializeNodeInner(t,e);for(let r=t.marks.length-1;r>=0;r--){let i=this.serializeMark(t.marks[r],t.isInline,e);i&&((i.contentDOM||i.dom).appendChild(n),n=i.dom)}return n}serializeMark(t,e,n={}){let r=this.marks[t.type.name];return r&&Vt.renderSpec(Qt(n),r(t,e))}static renderSpec(t,e,n=null){if("string"==typeof e)return{dom:t.createTextNode(e)};if(null!=e.nodeType)return{dom:e};if(e.dom&&null!=e.dom.nodeType)return e;let r,i=e[0],o=i.indexOf(" ");o>0&&(n=i.slice(0,o),i=i.slice(o+1));let s=n?t.createElementNS(n,i):t.createElement(i),a=e[1],l=1;if(a&&"object"==typeof a&&null==a.nodeType&&!Array.isArray(a)){l=2;for(let t in a)if(null!=a[t]){let e=t.indexOf(" ");e>0?s.setAttributeNS(t.slice(0,e),t.slice(e+1),a[t]):s.setAttribute(t,a[t])}}for(let i=l;i<e.length;i++){let o=e[i];if(0===o){if(i<e.length-1||i>l)throw new RangeError("Content hole must be the only child of its parent node");return{dom:s,contentDOM:s}}{let{dom:e,contentDOM:i}=Vt.renderSpec(t,o,n);if(s.appendChild(e),i){if(r)throw new RangeError("Multiple content holes");r=i}}}return{dom:s,contentDOM:r}}static fromSchema(t){return t.cached.domSerializer||(t.cached.domSerializer=new Vt(this.nodesFromSchema(t),this.marksFromSchema(t)))}static nodesFromSchema(t){let e=Gt(t.nodes);return e.text||(e.text=t=>t.text),e}static marksFromSchema(t){return Gt(t.marks)}}function Gt(t){let e={};for(let n in t){let r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function Qt(t){return t.document||window.document}const Xt=65535,Yt=Math.pow(2,16);function Zt(t){return t&Xt}class te{constructor(t,e,n){this.pos=t,this.delInfo=e,this.recover=n}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}}class ee{constructor(t,e=!1){if(this.ranges=t,this.inverted=e,!t.length&&ee.empty)return ee.empty}recover(t){let e=0,n=Zt(t);if(!this.inverted)for(let t=0;t<n;t++)e+=this.ranges[3*t+2]-this.ranges[3*t+1];return this.ranges[3*n]+e+function(t){return(t-(t&Xt))/Yt}(t)}mapResult(t,e=1){return this._map(t,e,!1)}map(t,e=1){return this._map(t,e,!0)}_map(t,e,n){let r=0,i=this.inverted?2:1,o=this.inverted?1:2;for(let s=0;s<this.ranges.length;s+=3){let a=this.ranges[s]-(this.inverted?r:0);if(a>t)break;let l=this.ranges[s+i],h=this.ranges[s+o],c=a+l;if(t<=c){let i=a+r+((l?t==a?-1:t==c?1:e:e)<0?0:h);if(n)return i;let o=t==(e<0?a:c)?null:s/3+(t-a)*Yt,u=t==a?2:t==c?1:4;return(e<0?t!=a:t!=c)&&(u|=8),new te(i,u,o)}r+=h-l}return n?t+r:new te(t+r,0,null)}touches(t,e){let n=0,r=Zt(e),i=this.inverted?2:1,o=this.inverted?1:2;for(let e=0;e<this.ranges.length;e+=3){let s=this.ranges[e]-(this.inverted?n:0);if(s>t)break;let a=this.ranges[e+i];if(t<=s+a&&e==3*r)return!0;n+=this.ranges[e+o]-a}return!1}forEach(t){let e=this.inverted?2:1,n=this.inverted?1:2;for(let r=0,i=0;r<this.ranges.length;r+=3){let o=this.ranges[r],s=o-(this.inverted?i:0),a=o+(this.inverted?0:i),l=this.ranges[r+e],h=this.ranges[r+n];t(s,s+l,a,a+h),i+=h-l}}invert(){return new ee(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(t){return 0==t?ee.empty:new ee(t<0?[0,-t,0]:[0,0,t])}}ee.empty=new ee([]);const ne=Object.create(null);class re{getMap(){return ee.empty}merge(t){return null}static fromJSON(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=ne[e.stepType];if(!n)throw new RangeError(`No step type ${e.stepType} defined`);return n.fromJSON(t,e)}static jsonID(t,e){if(t in ne)throw new RangeError("Duplicate use of step JSON ID "+t);return ne[t]=e,e.prototype.jsonID=t,e}}class ie{constructor(t,e){this.doc=t,this.failed=e}static ok(t){return new ie(t,null)}static fail(t){return new ie(null,t)}static fromReplace(t,e,n,r){try{return ie.ok(t.replace(e,n,r))}catch(t){if(t instanceof mt)return ie.fail(t.message);throw t}}}function oe(t,e,n){let r=[];for(let i=0;i<t.childCount;i++){let o=t.child(i);o.content.size&&(o=o.copy(oe(o.content,e,o))),o.isInline&&(o=e(o,n,i)),r.push(o)}return ct.fromArray(r)}class se extends re{constructor(t,e,n){super(),this.from=t,this.to=e,this.mark=n}apply(t){let e=t.slice(this.from,this.to),n=t.resolve(this.from),r=n.node(n.sharedDepth(this.to)),i=new gt(oe(e.content,((t,e)=>t.isAtom&&e.type.allowsMarkType(this.mark.type)?t.mark(this.mark.addToSet(t.marks)):t),r),e.openStart,e.openEnd);return ie.fromReplace(t,this.from,this.to,i)}invert(){return new ae(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deleted&&n.deleted||e.pos>=n.pos?null:new se(e.pos,n.pos,this.mark)}merge(t){return t instanceof se&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new se(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new se(e.from,e.to,t.markFromJSON(e.mark))}}re.jsonID("addMark",se);class ae extends re{constructor(t,e,n){super(),this.from=t,this.to=e,this.mark=n}apply(t){let e=t.slice(this.from,this.to),n=new gt(oe(e.content,(t=>t.mark(this.mark.removeFromSet(t.marks))),t),e.openStart,e.openEnd);return ie.fromReplace(t,this.from,this.to,n)}invert(){return new se(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deleted&&n.deleted||e.pos>=n.pos?null:new ae(e.pos,n.pos,this.mark)}merge(t){return t instanceof ae&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new ae(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new ae(e.from,e.to,t.markFromJSON(e.mark))}}re.jsonID("removeMark",ae);class le extends re{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return ie.fail("No node at mark step's position");let n=e.type.create(e.attrs,null,this.mark.addToSet(e.marks));return ie.fromReplace(t,this.pos,this.pos+1,new gt(ct.from(n),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);if(e){let t=this.mark.addToSet(e.marks);if(t.length==e.marks.length){for(let n=0;n<e.marks.length;n++)if(!e.marks[n].isInSet(t))return new le(this.pos,e.marks[n]);return new le(this.pos,this.mark)}}return new he(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new le(e.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if("number"!=typeof e.pos)throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new le(e.pos,t.markFromJSON(e.mark))}}re.jsonID("addNodeMark",le);class he extends re{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return ie.fail("No node at mark step's position");let n=e.type.create(e.attrs,null,this.mark.removeFromSet(e.marks));return ie.fromReplace(t,this.pos,this.pos+1,new gt(ct.from(n),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);return e&&this.mark.isInSet(e.marks)?new le(this.pos,this.mark):this}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new he(e.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if("number"!=typeof e.pos)throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new he(e.pos,t.markFromJSON(e.mark))}}re.jsonID("removeNodeMark",he);class ce extends re{constructor(t,e,n,r=!1){super(),this.from=t,this.to=e,this.slice=n,this.structure=r}apply(t){return this.structure&&pe(t,this.from,this.to)?ie.fail("Structure replace would overwrite content"):ie.fromReplace(t,this.from,this.to,this.slice)}getMap(){return new ee([this.from,this.to-this.from,this.slice.size])}invert(t){return new ce(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deletedAcross&&n.deletedAcross?null:new ce(e.pos,Math.max(e.pos,n.pos),this.slice)}merge(t){if(!(t instanceof ce)||t.structure||this.structure)return null;if(this.from+this.slice.size!=t.from||this.slice.openEnd||t.slice.openStart){if(t.to!=this.from||this.slice.openStart||t.slice.openEnd)return null;{let e=this.slice.size+t.slice.size==0?gt.empty:new gt(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new ce(t.from,this.to,e,this.structure)}}{let e=this.slice.size+t.slice.size==0?gt.empty:new gt(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new ce(this.from,this.to+(t.to-t.from),e,this.structure)}}toJSON(){let t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new ce(e.from,e.to,gt.fromJSON(t,e.slice),!!e.structure)}}re.jsonID("replace",ce);class ue extends re{constructor(t,e,n,r,i,o,s=!1){super(),this.from=t,this.to=e,this.gapFrom=n,this.gapTo=r,this.slice=i,this.insert=o,this.structure=s}apply(t){if(this.structure&&(pe(t,this.from,this.gapFrom)||pe(t,this.gapTo,this.to)))return ie.fail("Structure gap-replace would overwrite content");let e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return ie.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,e.content);return n?ie.fromReplace(t,this.from,this.to,n):ie.fail("Content does not fit in gap")}getMap(){return new ee([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let e=this.gapTo-this.gapFrom;return new ue(this.from,this.from+this.slice.size+e,this.from+this.insert,this.from+this.insert+e,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1),r=t.map(this.gapFrom,-1),i=t.map(this.gapTo,1);return e.deletedAcross&&n.deletedAcross||r<e.pos||i>n.pos?null:new ue(e.pos,n.pos,r,i,this.slice,this.insert,this.structure)}toJSON(){let t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to||"number"!=typeof e.gapFrom||"number"!=typeof e.gapTo||"number"!=typeof e.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new ue(e.from,e.to,e.gapFrom,e.gapTo,gt.fromJSON(t,e.slice),e.insert,!!e.structure)}}function pe(t,e,n){let r=t.resolve(e),i=n-e,o=r.depth;for(;i>0&&o>0&&r.indexAfter(o)==r.node(o).childCount;)o--,i--;if(i>0){let t=r.node(o).maybeChild(r.indexAfter(o));for(;i>0;){if(!t||t.isLeaf)return!0;t=t.firstChild,i--}}return!1}re.jsonID("replaceAround",ue);class fe extends re{constructor(t,e,n){super(),this.pos=t,this.attr=e,this.value=n}apply(t){let e=t.nodeAt(this.pos);if(!e)return ie.fail("No node at attribute step's position");let n=Object.create(null);for(let t in e.attrs)n[t]=e.attrs[t];n[this.attr]=this.value;let r=e.type.create(n,null,e.marks);return ie.fromReplace(t,this.pos,this.pos+1,new gt(ct.from(r),0,e.isLeaf?0:1))}getMap(){return ee.empty}invert(t){return new fe(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new fe(e.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,e){if("number"!=typeof e.pos||"string"!=typeof e.attr)throw new RangeError("Invalid input for AttrStep.fromJSON");return new fe(e.pos,e.attr,e.value)}}re.jsonID("attr",fe);let de=class extends Error{};de=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n},(de.prototype=Object.create(Error.prototype)).constructor=de,de.prototype.name="TransformError";const me=Object.create(null);class ge{constructor(t,e,n){this.$anchor=t,this.$head=e,this.ranges=n||[new ye(t.min(e),t.max(e))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let t=this.ranges;for(let e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(t,e=gt.empty){let n=e.content.lastChild,r=null;for(let t=0;t<e.openEnd;t++)r=n,n=n.lastChild;let i=t.steps.length,o=this.ranges;for(let s=0;s<o.length;s++){let{$from:a,$to:l}=o[s],h=t.mapping.slice(i);t.replaceRange(h.map(a.pos),h.map(l.pos),s?gt.empty:e),0==s&&Ne(t,i,(n?n.isInline:r&&r.isTextblock)?-1:1)}}replaceWith(t,e){let n=t.steps.length,r=this.ranges;for(let i=0;i<r.length;i++){let{$from:o,$to:s}=r[i],a=t.mapping.slice(n),l=a.map(o.pos),h=a.map(s.pos);i?t.deleteRange(l,h):(t.replaceRangeWith(l,h,e),Ne(t,n,e.isInline?-1:1))}}static findFrom(t,e,n=!1){let r=t.parent.inlineContent?new ve(t):Te(t.node(0),t.parent,t.pos,t.index(),e,n);if(r)return r;for(let r=t.depth-1;r>=0;r--){let i=e<0?Te(t.node(0),t.node(r),t.before(r+1),t.index(r),e,n):Te(t.node(0),t.node(r),t.after(r+1),t.index(r)+1,e,n);if(i)return i}return null}static near(t,e=1){return this.findFrom(t,e)||this.findFrom(t,-e)||new Me(t.node(0))}static atStart(t){return Te(t,t,0,0,1)||new Me(t)}static atEnd(t){return Te(t,t,t.content.size,t.childCount,-1)||new Me(t)}static fromJSON(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=me[e.type];if(!n)throw new RangeError(`No selection type ${e.type} defined`);return n.fromJSON(t,e)}static jsonID(t,e){if(t in me)throw new RangeError("Duplicate use of selection JSON ID "+t);return me[t]=e,e.prototype.jsonID=t,e}getBookmark(){return ve.between(this.$anchor,this.$head).getBookmark()}}ge.prototype.visible=!0;class ye{constructor(t,e){this.$from=t,this.$to=e}}let ke=!1;function we(t){ke||t.parent.inlineContent||(ke=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class ve extends ge{constructor(t,e=t){we(t),we(e),super(t,e)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(t,e){let n=t.resolve(e.map(this.head));if(!n.parent.inlineContent)return ge.near(n);let r=t.resolve(e.map(this.anchor));return new ve(r.parent.inlineContent?r:n,n)}replace(t,e=gt.empty){if(super.replace(t,e),e==gt.empty){let e=this.$from.marksAcross(this.$to);e&&t.ensureMarks(e)}}eq(t){return t instanceof ve&&t.anchor==this.anchor&&t.head==this.head}getBookmark(){return new xe(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(t,e){if("number"!=typeof e.anchor||"number"!=typeof e.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new ve(t.resolve(e.anchor),t.resolve(e.head))}static create(t,e,n=e){let r=t.resolve(e);return new this(r,n==e?r:t.resolve(n))}static between(t,e,n){let r=t.pos-e.pos;if(n&&!r||(n=r>=0?1:-1),!e.parent.inlineContent){let t=ge.findFrom(e,n,!0)||ge.findFrom(e,-n,!0);if(!t)return ge.near(e,n);e=t.$head}return t.parent.inlineContent||(0==r||(t=(ge.findFrom(t,-n,!0)||ge.findFrom(t,n,!0)).$anchor).pos<e.pos!=r<0)&&(t=e),new ve(t,e)}}ge.jsonID("text",ve);class xe{constructor(t,e){this.anchor=t,this.head=e}map(t){return new xe(t.map(this.anchor),t.map(this.head))}resolve(t){return ve.between(t.resolve(this.anchor),t.resolve(this.head))}}class Se extends ge{constructor(t){let e=t.nodeAfter,n=t.node(0).resolve(t.pos+e.nodeSize);super(t,n),this.node=e}map(t,e){let{deleted:n,pos:r}=e.mapResult(this.anchor),i=t.resolve(r);return n?ge.near(i):new Se(i)}content(){return new gt(ct.from(this.node),0,0)}eq(t){return t instanceof Se&&t.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new be(this.anchor)}static fromJSON(t,e){if("number"!=typeof e.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new Se(t.resolve(e.anchor))}static create(t,e){return new Se(t.resolve(e))}static isSelectable(t){return!t.isText&&!1!==t.type.spec.selectable}}Se.prototype.visible=!1,ge.jsonID("node",Se);class be{constructor(t){this.anchor=t}map(t){let{deleted:e,pos:n}=t.mapResult(this.anchor);return e?new xe(n,n):new be(n)}resolve(t){let e=t.resolve(this.anchor),n=e.nodeAfter;return n&&Se.isSelectable(n)?new Se(e):ge.near(e)}}class Me extends ge{constructor(t){super(t.resolve(0),t.resolve(t.content.size))}replace(t,e=gt.empty){if(e==gt.empty){t.delete(0,t.doc.content.size);let e=ge.atStart(t.doc);e.eq(t.selection)||t.setSelection(e)}else super.replace(t,e)}toJSON(){return{type:"all"}}static fromJSON(t){return new Me(t)}map(t){return new Me(t)}eq(t){return t instanceof Me}getBookmark(){return Oe}}ge.jsonID("all",Me);const Oe={map(){return this},resolve:t=>new Me(t)};function Te(t,e,n,r,i,o=!1){if(e.inlineContent)return ve.create(t,n);for(let s=r-(i>0?0:1);i>0?s<e.childCount:s>=0;s+=i){let r=e.child(s);if(r.isAtom){if(!o&&Se.isSelectable(r))return Se.create(t,n-(i<0?r.nodeSize:0))}else{let e=Te(t,r,n+i,i<0?r.childCount:0,i,o);if(e)return e}n+=r.nodeSize*i}return null}function Ne(t,e,n){let r=t.steps.length-1;if(r<e)return;let i,o=t.steps[r];(o instanceof ce||o instanceof ue)&&(t.mapping.maps[r].forEach(((t,e,n,r)=>{null==i&&(i=r)})),t.setSelection(ge.near(t.doc.resolve(i),n)))}function Ee(t,e){return e&&t?t.bind(e):t}class Ce{constructor(t,e,n){this.name=t,this.init=Ee(e.init,n),this.apply=Ee(e.apply,n)}}function Ae(t,e,n){for(let r in t){let i=t[r];i instanceof Function?i=i.bind(e):"handleDOMEvents"==r&&(i=Ae(i,e,{})),n[r]=i}return n}new Ce("doc",{init:t=>t.doc||t.schema.topNodeType.createAndFill(),apply:t=>t.doc}),new Ce("selection",{init:(t,e)=>t.selection||ge.atStart(e.doc),apply:t=>t.selection}),new Ce("storedMarks",{init:t=>t.storedMarks||null,apply:(t,e,n,r)=>r.selection.$cursor?t.storedMarks:null}),new Ce("scrollToSelection",{init:()=>0,apply:(t,e)=>t.scrolledIntoView?e+1:e});class ze{constructor(t){this.spec=t,this.props={},t.props&&Ae(t.props,this,this.props),this.key=t.key?t.key.key:Re("plugin")}getState(t){return t[this.key]}}const Ie=Object.create(null);function Re(t){return t in Ie?t+"$"+ ++Ie[t]:(Ie[t]=0,t+"$")}class Je{constructor(t="key"){this.key=Re(t)}get(t){return t.config.pluginsByKey[this.key]}getState(t){return t[this.key]}}var Fe=v.create({name:"figureAudio",group:"block",content:"inline*",draggable:!0,isolating:!0,addAttributes:function(){return{src:{default:null,parseHTML:function(t){var e;return null===(e=t.querySelector("source"))||void 0===e?void 0:e.getAttribute("src")}},title:{default:"",parseHTML:function(t){var e;return null===(e=t.querySelector(".title"))||void 0===e?void 0:e.textContent}},duration:{default:"00:00",parseHTML:function(t){var e,n=t.querySelector(".duration");return null===(e=null==n?void 0:n.dataset)||void 0===e?void 0:e.time}}}},parseHTML:function(){return[{tag:'figure[class="audio"]',contentElement:"figcaption"}]},renderHTML:function(t){var e=t.HTMLAttributes;return["figure",{class:"audio"},["audio",{controls:!0},["source",{src:e.src,type:"audio/mp3",draggable:!1,contenteditable:!1}]],["div",{class:"player"},["header",["div",{class:"meta"},["h4",{class:"title"},e.title],["div",{class:"time"},["span",{class:"current","data-time":"00:00"}],["span",{class:"duration","data-time":e.duration}]]],["span",{class:"play"}]],["footer",["div",{class:"progress-bar"},["span",{}]]]],["figcaption",0]]},addCommands:function(){var t=this;return{setFigureAudio:function(e){var n=e.caption,r=it(e,["caption"]);return function(e){return(0,e.chain)().insertContent({type:t.name,attrs:r,content:n?[{type:"text",text:n}]:[]}).command((function(t){var e=t.tr,n=t.commands,r=e.doc,i=e.selection,o=r.resolve(i.to-2).end();return n.setTextSelection(o)})).run()}}}},addProseMirrorPlugins:function(){return[new ze({key:new Je("removePastedFigureAudio"),props:{transformPastedHTML:function(t){return t=t.replace(/<figure.*class=.audio.*[\n]*.*?<\/figure>/g,"")}}})]}}),Pe=v.create({name:"figureEmbed",group:"block",content:"inline*",draggable:!0,isolating:!0,addAttributes:function(){return{class:{default:null,parseHTML:function(t){return t.getAttribute("class")}},src:{default:null,parseHTML:function(t){var e;return null===(e=t.querySelector("iframe"))||void 0===e?void 0:e.getAttribute("src")}}}},parseHTML:function(){return[{tag:'figure[class^="embed"]',contentElement:"figcaption"}]},renderHTML:function(t){var e=function(t){var e,n={url:"",allowfullscreen:!1,sandbox:[]};try{e=new URL(t)}catch(t){return n}var r=e.hostname,i=e.pathname,o=e.searchParams;if(["youtube.com","youtu.be","www.youtu.be","www.youtube.com"].includes(r)){var s=o.get("v"),a=o.get("t"),l=new URLSearchParams(rt({rel:"0"},a?{start:a}:{})).toString(),h="";return s?h=s:i.match("/embed/")?h=i.split("/embed/")[1]:r.includes("youtu.be")&&(h=i.split("/")[1]),{url:"https://www.youtube.com/embed/".concat(h)+(l?"?=".concat(l):""),provider:"youtube",allowfullscreen:!0,sandbox:[]}}if(["vimeo.com","www.vimeo.com","player.vimeo.com"].includes(r))return h=i.replace(/\/$/,"").split("/").slice(-1)[0],{url:"https://player.vimeo.com/video/".concat(h),provider:"vimeo",allowfullscreen:!0,sandbox:[]};if(["bilibili.com","player.bilibili.com","www.bilibili.com"].includes(r)){return h="",h=o.get("bvid")||i.replace(/\/$/,"").split("/").slice(-1)[0],{url:"https://player.bilibili.com/player.html?bvid=".concat(h),provider:"bilibili",allowfullscreen:!0,sandbox:[]}}if(["instagram.com","www.instagram.com"].includes(r))return h=i.replace("/embed","").replace(/\/$/,"").split("/").slice(-1)[0],{url:"https://www.instagram.com/p/".concat(h,"/embed"),provider:"instagram",allowfullscreen:!1,sandbox:[]};if(["jsfiddle.net","www.jsfiddle.net"].includes(r)){var c=i.replace("/embedded","").replace(/\/$/,"").split("/").filter(Boolean);return h=1===c.length?c[0]:c[1],{url:"https://jsfiddle.net/".concat(h,"/embedded/"),provider:"jsfiddle",allowfullscreen:!1,sandbox:[]}}if(["codepen.io","www.codepen.io"].includes(r)){var u=i.split("/")[1];return h=i.replace(/\/$/,"").split("/").slice(-1)[0],{url:"https://codepen.io/".concat(u,"/embed/preview/").concat(h),provider:"codepen",allowfullscreen:!1,sandbox:[]}}return n}(t.HTMLAttributes.src),n=e.url,r=e.provider,i=e.allowfullscreen,o=e.sandbox;return["figure",rt({class:"embed"},r?{"data-provider":r}:{}),["div",{class:"iframe-container"},["iframe",rt(rt(rt({src:n,loading:"lazy"},o&&o.length>0?{sandbox:o.join(" ")}:{}),i?{allowfullscreen:!0}:{}),{frameborder:"0",draggable:!1,contenteditable:!1})]],["figcaption",0]]},addCommands:function(){var t=this;return{setFigureEmbed:function(e){var n=e.caption,r=it(e,["caption"]);return function(e){return(0,e.chain)().insertContent({type:t.name,attrs:r,content:n?[{type:"text",text:n}]:[]}).command((function(t){var e=t.tr,n=t.commands,r=e.doc,i=e.selection,o=r.resolve(i.to-2).end();return n.setTextSelection(o)})).run()}}}},addProseMirrorPlugins:function(){return[new ze({key:new Je("removePastedFigureEmbed"),props:{transformPastedHTML:function(t){return t=t.replace(/<figure.*class=.embed.*[\n]*.*?<\/figure>/g,"")}}})]}}),Le=v.create({name:"figureImage",group:"block",content:"inline*",draggable:!0,isolating:!0,addAttributes:function(){return{class:{default:null,parseHTML:function(t){return t.getAttribute("class")}},src:{default:null,parseHTML:function(t){var e;return null===(e=t.querySelector("img"))||void 0===e?void 0:e.getAttribute("src")}}}},parseHTML:function(){return[{tag:'figure[class="image"]',contentElement:"figcaption"}]},renderHTML:function(t){return["figure",{class:"image"},["img",{src:t.HTMLAttributes.src,draggable:!1,contenteditable:!1}],["figcaption",0]]},addCommands:function(){var t=this;return{setFigureImage:function(e){var n=e.caption,r=it(e,["caption"]);return function(e){return(0,e.chain)().insertContent({type:t.name,attrs:r,content:n?[{type:"text",text:n}]:[]}).command((function(t){var e=t.tr,n=t.commands,r=e.doc,i=e.selection,o=r.resolve(i.to-2).end();return n.setTextSelection(o)})).run()}}}},addProseMirrorPlugins:function(){return[new ze({key:new Je("removePastedFigureImage"),props:{transformPastedHTML:function(t){return t=t.replace(/<figure.*class=.image.*[\n]*.*?<\/figure>/g,"")}}})]}});var $e=T.create({name:"link",keepOnSplit:!1,onCreate:function(){this.options.protocols.forEach((function(t){"string"!=typeof t?I(t.scheme,t.optionalSlashes):I(t)}))},onDestroy:function(){R()},inclusive:function(){return this.options.autolink},addOptions:function(){return{openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},validate:void 0}},addAttributes:function(){return{href:{default:null},target:{default:this.options.HTMLAttributes.target},class:{default:this.options.HTMLAttributes.class}}},parseHTML:function(){return[{tag:'a[href]:not([href *= "javascript:" i]):not([class="mention"])'}]},renderHTML:function(t){var e=t.HTMLAttributes;return["a",N(this.options.HTMLAttributes,e),0]},addCommands:function(){var t=this;return{setLink:function(e){return function(n){return(0,n.chain)().setMark(t.name,e).setMeta("preventAutolink",!0).run()}},toggleLink:function(e){return function(n){return(0,n.chain)().toggleMark(t.name,e,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},unsetLink:function(){return function(e){return(0,e.chain)().unsetMark(t.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}}}},addPasteRules:function(){var t=this;return[E({find:function(e){return z(e).filter((function(e){return!t.options.validate||t.options.validate(e.value)})).filter((function(t){return t.isLink})).map((function(t){return{text:t.value,index:t.start,data:t}}))},type:this.type,getAttributes:function(t){var e;return{href:null===(e=t.data)||void 0===e?void 0:e.href}}})]},addProseMirrorPlugins:function(){var t,e=[];return this.options.autolink&&e.push((t={type:this.type,validate:this.options.validate},new ze({key:new Je("autolink"),appendTransaction:function(e,n,r){var i=e.some((function(t){return t.docChanged}))&&!n.doc.eq(r.doc),o=e.some((function(t){return t.getMeta("preventAutolink")}));if(i&&!o){var s=r.tr,a=x(n.doc,at([],e,!0)),l=a.mapping;if(S(a).forEach((function(e){var i=e.oldRange,o=e.newRange;b(i.from,i.to,n.doc).filter((function(e){return e.mark.type===t.type})).forEach((function(e){var i=l.map(e.from),o=l.map(e.to),a=b(i,o,r.doc).filter((function(e){return e.mark.type===t.type}));if(a.length){var h=a[0],c=n.doc.textBetween(e.from,e.to,void 0," "),u=r.doc.textBetween(h.from,h.to,void 0," "),p=A(c),f=A(u);p&&!f&&s.removeMark(h.from,h.to,t.type)}}));var a,h,c=M(r.doc,o,(function(t){return t.isTextblock}));if(c.length>1?(a=c[0],h=r.doc.textBetween(a.pos,a.pos+a.node.nodeSize,void 0," ")):c.length&&r.doc.textBetween(o.from,o.to," "," ").endsWith(" ")&&(a=c[0],h=r.doc.textBetween(a.pos,o.to,void 0," ")),a&&h){var u=h.split(" ").filter((function(t){return""!==t}));if(u.length<=0)return!1;var p=u[u.length-1],f=a.pos+h.lastIndexOf(p);if(!p)return!1;z(p).filter((function(t){return t.isLink})).filter((function(e){return!t.validate||t.validate(e.value)})).map((function(t){return rt(rt({},t),{from:f+t.start+1,to:f+t.end+1})})).forEach((function(e){s.addMark(e.from,e.to,t.type.create({href:e.href}))}))}})),s.steps.length)return s}}}))),this.options.openOnClick&&e.push(function(t){return new ze({key:new Je("handleClickLink"),props:{handleClick:function(e,n,r){var i,o,s;if(1!==r.button)return!1;var a=O(e.state,t.type.name),l=null===(i=r.target)||void 0===i?void 0:i.closest("a"),h=null!==(o=null==l?void 0:l.href)&&void 0!==o?o:a.href,c=null!==(s=null==l?void 0:l.target)&&void 0!==s?s:a.target;return!(!l||!h||(window.open(h,c),0))}}})}({type:this.type})),this.options.linkOnPaste&&e.push(function(t){return new ze({key:new Je("handlePasteLink"),props:{handlePaste:function(e,n,r){if(e.state.selection.empty)return!1;var i="";r.content.forEach((function(t){i+=t.textContent}));var o=z(i).find((function(t){return t.isLink&&t.value===i}));return!(!i||!o||(t.editor.commands.setMark(t.type,{href:o.href}),0))}}})}({editor:this.editor,type:this.type})),e}}),Be=new Je("mention"),De=v.create({name:"mention",group:"inline",inline:!0,selectable:!1,atom:!0,addOptions:function(){var t=this;return{suggestion:{char:"@",allowedPrefixes:null,pluginKey:Be,command:function(e){var n,r,i,o=e.editor,s=e.range,a=e.props,l=o.view.state.selection,h=l.$from,c=l.$to,u=1===h.parentOffset,p=c.nodeBefore,f=c.nodeAfter,d=null===(n=null==p?void 0:p.text)||void 0===n?void 0:n.startsWith(" "),m=null===(r=null==f?void 0:f.text)||void 0===r?void 0:r.startsWith(" "),g=[];u||d||g.push({type:"text",text:" "}),g.push({type:t.name,attrs:a}),m||g.push({type:"text",text:" "}),o.chain().focus().insertContentAt(s,g).run(),null===(i=window.getSelection())||void 0===i||i.collapseToEnd()},allow:function(e){var n=e.state,r=e.range,i=n.doc.resolve(r.from),o=n.schema.nodes[t.name];return!!i.parent.type.contentMatch.matchType(o)}}}},addAttributes:function(){return{id:{default:null,parseHTML:function(t){return t.getAttribute("data-id")}},userName:{default:null,parseHTML:function(t){return t.getAttribute("data-user-name")}},displayName:{default:null,parseHTML:function(t){return t.getAttribute("data-display-name")}}}},parseHTML:function(){return[{tag:'a[class="mention"]'}]},renderHTML:function(t){var e,n=t.node;return["a",{class:"mention",href:"/"+this.options.suggestion.char+n.attrs.userName,"data-id":n.attrs.id,"data-user-name":n.attrs.userName,"data-display-name":n.attrs.displayName,ref:"noopener noreferrer nofollow"},["span","@".concat(null!==(e=n.attrs.displayName)&&void 0!==e?e:n.attrs.userName)]]},addKeyboardShortcuts:function(){var t=this;return{Backspace:function(){return t.editor.commands.command((function(e){var n=e.tr,r=e.state,i=!1,o=r.selection,s=o.empty,a=o.anchor;return!!s&&(r.doc.nodesBetween(a-1,a,(function(e,r){if(e.type.name===t.name)return i=!0,n.insertText(t.options.suggestion.char||"",r,r+e.nodeSize),!1})),i)}))}}},addProseMirrorPlugins:function(){return[J(rt({editor:this.editor},this.options.suggestion))]}}),je=function(t){var v=t.placeholder,x=t.mentionSuggestion;return[s,c,a,y.configure({placeholder:v}),w,g,h.configure({levels:[2,3]}),n,k,p,u,i,o,e,l,f,m,d,r,$e,Le,Fe,Pe,De.configure({suggestion:x})]},He=function(e){var n=e.content,r=e.placeholder,i=e.mentionSuggestion,o=it(e,["content","placeholder","mentionSuggestion"]);return t(rt({extensions:je({placeholder:r,mentionSuggestion:i}),content:n},o))},qe=function(t){var a=t.placeholder,h=t.mentionSuggestion;return[s,c,y.configure({placeholder:a}),w,g,n,k,p,u,i,o,e,l,f,d,m,r,$e,De.configure({suggestion:h})]},We=function(e){var n=e.content,r=e.placeholder,i=e.mentionSuggestion,o=it(e,["content","placeholder","mentionSuggestion"]);return t(rt({extensions:qe({placeholder:r,mentionSuggestion:i}),content:n},o))};var _e=function(t){void 0===t&&(t={});var e=this.data(),n=function(t,n){(e[t]?e[t]:e[t]=[]).push(n)};n("micromarkExtensions",function(t){return B([D(t)])}(t)),n("fromMarkdownExtensions",[j]),n("toMarkdownExtensions",{extensions:[H]})},Ke={fragment:!0},Ue={handlers:{figure:function(t,e){return t(e,"html",K(e,{closeSelfClosing:!1,closeEmptyElements:!0}))}}},Ve={closeSelfClosing:!1,closeEmptyElements:!0},Ge={rewrite:function(t,e,n){"element"==t.type&&"a"==t.tagName&&t.properties&&(t.properties.target="_blank",t.properties.rel="noopener noreferrer nofollow"),"element"==t.type&&"del"==t.tagName&&(t.tagName="s"),"element"==t.type&&"u"==t.tagName&&(t.tagName="strong")}},Qe={tagNames:at(at([],_.tagNames,!0),["iframe","footer","header","audio","source"],!1),protocols:rt(rt({},_.protocols),{href:["http","https","mailto","tel"]}),attributes:rt(rt({},_.attributes),{a:["href","ref","target"],img:["src","srcSet","data*"],audio:["controls","data*",["preload","metadata"]],source:["src","type","data*"],figure:[["className","image","audio","embed-code","embed-video"]],div:[["className","player","progress-bar","meta","time","iframe-container"],"data*"],h4:[["className","title"]],span:[["className","play","current","duration"],"data*"],iframe:["src","allowFullScreen",["loading","lazy"],["frameBorder","0"],["sandbox","allow-scripts","allow-same-origin","allow-popups"]]})},Xe=F().use(P,Ke).use(q,Ge).use(L,Ue).use(_e).use($,{bullet:"*",listItemIndent:"one",rule:"-",emphasis:"_"}),Ye=function(t){return ot(void 0,void 0,void 0,(function(){var e;return st(this,(function(n){switch(n.label){case 0:return[4,Xe.process(t)];case 1:return e=n.sent(),[2,String(e)]}}))}))},Ze=F().use(U).use(Z).use(tt).use(Y).use(_e).use(V,{allowDangerousHtml:!0}).use(q,Ge).use(Q).use(W,Qe).use(X).use(G,Ve),tn=function(t){return ot(void 0,void 0,void 0,(function(){var e;return st(this,(function(n){switch(n.label){case 0:return[4,Ze.process(t)];case 1:return e=n.sent(),[2,String(e)]}}))}))},en=F().use(P,Ke).use(Q).use(W,Qe).use(X).use(G,Ve),nn=function(t){return ot(void 0,void 0,void 0,(function(){var e;return st(this,(function(n){switch(n.label){case 0:return[4,en.process(t)];case 1:return e=n.sent(),[2,String(e)]}}))}))},rn=function(t){var e=C(t);return function(t){var n=et(t),r=Ft.fromSchema(e).parse(n).toJSON(),i=Jt.fromJSON(e,r);return Vt.fromSchema(e).serializeFragment(i.content,{document:nt()}).render()}},on=function(t){var e=je({});return rn(e)(t)},sn=function(t){var e=qe({});return rn(e)(t)};export{Ye as html2md,je as makeArticleEditorExtensions,qe as makeCommentEditorExtensions,rn as makeNormalizer,tn as md2html,on as normalizeArticleHTML,sn as normalizeCommentHTML,nn as sanitizeHTML,He as useArticleEdtor,We as useCommentEditor};
