"use strict";var t=require("unified"),e=require("rehype-parse"),n=require("rehype-remark"),r=require("remark-stringify"),i=require("micromark-util-combine-extensions"),s=require("micromark-extension-gfm-strikethrough"),o=require("mdast-util-gfm-strikethrough"),a=require("rehype-rewrite"),l=require("rehype-sanitize"),h=require("hast-util-to-html"),c=require("remark-parse"),u=require("remark-rehype"),p=require("rehype-stringify"),d=require("rehype-raw"),f=require("rehype-format"),m=require("remark-breaks"),g=require("remark-directive"),y=require("remark-directive-rehype"),k=require("@tiptap/core"),w=require("zeed-dom");require("@tiptap/react");var v=require("@tiptap/extension-blockquote"),x=require("@tiptap/extension-bullet-list"),S=require("@tiptap/extension-code"),b=require("@tiptap/extension-code-block"),M=require("@tiptap/extension-document"),T=require("@tiptap/extension-gapcursor"),O=require("@tiptap/extension-hard-break"),N=require("@tiptap/extension-heading"),A=require("@tiptap/extension-history"),C=require("@tiptap/extension-horizontal-rule"),E=require("@tiptap/extension-list-item"),I=require("@tiptap/extension-ordered-list"),z=require("@tiptap/extension-paragraph"),R=require("@tiptap/extension-placeholder"),J=require("@tiptap/extension-strike"),P=require("@tiptap/extension-text"),F=require("linkifyjs"),L=require("@tiptap/suggestion"),q=function(){return q=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},q.apply(this,arguments)};function B(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}function $(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(t){s(t)}}function a(t){try{l(r.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((r=r.apply(t,e||[])).next())}))}function D(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}function H(t,e,n){if(n||2===arguments.length)for(var r,i=0,s=e.length;i<s;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}var j=function(t){void 0===t&&(t={});var e=this.data(),n=function(t,n){(e[t]?e[t]:e[t]=[]).push(n)};n("micromarkExtensions",function(t){return i.combineExtensions([s.gfmStrikethrough(t)])}(t)),n("fromMarkdownExtensions",[o.gfmStrikethroughFromMarkdown]),n("toMarkdownExtensions",{extensions:[o.gfmStrikethroughToMarkdown]})},_={fragment:!0},W={handlers:{figure:function(t,e){return t(e,"html",h.toHtml(e,{closeSelfClosing:!1,closeEmptyElements:!0}))}}},K={closeSelfClosing:!1,closeEmptyElements:!0},U={rewrite:function(t,e,n){"element"==t.type&&"a"==t.tagName&&t.properties&&(t.properties.target="_blank",t.properties.rel="noopener noreferrer nofollow"),"element"==t.type&&"del"==t.tagName&&(t.tagName="s"),"element"==t.type&&"u"==t.tagName&&(t.tagName="strong")}},V={tagNames:H(H([],l.defaultSchema.tagNames,!0),["iframe","footer","header","audio","source"],!1),protocols:q(q({},l.defaultSchema.protocols),{href:["http","https","mailto","tel"]}),attributes:q(q({},l.defaultSchema.attributes),{a:["href","ref","target"],img:["src","srcSet","data*"],audio:["controls","data*",["preload","metadata"]],source:["src","type","data*"],figure:[["className","image","audio","embed-code","embed-video"]],div:[["className","player","progress-bar","meta","time","iframe-container"],"data*"],h4:[["className","title"]],span:[["className","play","current","duration"],"data*"],iframe:["src","allowFullScreen",["loading","lazy"],["frameBorder","0"],["sandbox","allow-scripts","allow-same-origin","allow-popups"]]})},G=t.unified().use(e,_).use(a,U).use(n,W).use(j).use(r,{bullet:"*",listItemIndent:"one",rule:"-",emphasis:"_"}),Q=t.unified().use(c).use(g).use(y).use(m).use(j).use(u,{allowDangerousHtml:!0}).use(a,U).use(d).use(l,V).use(f).use(p,K),X=t.unified().use(e,_).use(d).use(l,V).use(f).use(p,K);function Y(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let i=t.child(r),s=e.child(r);if(i!=s){if(!i.sameMarkup(s))return n;if(i.isText&&i.text!=s.text){for(let t=0;i.text[t]==s.text[t];t++)n++;return n}if(i.content.size||s.content.size){let t=Y(i.content,s.content,n+1);if(null!=t)return t}n+=i.nodeSize}else n+=i.nodeSize}}function Z(t,e,n,r){for(let i=t.childCount,s=e.childCount;;){if(0==i||0==s)return i==s?null:{a:n,b:r};let o=t.child(--i),a=e.child(--s),l=o.nodeSize;if(o!=a){if(!o.sameMarkup(a))return{a:n,b:r};if(o.isText&&o.text!=a.text){let t=0,e=Math.min(o.text.length,a.text.length);for(;t<e&&o.text[o.text.length-t-1]==a.text[a.text.length-t-1];)t++,n--,r--;return{a:n,b:r}}if(o.content.size||a.content.size){let t=Z(o.content,a.content,n-1,r-1);if(t)return t}n-=l,r-=l}else n-=l,r-=l}}class tt{constructor(t,e){if(this.content=t,this.size=e||0,null==e)for(let e=0;e<t.length;e++)this.size+=t[e].nodeSize}nodesBetween(t,e,n,r=0,i){for(let s=0,o=0;o<e;s++){let a=this.content[s],l=o+a.nodeSize;if(l>t&&!1!==n(a,r+o,i||null,s)&&a.content.size){let i=o+1;a.nodesBetween(Math.max(0,t-i),Math.min(a.content.size,e-i),n,r+i)}o=l}}descendants(t){this.nodesBetween(0,this.size,t)}textBetween(t,e,n,r){let i="",s=!0;return this.nodesBetween(t,e,((o,a)=>{o.isText?(i+=o.text.slice(Math.max(t,a)-a,e-a),s=!n):o.isLeaf?(r?i+="function"==typeof r?r(o):r:o.type.spec.leafText&&(i+=o.type.spec.leafText(o)),s=!n):!s&&o.isBlock&&(i+=n,s=!0)}),0),i}append(t){if(!t.size)return this;if(!this.size)return t;let e=this.lastChild,n=t.firstChild,r=this.content.slice(),i=0;for(e.isText&&e.sameMarkup(n)&&(r[r.length-1]=e.withText(e.text+n.text),i=1);i<t.content.length;i++)r.push(t.content[i]);return new tt(r,this.size+t.size)}cut(t,e=this.size){if(0==t&&e==this.size)return this;let n=[],r=0;if(e>t)for(let i=0,s=0;s<e;i++){let o=this.content[i],a=s+o.nodeSize;a>t&&((s<t||a>e)&&(o=o.isText?o.cut(Math.max(0,t-s),Math.min(o.text.length,e-s)):o.cut(Math.max(0,t-s-1),Math.min(o.content.size,e-s-1))),n.push(o),r+=o.nodeSize),s=a}return new tt(n,r)}cutByIndex(t,e){return t==e?tt.empty:0==t&&e==this.content.length?this:new tt(this.content.slice(t,e))}replaceChild(t,e){let n=this.content[t];if(n==e)return this;let r=this.content.slice(),i=this.size+e.nodeSize-n.nodeSize;return r[t]=e,new tt(r,i)}addToStart(t){return new tt([t].concat(this.content),this.size+t.nodeSize)}addToEnd(t){return new tt(this.content.concat(t),this.size+t.nodeSize)}eq(t){if(this.content.length!=t.content.length)return!1;for(let e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(t){let e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e}maybeChild(t){return this.content[t]||null}forEach(t){for(let e=0,n=0;e<this.content.length;e++){let r=this.content[e];t(r,n,e),n+=r.nodeSize}}findDiffStart(t,e=0){return Y(this,t,e)}findDiffEnd(t,e=this.size,n=t.size){return Z(this,t,e,n)}findIndex(t,e=-1){if(0==t)return nt(0,t);if(t==this.size)return nt(this.content.length,t);if(t>this.size||t<0)throw new RangeError(`Position ${t} outside of fragment (${this})`);for(let n=0,r=0;;n++){let i=r+this.child(n).nodeSize;if(i>=t)return i==t||e>0?nt(n+1,i):nt(n,r);r=i}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map((t=>t.toJSON())):null}static fromJSON(t,e){if(!e)return tt.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new tt(e.map(t.nodeFromJSON))}static fromArray(t){if(!t.length)return tt.empty;let e,n=0;for(let r=0;r<t.length;r++){let i=t[r];n+=i.nodeSize,r&&i.isText&&t[r-1].sameMarkup(i)?(e||(e=t.slice(0,r)),e[e.length-1]=i.withText(e[e.length-1].text+i.text)):e&&e.push(i)}return new tt(e||t,n)}static from(t){if(!t)return tt.empty;if(t instanceof tt)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new tt([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}tt.empty=new tt([],0);const et={index:0,offset:0};function nt(t,e){return et.index=t,et.offset=e,et}function rt(t,e){if(t===e)return!0;if(!t||"object"!=typeof t||!e||"object"!=typeof e)return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!rt(t[n],e[n]))return!1}else{for(let n in t)if(!(n in e)||!rt(t[n],e[n]))return!1;for(let n in e)if(!(n in t))return!1}return!0}class it{constructor(t,e){this.type=t,this.attrs=e}addToSet(t){let e,n=!1;for(let r=0;r<t.length;r++){let i=t[r];if(this.eq(i))return t;if(this.type.excludes(i.type))e||(e=t.slice(0,r));else{if(i.type.excludes(this.type))return t;!n&&i.type.rank>this.type.rank&&(e||(e=t.slice(0,r)),e.push(this),n=!0),e&&e.push(i)}}return e||(e=t.slice()),n||e.push(this),e}removeFromSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t}isInSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1}eq(t){return this==t||this.type==t.type&&rt(this.attrs,t.attrs)}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");let n=t.marks[e.type];if(!n)throw new RangeError(`There is no mark type ${e.type} in this schema`);return n.create(e.attrs)}static sameSet(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].eq(e[n]))return!1;return!0}static setFrom(t){if(!t||Array.isArray(t)&&0==t.length)return it.none;if(t instanceof it)return[t];let e=t.slice();return e.sort(((t,e)=>t.type.rank-e.type.rank)),e}}it.none=[];class st extends Error{}class ot{constructor(t,e,n){this.content=t,this.openStart=e,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(t,e){let n=lt(this.content,t+this.openStart,e);return n&&new ot(n,this.openStart,this.openEnd)}removeBetween(t,e){return new ot(at(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)}eq(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t}static fromJSON(t,e){if(!e)return ot.empty;let n=e.openStart||0,r=e.openEnd||0;if("number"!=typeof n||"number"!=typeof r)throw new RangeError("Invalid input for Slice.fromJSON");return new ot(tt.fromJSON(t,e.content),n,r)}static maxOpen(t,e=!0){let n=0,r=0;for(let r=t.firstChild;r&&!r.isLeaf&&(e||!r.type.spec.isolating);r=r.firstChild)n++;for(let n=t.lastChild;n&&!n.isLeaf&&(e||!n.type.spec.isolating);n=n.lastChild)r++;return new ot(t,n,r)}}function at(t,e,n){let{index:r,offset:i}=t.findIndex(e),s=t.maybeChild(r),{index:o,offset:a}=t.findIndex(n);if(i==e||s.isText){if(a!=n&&!t.child(o).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=o)throw new RangeError("Removing non-flat range");return t.replaceChild(r,s.copy(at(s.content,e-i-1,n-i-1)))}function lt(t,e,n,r){let{index:i,offset:s}=t.findIndex(e),o=t.maybeChild(i);if(s==e||o.isText)return r&&!r.canReplace(i,i,n)?null:t.cut(0,e).append(n).append(t.cut(e));let a=lt(o.content,e-s-1,n);return a&&t.replaceChild(i,o.copy(a))}function ht(t,e,n){if(n.openStart>t.depth)throw new st("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new st("Inconsistent open depths");return ct(t,e,n,0)}function ct(t,e,n,r){let i=t.index(r),s=t.node(r);if(i==e.index(r)&&r<t.depth-n.openStart){let o=ct(t,e,n,r+1);return s.copy(s.content.replaceChild(i,o))}if(n.content.size){if(n.openStart||n.openEnd||t.depth!=r||e.depth!=r){let{start:i,end:o}=function(t,e){let n=e.depth-t.openStart,r=e.node(n).copy(t.content);for(let t=n-1;t>=0;t--)r=e.node(t).copy(tt.from(r));return{start:r.resolveNoCache(t.openStart+n),end:r.resolveNoCache(r.content.size-t.openEnd-n)}}(n,t);return mt(s,gt(t,i,o,e,r))}{let r=t.parent,i=r.content;return mt(r,i.cut(0,t.parentOffset).append(n.content).append(i.cut(e.parentOffset)))}}return mt(s,yt(t,e,r))}function ut(t,e){if(!e.type.compatibleContent(t.type))throw new st("Cannot join "+e.type.name+" onto "+t.type.name)}function pt(t,e,n){let r=t.node(n);return ut(r,e.node(n)),r}function dt(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function ft(t,e,n,r){let i=(e||t).node(n),s=0,o=e?e.index(n):i.childCount;t&&(s=t.index(n),t.depth>n?s++:t.textOffset&&(dt(t.nodeAfter,r),s++));for(let t=s;t<o;t++)dt(i.child(t),r);e&&e.depth==n&&e.textOffset&&dt(e.nodeBefore,r)}function mt(t,e){return t.type.checkContent(e),t.copy(e)}function gt(t,e,n,r,i){let s=t.depth>i&&pt(t,e,i+1),o=r.depth>i&&pt(n,r,i+1),a=[];return ft(null,t,i,a),s&&o&&e.index(i)==n.index(i)?(ut(s,o),dt(mt(s,gt(t,e,n,r,i+1)),a)):(s&&dt(mt(s,yt(t,e,i+1)),a),ft(e,n,i,a),o&&dt(mt(o,yt(n,r,i+1)),a)),ft(r,null,i,a),new tt(a)}function yt(t,e,n){let r=[];if(ft(null,t,n,r),t.depth>n){dt(mt(pt(t,e,n+1),yt(t,e,n+1)),r)}return ft(e,null,n,r),new tt(r)}ot.empty=new ot(tt.empty,0,0);class kt{constructor(t,e,n){this.pos=t,this.path=e,this.parentOffset=n,this.depth=e.length/3-1}resolveDepth(t){return null==t?this.depth:t<0?this.depth+t:t}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(t){return this.path[3*this.resolveDepth(t)]}index(t){return this.path[3*this.resolveDepth(t)+1]}indexAfter(t){return t=this.resolveDepth(t),this.index(t)+(t!=this.depth||this.textOffset?1:0)}start(t){return 0==(t=this.resolveDepth(t))?0:this.path[3*t-1]+1}end(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size}before(t){if(!(t=this.resolveDepth(t)))throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]}after(t){if(!(t=this.resolveDepth(t)))throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]+this.path[3*t].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;let n=this.pos-this.path[this.path.length-1],r=t.child(e);return n?t.child(e).cut(n):r}get nodeBefore(){let t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):0==t?null:this.parent.child(t-1)}posAtIndex(t,e){e=this.resolveDepth(e);let n=this.path[3*e],r=0==e?0:this.path[3*e-1]+1;for(let e=0;e<t;e++)r+=n.child(e).nodeSize;return r}marks(){let t=this.parent,e=this.index();if(0==t.content.size)return it.none;if(this.textOffset)return t.child(e).marks;let n=t.maybeChild(e-1),r=t.maybeChild(e);if(!n){let t=n;n=r,r=t}let i=n.marks;for(var s=0;s<i.length;s++)!1!==i[s].type.spec.inclusive||r&&i[s].isInSet(r.marks)||(i=i[s--].removeFromSet(i));return i}marksAcross(t){let e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;let n=e.marks,r=t.parent.maybeChild(t.index());for(var i=0;i<n.length;i++)!1!==n[i].type.spec.inclusive||r&&n[i].isInSet(r.marks)||(n=n[i--].removeFromSet(n));return n}sharedDepth(t){for(let e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0}blockRange(t=this,e){if(t.pos<this.pos)return t.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--)if(t.pos<=this.end(n)&&(!e||e(this.node(n))))return new St(this,t,n);return null}sameParent(t){return this.pos-this.parentOffset==t.pos-t.parentOffset}max(t){return t.pos>this.pos?t:this}min(t){return t.pos<this.pos?t:this}toString(){let t="";for(let e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset}static resolve(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");let n=[],r=0,i=e;for(let e=t;;){let{index:t,offset:s}=e.content.findIndex(i),o=i-s;if(n.push(e,t,r+s),!o)break;if(e=e.child(t),e.isText)break;i=o-1,r+=s+1}return new kt(e,n,i)}static resolveCached(t,e){for(let n=0;n<wt.length;n++){let r=wt[n];if(r.pos==e&&r.doc==t)return r}let n=wt[vt]=kt.resolve(t,e);return vt=(vt+1)%xt,n}}let wt=[],vt=0,xt=12;class St{constructor(t,e,n){this.$from=t,this.$to=e,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const bt=Object.create(null);class Mt{constructor(t,e,n,r=it.none){this.type=t,this.attrs=e,this.marks=r,this.content=n||tt.empty}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(t){return this.content.child(t)}maybeChild(t){return this.content.maybeChild(t)}forEach(t){this.content.forEach(t)}nodesBetween(t,e,n,r=0){this.content.nodesBetween(t,e,n,r,this)}descendants(t){this.nodesBetween(0,this.content.size,t)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(t,e,n,r){return this.content.textBetween(t,e,n,r)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)}sameMarkup(t){return this.hasMarkup(t.type,t.attrs,t.marks)}hasMarkup(t,e,n){return this.type==t&&rt(this.attrs,e||t.defaultAttrs||bt)&&it.sameSet(this.marks,n||it.none)}copy(t=null){return t==this.content?this:new Mt(this.type,this.attrs,t,this.marks)}mark(t){return t==this.marks?this:new Mt(this.type,this.attrs,this.content,t)}cut(t,e=this.content.size){return 0==t&&e==this.content.size?this:this.copy(this.content.cut(t,e))}slice(t,e=this.content.size,n=!1){if(t==e)return ot.empty;let r=this.resolve(t),i=this.resolve(e),s=n?0:r.sharedDepth(e),o=r.start(s),a=r.node(s).content.cut(r.pos-o,i.pos-o);return new ot(a,r.depth-s,i.depth-s)}replace(t,e,n){return ht(this.resolve(t),this.resolve(e),n)}nodeAt(t){for(let e=this;;){let{index:n,offset:r}=e.content.findIndex(t);if(e=e.maybeChild(n),!e)return null;if(r==t||e.isText)return e;t-=r+1}}childAfter(t){let{index:e,offset:n}=this.content.findIndex(t);return{node:this.content.maybeChild(e),index:e,offset:n}}childBefore(t){if(0==t)return{node:null,index:0,offset:0};let{index:e,offset:n}=this.content.findIndex(t);if(n<t)return{node:this.content.child(e),index:e,offset:n};let r=this.content.child(e-1);return{node:r,index:e-1,offset:n-r.nodeSize}}resolve(t){return kt.resolveCached(this,t)}resolveNoCache(t){return kt.resolve(this,t)}rangeHasMark(t,e,n){let r=!1;return e>t&&this.nodesBetween(t,e,(t=>(n.isInSet(t.marks)&&(r=!0),!r))),r}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),function(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}(this.marks,t)}contentMatchAt(t){let e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e}canReplace(t,e,n=tt.empty,r=0,i=n.childCount){let s=this.contentMatchAt(t).matchFragment(n,r,i),o=s&&s.matchFragment(this.content,e);if(!o||!o.validEnd)return!1;for(let t=r;t<i;t++)if(!this.type.allowsMarks(n.child(t).marks))return!1;return!0}canReplaceWith(t,e,n,r){if(r&&!this.type.allowsMarks(r))return!1;let i=this.contentMatchAt(t).matchType(n),s=i&&i.matchFragment(this.content,e);return!!s&&s.validEnd}canAppend(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)}check(){this.type.checkContent(this.content);let t=it.none;for(let e=0;e<this.marks.length;e++)t=this.marks[e].addToSet(t);if(!it.sameSet(t,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map((t=>t.type.name))}`);this.content.forEach((t=>t.check()))}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map((t=>t.toJSON()))),t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");let n=null;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=e.marks.map(t.markFromJSON)}if("text"==e.type){if("string"!=typeof e.text)throw new RangeError("Invalid text node in JSON");return t.text(e.text,n)}let r=tt.fromJSON(t,e.content);return t.nodeType(e.type).create(e.attrs,r,n)}}Mt.prototype.text=void 0;class Tt{constructor(t,e){this.schema=t,this.rules=e,this.tags=[],this.styles=[],e.forEach((t=>{t.tag?this.tags.push(t):t.style&&this.styles.push(t)})),this.normalizeLists=!this.tags.some((e=>{if(!/^(ul|ol)\b/.test(e.tag)||!e.node)return!1;let n=t.nodes[e.node];return n.contentMatch.matchType(n)}))}parse(t,e={}){let n=new Jt(this,e,!1);return n.addAll(t,e.from,e.to),n.finish()}parseSlice(t,e={}){let n=new Jt(this,e,!0);return n.addAll(t,e.from,e.to),ot.maxOpen(n.finish())}matchTag(t,e,n){for(let r=n?this.tags.indexOf(n)+1:0;r<this.tags.length;r++){let n=this.tags[r];if(Pt(t,n.tag)&&(void 0===n.namespace||t.namespaceURI==n.namespace)&&(!n.context||e.matchesContext(n.context))){if(n.getAttrs){let e=n.getAttrs(t);if(!1===e)continue;n.attrs=e||void 0}return n}}}matchStyle(t,e,n,r){for(let i=r?this.styles.indexOf(r)+1:0;i<this.styles.length;i++){let r=this.styles[i],s=r.style;if(!(0!=s.indexOf(t)||r.context&&!n.matchesContext(r.context)||s.length>t.length&&(61!=s.charCodeAt(t.length)||s.slice(t.length+1)!=e))){if(r.getAttrs){let t=r.getAttrs(e);if(!1===t)continue;r.attrs=t||void 0}return r}}}static schemaRules(t){let e=[];function n(t){let n=null==t.priority?50:t.priority,r=0;for(;r<e.length;r++){let t=e[r];if((null==t.priority?50:t.priority)<n)break}e.splice(r,0,t)}for(let e in t.marks){let r=t.marks[e].spec.parseDOM;r&&r.forEach((t=>{n(t=Ft(t)),t.mark||t.ignore||t.clearMark||(t.mark=e)}))}for(let e in t.nodes){let r=t.nodes[e].spec.parseDOM;r&&r.forEach((t=>{n(t=Ft(t)),t.node||t.ignore||t.mark||(t.node=e)}))}return e}static fromSchema(t){return t.cached.domParser||(t.cached.domParser=new Tt(t,Tt.schemaRules(t)))}}const Ot={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Nt={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},At={ol:!0,ul:!0},Ct=1,Et=2,It=4;function zt(t,e,n){return null!=e?(e?Ct:0)|("full"===e?Et:0):t&&"pre"==t.whitespace?Ct|Et:n&~It}class Rt{constructor(t,e,n,r,i,s,o){this.type=t,this.attrs=e,this.marks=n,this.pendingMarks=r,this.solid=i,this.options=o,this.content=[],this.activeMarks=it.none,this.stashMarks=[],this.match=s||(o&It?null:t.contentMatch)}findWrapping(t){if(!this.match){if(!this.type)return[];let e=this.type.contentMatch.fillBefore(tt.from(t));if(!e){let e,n=this.type.contentMatch;return(e=n.findWrapping(t.type))?(this.match=n,e):null}this.match=this.type.contentMatch.matchFragment(e)}return this.match.findWrapping(t.type)}finish(t){if(!(this.options&Ct)){let t,e=this.content[this.content.length-1];if(e&&e.isText&&(t=/[ \t\r\n\u000c]+$/.exec(e.text))){let n=e;e.text.length==t[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-t[0].length))}}let e=tt.from(this.content);return!t&&this.match&&(e=e.append(this.match.fillBefore(tt.empty,!0))),this.type?this.type.create(this.attrs,e,this.marks):e}popFromStashMark(t){for(let e=this.stashMarks.length-1;e>=0;e--)if(t.eq(this.stashMarks[e]))return this.stashMarks.splice(e,1)[0]}applyPending(t){for(let e=0,n=this.pendingMarks;e<n.length;e++){let r=n[e];(this.type?this.type.allowsMarkType(r.type):Lt(r.type,t))&&!r.isInSet(this.activeMarks)&&(this.activeMarks=r.addToSet(this.activeMarks),this.pendingMarks=r.removeFromSet(this.pendingMarks))}}inlineContext(t){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:t.parentNode&&!Ot.hasOwnProperty(t.parentNode.nodeName.toLowerCase())}}class Jt{constructor(t,e,n){this.parser=t,this.options=e,this.isOpen=n,this.open=0;let r,i=e.topNode,s=zt(null,e.preserveWhitespace,0)|(n?It:0);r=i?new Rt(i.type,i.attrs,it.none,it.none,!0,e.topMatch||i.type.contentMatch,s):new Rt(n?null:t.schema.topNodeType,null,it.none,it.none,!0,null,s),this.nodes=[r],this.find=e.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(t){if(3==t.nodeType)this.addTextNode(t);else if(1==t.nodeType){let e=t.getAttribute("style");if(e){let n=this.readStyles(function(t){let e,n=/\s*([\w-]+)\s*:\s*([^;]+)/g,r=[];for(;e=n.exec(t);)r.push(e[1],e[2].trim());return r}(e));if(!n)return;let[r,i]=n,s=this.top;for(let t=0;t<i.length;t++)this.removePendingMark(i[t],s);for(let t=0;t<r.length;t++)this.addPendingMark(r[t]);this.addElement(t);for(let t=0;t<r.length;t++)this.removePendingMark(r[t],s);for(let t=0;t<i.length;t++)this.addPendingMark(i[t])}else this.addElement(t)}}addTextNode(t){let e=t.nodeValue,n=this.top;if(n.options&Et||n.inlineContext(t)||/[^ \t\r\n\u000c]/.test(e)){if(n.options&Ct)e=n.options&Et?e.replace(/\r\n?/g,"\n"):e.replace(/\r?\n|\r/g," ");else if(e=e.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(e)&&this.open==this.nodes.length-1){let r=n.content[n.content.length-1],i=t.previousSibling;(!r||i&&"BR"==i.nodeName||r.isText&&/[ \t\r\n\u000c]$/.test(r.text))&&(e=e.slice(1))}e&&this.insertNode(this.parser.schema.text(e)),this.findInText(t)}else this.findInside(t)}addElement(t,e){let n,r=t.nodeName.toLowerCase();At.hasOwnProperty(r)&&this.parser.normalizeLists&&function(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let t=1==e.nodeType?e.nodeName.toLowerCase():null;t&&At.hasOwnProperty(t)&&n?(n.appendChild(e),e=n):"li"==t?n=e:t&&(n=null)}}(t);let i=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(n=this.parser.matchTag(t,this,e));if(i?i.ignore:Nt.hasOwnProperty(r))this.findInside(t),this.ignoreFallback(t);else if(!i||i.skip||i.closeParent){i&&i.closeParent?this.open=Math.max(0,this.open-1):i&&i.skip.nodeType&&(t=i.skip);let e,n=this.top,s=this.needsBlock;if(Ot.hasOwnProperty(r))n.content.length&&n.content[0].isInline&&this.open&&(this.open--,n=this.top),e=!0,n.type||(this.needsBlock=!0);else if(!t.firstChild)return void this.leafFallback(t);this.addAll(t),e&&this.sync(n),this.needsBlock=s}else this.addElementByRule(t,i,!1===i.consuming?n:void 0)}leafFallback(t){"BR"==t.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode("\n"))}ignoreFallback(t){"BR"!=t.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"))}readStyles(t){let e=it.none,n=it.none;t:for(let r=0;r<t.length;r+=2)for(let i;;){let s=this.parser.matchStyle(t[r],t[r+1],this,i);if(!s)continue t;if(s.ignore)return null;if(s.clearMark?this.top.pendingMarks.forEach((t=>{s.clearMark(t)&&(n=t.addToSet(n))})):e=this.parser.schema.marks[s.mark].create(s.attrs).addToSet(e),!1!==s.consuming)break;i=s}return[e,n]}addElementByRule(t,e,n){let r,i,s;if(e.node)i=this.parser.schema.nodes[e.node],i.isLeaf?this.insertNode(i.create(e.attrs))||this.leafFallback(t):r=this.enter(i,e.attrs||null,e.preserveWhitespace);else{s=this.parser.schema.marks[e.mark].create(e.attrs),this.addPendingMark(s)}let o=this.top;if(i&&i.isLeaf)this.findInside(t);else if(n)this.addElement(t,n);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach((t=>this.insertNode(t)));else{let n=t;"string"==typeof e.contentElement?n=t.querySelector(e.contentElement):"function"==typeof e.contentElement?n=e.contentElement(t):e.contentElement&&(n=e.contentElement),this.findAround(t,n,!0),this.addAll(n)}r&&this.sync(o)&&this.open--,s&&this.removePendingMark(s,o)}addAll(t,e,n){let r=e||0;for(let i=e?t.childNodes[e]:t.firstChild,s=null==n?null:t.childNodes[n];i!=s;i=i.nextSibling,++r)this.findAtPoint(t,r),this.addDOM(i);this.findAtPoint(t,r)}findPlace(t){let e,n;for(let r=this.open;r>=0;r--){let i=this.nodes[r],s=i.findWrapping(t);if(s&&(!e||e.length>s.length)&&(e=s,n=i,!s.length))break;if(i.solid)break}if(!e)return!1;this.sync(n);for(let t=0;t<e.length;t++)this.enterInner(e[t],null,!1);return!0}insertNode(t){if(t.isInline&&this.needsBlock&&!this.top.type){let t=this.textblockFromContext();t&&this.enterInner(t)}if(this.findPlace(t)){this.closeExtra();let e=this.top;e.applyPending(t.type),e.match&&(e.match=e.match.matchType(t.type));let n=e.activeMarks;for(let r=0;r<t.marks.length;r++)e.type&&!e.type.allowsMarkType(t.marks[r].type)||(n=t.marks[r].addToSet(n));return e.content.push(t.mark(n)),!0}return!1}enter(t,e,n){let r=this.findPlace(t.create(e));return r&&this.enterInner(t,e,!0,n),r}enterInner(t,e=null,n=!1,r){this.closeExtra();let i=this.top;i.applyPending(t),i.match=i.match&&i.match.matchType(t);let s=zt(t,r,i.options);i.options&It&&0==i.content.length&&(s|=It),this.nodes.push(new Rt(t,e,i.activeMarks,i.pendingMarks,n,null,s)),this.open++}closeExtra(t=!1){let e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(t){for(let e=this.open;e>=0;e--)if(this.nodes[e]==t)return this.open=e,!0;return!1}get currentPos(){this.closeExtra();let t=0;for(let e=this.open;e>=0;e--){let n=this.nodes[e].content;for(let e=n.length-1;e>=0;e--)t+=n[e].nodeSize;e&&t++}return t}findAtPoint(t,e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==t&&this.find[n].offset==e&&(this.find[n].pos=this.currentPos)}findInside(t){if(this.find)for(let e=0;e<this.find.length;e++)null==this.find[e].pos&&1==t.nodeType&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)}findAround(t,e,n){if(t!=e&&this.find)for(let r=0;r<this.find.length;r++)if(null==this.find[r].pos&&1==t.nodeType&&t.contains(this.find[r].node)){e.compareDocumentPosition(this.find[r].node)&(n?2:4)&&(this.find[r].pos=this.currentPos)}}findInText(t){if(this.find)for(let e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))}matchesContext(t){if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);let e=t.split("/"),n=this.options.context,r=!(this.isOpen||n&&n.parent.type!=this.nodes[0].type),i=-(n?n.depth+1:0)+(r?0:1),s=(t,o)=>{for(;t>=0;t--){let a=e[t];if(""==a){if(t==e.length-1||0==t)continue;for(;o>=i;o--)if(s(t-1,o))return!0;return!1}{let t=o>0||0==o&&r?this.nodes[o].type:n&&o>=i?n.node(o-i).type:null;if(!t||t.name!=a&&-1==t.groups.indexOf(a))return!1;o--}}return!0};return s(e.length-1,this.open)}textblockFromContext(){let t=this.options.context;if(t)for(let e=t.depth;e>=0;e--){let n=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let t in this.parser.schema.nodes){let e=this.parser.schema.nodes[t];if(e.isTextblock&&e.defaultAttrs)return e}}addPendingMark(t){let e=function(t,e){for(let n=0;n<e.length;n++)if(t.eq(e[n]))return e[n]}(t,this.top.pendingMarks);e&&this.top.stashMarks.push(e),this.top.pendingMarks=t.addToSet(this.top.pendingMarks)}removePendingMark(t,e){for(let n=this.open;n>=0;n--){let r=this.nodes[n];if(r.pendingMarks.lastIndexOf(t)>-1)r.pendingMarks=t.removeFromSet(r.pendingMarks);else{r.activeMarks=t.removeFromSet(r.activeMarks);let e=r.popFromStashMark(t);e&&r.type&&r.type.allowsMarkType(e.type)&&(r.activeMarks=e.addToSet(r.activeMarks))}if(r==e)break}}}function Pt(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function Ft(t){let e={};for(let n in t)e[n]=t[n];return e}function Lt(t,e){let n=e.schema.nodes;for(let r in n){let i=n[r];if(!i.allowsMarkType(t))continue;let s=[],o=t=>{s.push(t);for(let n=0;n<t.edgeCount;n++){let{type:r,next:i}=t.edge(n);if(r==e)return!0;if(s.indexOf(i)<0&&o(i))return!0}};if(o(i.contentMatch))return!0}}class qt{constructor(t,e){this.nodes=t,this.marks=e}serializeFragment(t,e={},n){n||(n=$t(e).createDocumentFragment());let r=n,i=[];return t.forEach((t=>{if(i.length||t.marks.length){let n=0,s=0;for(;n<i.length&&s<t.marks.length;){let e=t.marks[s];if(this.marks[e.type.name]){if(!e.eq(i[n][0])||!1===e.type.spec.spanning)break;n++,s++}else s++}for(;n<i.length;)r=i.pop()[1];for(;s<t.marks.length;){let n=t.marks[s++],o=this.serializeMark(n,t.isInline,e);o&&(i.push([n,r]),r.appendChild(o.dom),r=o.contentDOM||o.dom)}}r.appendChild(this.serializeNodeInner(t,e))})),n}serializeNodeInner(t,e){let{dom:n,contentDOM:r}=qt.renderSpec($t(e),this.nodes[t.type.name](t));if(r){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(t.content,e,r)}return n}serializeNode(t,e={}){let n=this.serializeNodeInner(t,e);for(let r=t.marks.length-1;r>=0;r--){let i=this.serializeMark(t.marks[r],t.isInline,e);i&&((i.contentDOM||i.dom).appendChild(n),n=i.dom)}return n}serializeMark(t,e,n={}){let r=this.marks[t.type.name];return r&&qt.renderSpec($t(n),r(t,e))}static renderSpec(t,e,n=null){if("string"==typeof e)return{dom:t.createTextNode(e)};if(null!=e.nodeType)return{dom:e};if(e.dom&&null!=e.dom.nodeType)return e;let r,i=e[0],s=i.indexOf(" ");s>0&&(n=i.slice(0,s),i=i.slice(s+1));let o=n?t.createElementNS(n,i):t.createElement(i),a=e[1],l=1;if(a&&"object"==typeof a&&null==a.nodeType&&!Array.isArray(a)){l=2;for(let t in a)if(null!=a[t]){let e=t.indexOf(" ");e>0?o.setAttributeNS(t.slice(0,e),t.slice(e+1),a[t]):o.setAttribute(t,a[t])}}for(let i=l;i<e.length;i++){let s=e[i];if(0===s){if(i<e.length-1||i>l)throw new RangeError("Content hole must be the only child of its parent node");return{dom:o,contentDOM:o}}{let{dom:e,contentDOM:i}=qt.renderSpec(t,s,n);if(o.appendChild(e),i){if(r)throw new RangeError("Multiple content holes");r=i}}}return{dom:o,contentDOM:r}}static fromSchema(t){return t.cached.domSerializer||(t.cached.domSerializer=new qt(this.nodesFromSchema(t),this.marksFromSchema(t)))}static nodesFromSchema(t){let e=Bt(t.nodes);return e.text||(e.text=t=>t.text),e}static marksFromSchema(t){return Bt(t.marks)}}function Bt(t){let e={};for(let n in t){let r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function $t(t){return t.document||window.document}const Dt=65535,Ht=Math.pow(2,16);function jt(t){return t&Dt}class _t{constructor(t,e,n){this.pos=t,this.delInfo=e,this.recover=n}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}}class Wt{constructor(t,e=!1){if(this.ranges=t,this.inverted=e,!t.length&&Wt.empty)return Wt.empty}recover(t){let e=0,n=jt(t);if(!this.inverted)for(let t=0;t<n;t++)e+=this.ranges[3*t+2]-this.ranges[3*t+1];return this.ranges[3*n]+e+function(t){return(t-(t&Dt))/Ht}(t)}mapResult(t,e=1){return this._map(t,e,!1)}map(t,e=1){return this._map(t,e,!0)}_map(t,e,n){let r=0,i=this.inverted?2:1,s=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let a=this.ranges[o]-(this.inverted?r:0);if(a>t)break;let l=this.ranges[o+i],h=this.ranges[o+s],c=a+l;if(t<=c){let i=a+r+((l?t==a?-1:t==c?1:e:e)<0?0:h);if(n)return i;let s=t==(e<0?a:c)?null:o/3+(t-a)*Ht,u=t==a?2:t==c?1:4;return(e<0?t!=a:t!=c)&&(u|=8),new _t(i,u,s)}r+=h-l}return n?t+r:new _t(t+r,0,null)}touches(t,e){let n=0,r=jt(e),i=this.inverted?2:1,s=this.inverted?1:2;for(let e=0;e<this.ranges.length;e+=3){let o=this.ranges[e]-(this.inverted?n:0);if(o>t)break;let a=this.ranges[e+i];if(t<=o+a&&e==3*r)return!0;n+=this.ranges[e+s]-a}return!1}forEach(t){let e=this.inverted?2:1,n=this.inverted?1:2;for(let r=0,i=0;r<this.ranges.length;r+=3){let s=this.ranges[r],o=s-(this.inverted?i:0),a=s+(this.inverted?0:i),l=this.ranges[r+e],h=this.ranges[r+n];t(o,o+l,a,a+h),i+=h-l}}invert(){return new Wt(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(t){return 0==t?Wt.empty:new Wt(t<0?[0,-t,0]:[0,0,t])}}Wt.empty=new Wt([]);const Kt=Object.create(null);class Ut{getMap(){return Wt.empty}merge(t){return null}static fromJSON(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=Kt[e.stepType];if(!n)throw new RangeError(`No step type ${e.stepType} defined`);return n.fromJSON(t,e)}static jsonID(t,e){if(t in Kt)throw new RangeError("Duplicate use of step JSON ID "+t);return Kt[t]=e,e.prototype.jsonID=t,e}}class Vt{constructor(t,e){this.doc=t,this.failed=e}static ok(t){return new Vt(t,null)}static fail(t){return new Vt(null,t)}static fromReplace(t,e,n,r){try{return Vt.ok(t.replace(e,n,r))}catch(t){if(t instanceof st)return Vt.fail(t.message);throw t}}}function Gt(t,e,n){let r=[];for(let i=0;i<t.childCount;i++){let s=t.child(i);s.content.size&&(s=s.copy(Gt(s.content,e,s))),s.isInline&&(s=e(s,n,i)),r.push(s)}return tt.fromArray(r)}class Qt extends Ut{constructor(t,e,n){super(),this.from=t,this.to=e,this.mark=n}apply(t){let e=t.slice(this.from,this.to),n=t.resolve(this.from),r=n.node(n.sharedDepth(this.to)),i=new ot(Gt(e.content,((t,e)=>t.isAtom&&e.type.allowsMarkType(this.mark.type)?t.mark(this.mark.addToSet(t.marks)):t),r),e.openStart,e.openEnd);return Vt.fromReplace(t,this.from,this.to,i)}invert(){return new Xt(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deleted&&n.deleted||e.pos>=n.pos?null:new Qt(e.pos,n.pos,this.mark)}merge(t){return t instanceof Qt&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new Qt(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Qt(e.from,e.to,t.markFromJSON(e.mark))}}Ut.jsonID("addMark",Qt);class Xt extends Ut{constructor(t,e,n){super(),this.from=t,this.to=e,this.mark=n}apply(t){let e=t.slice(this.from,this.to),n=new ot(Gt(e.content,(t=>t.mark(this.mark.removeFromSet(t.marks))),t),e.openStart,e.openEnd);return Vt.fromReplace(t,this.from,this.to,n)}invert(){return new Qt(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deleted&&n.deleted||e.pos>=n.pos?null:new Xt(e.pos,n.pos,this.mark)}merge(t){return t instanceof Xt&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new Xt(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Xt(e.from,e.to,t.markFromJSON(e.mark))}}Ut.jsonID("removeMark",Xt);class Yt extends Ut{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return Vt.fail("No node at mark step's position");let n=e.type.create(e.attrs,null,this.mark.addToSet(e.marks));return Vt.fromReplace(t,this.pos,this.pos+1,new ot(tt.from(n),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);if(e){let t=this.mark.addToSet(e.marks);if(t.length==e.marks.length){for(let n=0;n<e.marks.length;n++)if(!e.marks[n].isInSet(t))return new Yt(this.pos,e.marks[n]);return new Yt(this.pos,this.mark)}}return new Zt(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new Yt(e.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if("number"!=typeof e.pos)throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Yt(e.pos,t.markFromJSON(e.mark))}}Ut.jsonID("addNodeMark",Yt);class Zt extends Ut{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return Vt.fail("No node at mark step's position");let n=e.type.create(e.attrs,null,this.mark.removeFromSet(e.marks));return Vt.fromReplace(t,this.pos,this.pos+1,new ot(tt.from(n),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);return e&&this.mark.isInSet(e.marks)?new Yt(this.pos,this.mark):this}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new Zt(e.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if("number"!=typeof e.pos)throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new Zt(e.pos,t.markFromJSON(e.mark))}}Ut.jsonID("removeNodeMark",Zt);class te extends Ut{constructor(t,e,n,r=!1){super(),this.from=t,this.to=e,this.slice=n,this.structure=r}apply(t){return this.structure&&ne(t,this.from,this.to)?Vt.fail("Structure replace would overwrite content"):Vt.fromReplace(t,this.from,this.to,this.slice)}getMap(){return new Wt([this.from,this.to-this.from,this.slice.size])}invert(t){return new te(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deletedAcross&&n.deletedAcross?null:new te(e.pos,Math.max(e.pos,n.pos),this.slice)}merge(t){if(!(t instanceof te)||t.structure||this.structure)return null;if(this.from+this.slice.size!=t.from||this.slice.openEnd||t.slice.openStart){if(t.to!=this.from||this.slice.openStart||t.slice.openEnd)return null;{let e=this.slice.size+t.slice.size==0?ot.empty:new ot(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new te(t.from,this.to,e,this.structure)}}{let e=this.slice.size+t.slice.size==0?ot.empty:new ot(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new te(this.from,this.to+(t.to-t.from),e,this.structure)}}toJSON(){let t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new te(e.from,e.to,ot.fromJSON(t,e.slice),!!e.structure)}}Ut.jsonID("replace",te);class ee extends Ut{constructor(t,e,n,r,i,s,o=!1){super(),this.from=t,this.to=e,this.gapFrom=n,this.gapTo=r,this.slice=i,this.insert=s,this.structure=o}apply(t){if(this.structure&&(ne(t,this.from,this.gapFrom)||ne(t,this.gapTo,this.to)))return Vt.fail("Structure gap-replace would overwrite content");let e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return Vt.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,e.content);return n?Vt.fromReplace(t,this.from,this.to,n):Vt.fail("Content does not fit in gap")}getMap(){return new Wt([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let e=this.gapTo-this.gapFrom;return new ee(this.from,this.from+this.slice.size+e,this.from+this.insert,this.from+this.insert+e,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1),r=t.map(this.gapFrom,-1),i=t.map(this.gapTo,1);return e.deletedAcross&&n.deletedAcross||r<e.pos||i>n.pos?null:new ee(e.pos,n.pos,r,i,this.slice,this.insert,this.structure)}toJSON(){let t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to||"number"!=typeof e.gapFrom||"number"!=typeof e.gapTo||"number"!=typeof e.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new ee(e.from,e.to,e.gapFrom,e.gapTo,ot.fromJSON(t,e.slice),e.insert,!!e.structure)}}function ne(t,e,n){let r=t.resolve(e),i=n-e,s=r.depth;for(;i>0&&s>0&&r.indexAfter(s)==r.node(s).childCount;)s--,i--;if(i>0){let t=r.node(s).maybeChild(r.indexAfter(s));for(;i>0;){if(!t||t.isLeaf)return!0;t=t.firstChild,i--}}return!1}Ut.jsonID("replaceAround",ee);class re extends Ut{constructor(t,e,n){super(),this.pos=t,this.attr=e,this.value=n}apply(t){let e=t.nodeAt(this.pos);if(!e)return Vt.fail("No node at attribute step's position");let n=Object.create(null);for(let t in e.attrs)n[t]=e.attrs[t];n[this.attr]=this.value;let r=e.type.create(n,null,e.marks);return Vt.fromReplace(t,this.pos,this.pos+1,new ot(tt.from(r),0,e.isLeaf?0:1))}getMap(){return Wt.empty}invert(t){return new re(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new re(e.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,e){if("number"!=typeof e.pos||"string"!=typeof e.attr)throw new RangeError("Invalid input for AttrStep.fromJSON");return new re(e.pos,e.attr,e.value)}}Ut.jsonID("attr",re);let ie=class extends Error{};ie=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n},(ie.prototype=Object.create(Error.prototype)).constructor=ie,ie.prototype.name="TransformError";const se=Object.create(null);class oe{constructor(t,e,n){this.$anchor=t,this.$head=e,this.ranges=n||[new ae(t.min(e),t.max(e))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let t=this.ranges;for(let e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(t,e=ot.empty){let n=e.content.lastChild,r=null;for(let t=0;t<e.openEnd;t++)r=n,n=n.lastChild;let i=t.steps.length,s=this.ranges;for(let o=0;o<s.length;o++){let{$from:a,$to:l}=s[o],h=t.mapping.slice(i);t.replaceRange(h.map(a.pos),h.map(l.pos),o?ot.empty:e),0==o&&ye(t,i,(n?n.isInline:r&&r.isTextblock)?-1:1)}}replaceWith(t,e){let n=t.steps.length,r=this.ranges;for(let i=0;i<r.length;i++){let{$from:s,$to:o}=r[i],a=t.mapping.slice(n),l=a.map(s.pos),h=a.map(o.pos);i?t.deleteRange(l,h):(t.replaceRangeWith(l,h,e),ye(t,n,e.isInline?-1:1))}}static findFrom(t,e,n=!1){let r=t.parent.inlineContent?new ce(t):ge(t.node(0),t.parent,t.pos,t.index(),e,n);if(r)return r;for(let r=t.depth-1;r>=0;r--){let i=e<0?ge(t.node(0),t.node(r),t.before(r+1),t.index(r),e,n):ge(t.node(0),t.node(r),t.after(r+1),t.index(r)+1,e,n);if(i)return i}return null}static near(t,e=1){return this.findFrom(t,e)||this.findFrom(t,-e)||new fe(t.node(0))}static atStart(t){return ge(t,t,0,0,1)||new fe(t)}static atEnd(t){return ge(t,t,t.content.size,t.childCount,-1)||new fe(t)}static fromJSON(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=se[e.type];if(!n)throw new RangeError(`No selection type ${e.type} defined`);return n.fromJSON(t,e)}static jsonID(t,e){if(t in se)throw new RangeError("Duplicate use of selection JSON ID "+t);return se[t]=e,e.prototype.jsonID=t,e}getBookmark(){return ce.between(this.$anchor,this.$head).getBookmark()}}oe.prototype.visible=!0;class ae{constructor(t,e){this.$from=t,this.$to=e}}let le=!1;function he(t){le||t.parent.inlineContent||(le=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class ce extends oe{constructor(t,e=t){he(t),he(e),super(t,e)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(t,e){let n=t.resolve(e.map(this.head));if(!n.parent.inlineContent)return oe.near(n);let r=t.resolve(e.map(this.anchor));return new ce(r.parent.inlineContent?r:n,n)}replace(t,e=ot.empty){if(super.replace(t,e),e==ot.empty){let e=this.$from.marksAcross(this.$to);e&&t.ensureMarks(e)}}eq(t){return t instanceof ce&&t.anchor==this.anchor&&t.head==this.head}getBookmark(){return new ue(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(t,e){if("number"!=typeof e.anchor||"number"!=typeof e.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new ce(t.resolve(e.anchor),t.resolve(e.head))}static create(t,e,n=e){let r=t.resolve(e);return new this(r,n==e?r:t.resolve(n))}static between(t,e,n){let r=t.pos-e.pos;if(n&&!r||(n=r>=0?1:-1),!e.parent.inlineContent){let t=oe.findFrom(e,n,!0)||oe.findFrom(e,-n,!0);if(!t)return oe.near(e,n);e=t.$head}return t.parent.inlineContent||(0==r||(t=(oe.findFrom(t,-n,!0)||oe.findFrom(t,n,!0)).$anchor).pos<e.pos!=r<0)&&(t=e),new ce(t,e)}}oe.jsonID("text",ce);class ue{constructor(t,e){this.anchor=t,this.head=e}map(t){return new ue(t.map(this.anchor),t.map(this.head))}resolve(t){return ce.between(t.resolve(this.anchor),t.resolve(this.head))}}class pe extends oe{constructor(t){let e=t.nodeAfter,n=t.node(0).resolve(t.pos+e.nodeSize);super(t,n),this.node=e}map(t,e){let{deleted:n,pos:r}=e.mapResult(this.anchor),i=t.resolve(r);return n?oe.near(i):new pe(i)}content(){return new ot(tt.from(this.node),0,0)}eq(t){return t instanceof pe&&t.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new de(this.anchor)}static fromJSON(t,e){if("number"!=typeof e.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new pe(t.resolve(e.anchor))}static create(t,e){return new pe(t.resolve(e))}static isSelectable(t){return!t.isText&&!1!==t.type.spec.selectable}}pe.prototype.visible=!1,oe.jsonID("node",pe);class de{constructor(t){this.anchor=t}map(t){let{deleted:e,pos:n}=t.mapResult(this.anchor);return e?new ue(n,n):new de(n)}resolve(t){let e=t.resolve(this.anchor),n=e.nodeAfter;return n&&pe.isSelectable(n)?new pe(e):oe.near(e)}}class fe extends oe{constructor(t){super(t.resolve(0),t.resolve(t.content.size))}replace(t,e=ot.empty){if(e==ot.empty){t.delete(0,t.doc.content.size);let e=oe.atStart(t.doc);e.eq(t.selection)||t.setSelection(e)}else super.replace(t,e)}toJSON(){return{type:"all"}}static fromJSON(t){return new fe(t)}map(t){return new fe(t)}eq(t){return t instanceof fe}getBookmark(){return me}}oe.jsonID("all",fe);const me={map(){return this},resolve:t=>new fe(t)};function ge(t,e,n,r,i,s=!1){if(e.inlineContent)return ce.create(t,n);for(let o=r-(i>0?0:1);i>0?o<e.childCount:o>=0;o+=i){let r=e.child(o);if(r.isAtom){if(!s&&pe.isSelectable(r))return pe.create(t,n-(i<0?r.nodeSize:0))}else{let e=ge(t,r,n+i,i<0?r.childCount:0,i,s);if(e)return e}n+=r.nodeSize*i}return null}function ye(t,e,n){let r=t.steps.length-1;if(r<e)return;let i,s=t.steps[r];(s instanceof te||s instanceof ee)&&(t.mapping.maps[r].forEach(((t,e,n,r)=>{null==i&&(i=r)})),t.setSelection(oe.near(t.doc.resolve(i),n)))}function ke(t,e){return e&&t?t.bind(e):t}class we{constructor(t,e,n){this.name=t,this.init=ke(e.init,n),this.apply=ke(e.apply,n)}}function ve(t,e,n){for(let r in t){let i=t[r];i instanceof Function?i=i.bind(e):"handleDOMEvents"==r&&(i=ve(i,e,{})),n[r]=i}return n}new we("doc",{init:t=>t.doc||t.schema.topNodeType.createAndFill(),apply:t=>t.doc}),new we("selection",{init:(t,e)=>t.selection||oe.atStart(e.doc),apply:t=>t.selection}),new we("storedMarks",{init:t=>t.storedMarks||null,apply:(t,e,n,r)=>r.selection.$cursor?t.storedMarks:null}),new we("scrollToSelection",{init:()=>0,apply:(t,e)=>t.scrolledIntoView?e+1:e});class xe{constructor(t){this.spec=t,this.props={},t.props&&ve(t.props,this,this.props),this.key=t.key?t.key.key:be("plugin")}getState(t){return t[this.key]}}const Se=Object.create(null);function be(t){return t in Se?t+"$"+ ++Se[t]:(Se[t]=0,t+"$")}class Me{constructor(t="key"){this.key=be(t)}get(t){return t.config.pluginsByKey[this.key]}getState(t){return t[this.key]}}var Te=k.Node.create({name:"figureAudio",group:"block",content:"inline*",draggable:!0,isolating:!0,addAttributes:function(){return{src:{default:null,parseHTML:function(t){var e;return null===(e=t.querySelector("source"))||void 0===e?void 0:e.getAttribute("src")}},title:{default:"",parseHTML:function(t){var e;return null===(e=t.querySelector(".title"))||void 0===e?void 0:e.textContent}},duration:{default:"00:00",parseHTML:function(t){var e,n=t.querySelector(".duration");return null===(e=null==n?void 0:n.dataset)||void 0===e?void 0:e.time}}}},parseHTML:function(){return[{tag:'figure[class="audio"]',contentElement:"figcaption"}]},renderHTML:function(t){var e=t.HTMLAttributes;return["figure",{class:"audio"},["audio",{controls:!0},["source",{src:e.src,type:"audio/mp3",draggable:!1,contenteditable:!1}]],["div",{class:"player"},["header",["div",{class:"meta"},["h4",{class:"title"},e.title],["div",{class:"time"},["span",{class:"current","data-time":"00:00"}],["span",{class:"duration","data-time":e.duration}]]],["span",{class:"play"}]],["footer",["div",{class:"progress-bar"},["span",{}]]]],["figcaption",0]]},addCommands:function(){var t=this;return{setFigureAudio:function(e){var n=e.caption,r=B(e,["caption"]);return function(e){return(0,e.chain)().insertContent({type:t.name,attrs:r,content:n?[{type:"text",text:n}]:[]}).command((function(t){var e=t.tr,n=t.commands,r=e.doc,i=e.selection,s=r.resolve(i.to-2).end();return n.setTextSelection(s)})).run()}}}},addProseMirrorPlugins:function(){return[new xe({key:new Me("removePastedFigureAudio"),props:{transformPastedHTML:function(t){return t=t.replace(/<figure.*class=.audio.*[\n]*.*?<\/figure>/g,"")}}})]}}),Oe=k.Node.create({name:"figureEmbed",group:"block",content:"inline*",draggable:!0,isolating:!0,addAttributes:function(){return{class:{default:null,parseHTML:function(t){return t.getAttribute("class")}},src:{default:null,parseHTML:function(t){var e;return null===(e=t.querySelector("iframe"))||void 0===e?void 0:e.getAttribute("src")}}}},parseHTML:function(){return[{tag:'figure[class^="embed"]',contentElement:"figcaption"}]},renderHTML:function(t){var e=function(t){var e,n={url:"",allowfullscreen:!1,sandbox:[]};try{e=new URL(t)}catch(t){return n}var r=e.hostname,i=e.pathname,s=e.searchParams;if(["youtube.com","youtu.be","www.youtu.be","www.youtube.com"].includes(r)){var o=s.get("v"),a=s.get("t"),l=new URLSearchParams(q({rel:"0"},a?{start:a}:{})).toString(),h="";return o?h=o:i.match("/embed/")?h=i.split("/embed/")[1]:r.includes("youtu.be")&&(h=i.split("/")[1]),{url:"https://www.youtube.com/embed/".concat(h)+(l?"?=".concat(l):""),provider:"youtube",allowfullscreen:!0,sandbox:[]}}if(["vimeo.com","www.vimeo.com","player.vimeo.com"].includes(r))return h=i.replace(/\/$/,"").split("/").slice(-1)[0],{url:"https://player.vimeo.com/video/".concat(h),provider:"vimeo",allowfullscreen:!0,sandbox:[]};if(["bilibili.com","player.bilibili.com","www.bilibili.com"].includes(r)){return h="",h=s.get("bvid")||i.replace(/\/$/,"").split("/").slice(-1)[0],{url:"https://player.bilibili.com/player.html?bvid=".concat(h),provider:"bilibili",allowfullscreen:!0,sandbox:[]}}if(["instagram.com","www.instagram.com"].includes(r))return h=i.replace("/embed","").replace(/\/$/,"").split("/").slice(-1)[0],{url:"https://www.instagram.com/p/".concat(h,"/embed"),provider:"instagram",allowfullscreen:!1,sandbox:[]};if(["jsfiddle.net","www.jsfiddle.net"].includes(r)){var c=i.replace("/embedded","").replace(/\/$/,"").split("/").filter(Boolean);return h=1===c.length?c[0]:c[1],{url:"https://jsfiddle.net/".concat(h,"/embedded/"),provider:"jsfiddle",allowfullscreen:!1,sandbox:[]}}if(["codepen.io","www.codepen.io"].includes(r)){var u=i.split("/")[1];return h=i.replace(/\/$/,"").split("/").slice(-1)[0],{url:"https://codepen.io/".concat(u,"/embed/preview/").concat(h),provider:"codepen",allowfullscreen:!1,sandbox:[]}}return n}(t.HTMLAttributes.src),n=e.url,r=e.provider,i=e.allowfullscreen,s=e.sandbox;return["figure",q({class:"embed"},r?{"data-provider":r}:{}),["div",{class:"iframe-container"},["iframe",q(q(q({src:n,loading:"lazy"},s&&s.length>0?{sandbox:s.join(" ")}:{}),i?{allowfullscreen:!0}:{}),{frameborder:"0",draggable:!1,contenteditable:!1})]],["figcaption",0]]},addCommands:function(){var t=this;return{setFigureEmbed:function(e){var n=e.caption,r=B(e,["caption"]);return function(e){return(0,e.chain)().insertContent({type:t.name,attrs:r,content:n?[{type:"text",text:n}]:[]}).command((function(t){var e=t.tr,n=t.commands,r=e.doc,i=e.selection,s=r.resolve(i.to-2).end();return n.setTextSelection(s)})).run()}}}},addProseMirrorPlugins:function(){return[new xe({key:new Me("removePastedFigureEmbed"),props:{transformPastedHTML:function(t){return t=t.replace(/<figure.*class=.embed.*[\n]*.*?<\/figure>/g,"")}}})]}}),Ne=k.Node.create({name:"figureImage",group:"block",content:"inline*",draggable:!0,isolating:!0,addAttributes:function(){return{class:{default:null,parseHTML:function(t){return t.getAttribute("class")}},src:{default:null,parseHTML:function(t){var e;return null===(e=t.querySelector("img"))||void 0===e?void 0:e.getAttribute("src")}}}},parseHTML:function(){return[{tag:'figure[class="image"]',contentElement:"figcaption"}]},renderHTML:function(t){return["figure",{class:"image"},["img",{src:t.HTMLAttributes.src,draggable:!1,contenteditable:!1}],["figcaption",0]]},addCommands:function(){var t=this;return{setFigureImage:function(e){var n=e.caption,r=B(e,["caption"]);return function(e){return(0,e.chain)().insertContent({type:t.name,attrs:r,content:n?[{type:"text",text:n}]:[]}).command((function(t){var e=t.tr,n=t.commands,r=e.doc,i=e.selection,s=r.resolve(i.to-2).end();return n.setTextSelection(s)})).run()}}}},addProseMirrorPlugins:function(){return[new xe({key:new Me("removePastedFigureImage"),props:{transformPastedHTML:function(t){return t=t.replace(/<figure.*class=.image.*[\n]*.*?<\/figure>/g,"")}}})]}});var Ae=k.Mark.create({name:"link",keepOnSplit:!1,onCreate:function(){this.options.protocols.forEach((function(t){"string"!=typeof t?F.registerCustomProtocol(t.scheme,t.optionalSlashes):F.registerCustomProtocol(t)}))},onDestroy:function(){F.reset()},inclusive:function(){return this.options.autolink},addOptions:function(){return{openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},validate:void 0}},addAttributes:function(){return{href:{default:null},target:{default:this.options.HTMLAttributes.target},class:{default:this.options.HTMLAttributes.class}}},parseHTML:function(){return[{tag:'a[href]:not([href *= "javascript:" i]):not([class="mention"])'}]},renderHTML:function(t){var e=t.HTMLAttributes;return["a",k.mergeAttributes(this.options.HTMLAttributes,e),0]},addCommands:function(){var t=this;return{setLink:function(e){return function(n){return(0,n.chain)().setMark(t.name,e).setMeta("preventAutolink",!0).run()}},toggleLink:function(e){return function(n){return(0,n.chain)().toggleMark(t.name,e,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},unsetLink:function(){return function(e){return(0,e.chain)().unsetMark(t.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}}}},addPasteRules:function(){var t=this;return[k.markPasteRule({find:function(e){return F.find(e).filter((function(e){return!t.options.validate||t.options.validate(e.value)})).filter((function(t){return t.isLink})).map((function(t){return{text:t.value,index:t.start,data:t}}))},type:this.type,getAttributes:function(t){var e;return{href:null===(e=t.data)||void 0===e?void 0:e.href}}})]},addProseMirrorPlugins:function(){var t,e=[];return this.options.autolink&&e.push((t={type:this.type,validate:this.options.validate},new xe({key:new Me("autolink"),appendTransaction:function(e,n,r){var i=e.some((function(t){return t.docChanged}))&&!n.doc.eq(r.doc),s=e.some((function(t){return t.getMeta("preventAutolink")}));if(i&&!s){var o=r.tr,a=k.combineTransactionSteps(n.doc,H([],e,!0)),l=a.mapping;if(k.getChangedRanges(a).forEach((function(e){var i=e.oldRange,s=e.newRange;k.getMarksBetween(i.from,i.to,n.doc).filter((function(e){return e.mark.type===t.type})).forEach((function(e){var i=l.map(e.from),s=l.map(e.to),a=k.getMarksBetween(i,s,r.doc).filter((function(e){return e.mark.type===t.type}));if(a.length){var h=a[0],c=n.doc.textBetween(e.from,e.to,void 0," "),u=r.doc.textBetween(h.from,h.to,void 0," "),p=F.test(c),d=F.test(u);p&&!d&&o.removeMark(h.from,h.to,t.type)}}));var a,h,c=k.findChildrenInRange(r.doc,s,(function(t){return t.isTextblock}));if(c.length>1?(a=c[0],h=r.doc.textBetween(a.pos,a.pos+a.node.nodeSize,void 0," ")):c.length&&r.doc.textBetween(s.from,s.to," "," ").endsWith(" ")&&(a=c[0],h=r.doc.textBetween(a.pos,s.to,void 0," ")),a&&h){var u=h.split(" ").filter((function(t){return""!==t}));if(u.length<=0)return!1;var p=u[u.length-1],d=a.pos+h.lastIndexOf(p);if(!p)return!1;F.find(p).filter((function(t){return t.isLink})).filter((function(e){return!t.validate||t.validate(e.value)})).map((function(t){return q(q({},t),{from:d+t.start+1,to:d+t.end+1})})).forEach((function(e){o.addMark(e.from,e.to,t.type.create({href:e.href}))}))}})),o.steps.length)return o}}}))),this.options.openOnClick&&e.push(function(t){return new xe({key:new Me("handleClickLink"),props:{handleClick:function(e,n,r){var i,s,o;if(1!==r.button)return!1;var a=k.getAttributes(e.state,t.type.name),l=null===(i=r.target)||void 0===i?void 0:i.closest("a"),h=null!==(s=null==l?void 0:l.href)&&void 0!==s?s:a.href,c=null!==(o=null==l?void 0:l.target)&&void 0!==o?o:a.target;return!(!l||!h||(window.open(h,c),0))}}})}({type:this.type})),this.options.linkOnPaste&&e.push(function(t){return new xe({key:new Me("handlePasteLink"),props:{handlePaste:function(e,n,r){if(e.state.selection.empty)return!1;var i="";r.content.forEach((function(t){i+=t.textContent}));var s=F.find(i).find((function(t){return t.isLink&&t.value===i}));return!(!i||!s||(t.editor.commands.setMark(t.type,{href:s.href}),0))}}})}({editor:this.editor,type:this.type})),e}}),Ce=new Me("mention"),Ee=k.Node.create({name:"mention",group:"inline",inline:!0,selectable:!1,atom:!0,addOptions:function(){var t=this;return{suggestion:{char:"@",allowedPrefixes:null,pluginKey:Ce,command:function(e){var n,r,i,s=e.editor,o=e.range,a=e.props,l=s.view.state.selection,h=l.$from,c=l.$to,u=1===h.parentOffset,p=c.nodeBefore,d=c.nodeAfter,f=null===(n=null==p?void 0:p.text)||void 0===n?void 0:n.startsWith(" "),m=null===(r=null==d?void 0:d.text)||void 0===r?void 0:r.startsWith(" "),g=[];u||f||g.push({type:"text",text:" "}),g.push({type:t.name,attrs:a}),m||g.push({type:"text",text:" "}),s.chain().focus().insertContentAt(o,g).run(),null===(i=window.getSelection())||void 0===i||i.collapseToEnd()},allow:function(e){var n=e.state,r=e.range,i=n.doc.resolve(r.from),s=n.schema.nodes[t.name];return!!i.parent.type.contentMatch.matchType(s)}}}},addAttributes:function(){return{id:{default:null,parseHTML:function(t){return t.getAttribute("data-id")}},userName:{default:null,parseHTML:function(t){return t.getAttribute("data-user-name")}},displayName:{default:null,parseHTML:function(t){return t.getAttribute("data-display-name")}}}},parseHTML:function(){return[{tag:'a[class="mention"]'}]},renderHTML:function(t){var e,n=t.node;return["a",{class:"mention",href:"/"+this.options.suggestion.char+n.attrs.userName,"data-id":n.attrs.id,"data-user-name":n.attrs.userName,"data-display-name":n.attrs.displayName,ref:"noopener noreferrer nofollow"},["span","@".concat(null!==(e=n.attrs.displayName)&&void 0!==e?e:n.attrs.userName)]]},addKeyboardShortcuts:function(){var t=this;return{Backspace:function(){return t.editor.commands.command((function(e){var n=e.tr,r=e.state,i=!1,s=r.selection,o=s.empty,a=s.anchor;return!!o&&(r.doc.nodesBetween(a-1,a,(function(e,r){if(e.type.name===t.name)return i=!0,n.insertText(t.options.suggestion.char||"",r,r+e.nodeSize),!1})),i)}))}}},addProseMirrorPlugins:function(){return[L(q({editor:this.editor},this.options.suggestion))]}}),Ie=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))$/,ze=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))/g,Re=/(?:^|\s)((?:_)((?:[^_]+))(?:_))$/,Je=/(?:^|\s)((?:_)((?:[^_]+))(?:_))/g,Pe=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))$/,Fe=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))/g,Le=/(?:^|\s)((?:__)((?:[^__]+))(?:__))$/,qe=/(?:^|\s)((?:__)((?:[^__]+))(?:__))/g,Be=k.Mark.create({name:"bold",addOptions:function(){return{HTMLAttributes:{}}},parseHTML:function(){return[{tag:"strong"},{tag:"b",getAttrs:function(t){return"normal"!==t.style.fontWeight&&null}},{style:"font-weight",getAttrs:function(t){return/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}},{tag:"em"},{tag:"i",getAttrs:function(t){return"normal"!==t.style.fontStyle&&null}},{style:"font-style=italic"},{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:function(t){return!!t.includes("underline")&&{}}}]},renderHTML:function(t){var e=t.HTMLAttributes;return["strong",k.mergeAttributes(this.options.HTMLAttributes,e),0]},addCommands:function(){var t=this;return{setBold:function(){return function(e){return e.commands.setMark(t.name)}},toggleBold:function(){return function(e){return e.commands.toggleMark(t.name)}},unsetBold:function(){return function(e){return e.commands.unsetMark(t.name)}}}},addKeyboardShortcuts:function(){var t=this;return{"Mod-b":function(){return t.editor.commands.toggleBold()},"Mod-B":function(){return t.editor.commands.toggleBold()},"Mod-i":function(){return t.editor.commands.toggleBold()},"Mod-I":function(){return t.editor.commands.toggleBold()},"Mod-u":function(){return t.editor.commands.toggleBold()},"Mod-U":function(){return t.editor.commands.toggleBold()}}},addInputRules:function(){return[k.markInputRule({find:Pe,type:this.type}),k.markInputRule({find:Le,type:this.type}),k.markInputRule({find:Ie,type:this.type}),k.markInputRule({find:Re,type:this.type})]},addPasteRules:function(){return[k.markPasteRule({find:Fe,type:this.type}),k.markPasteRule({find:qe,type:this.type}),k.markPasteRule({find:ze,type:this.type}),k.markPasteRule({find:Je,type:this.type})]}}),$e=function(t){var e=k.getSchema(t);return function(t){var n=w.parseHTML(t),r=Tt.fromSchema(e).parse(n).toJSON(),i=Mt.fromJSON(e,r);return qt.fromSchema(e).serializeFragment(i.content,{document:w.createHTMLDocument()}).render()}};exports.html2md=function(t){return $(void 0,void 0,void 0,(function(){var e;return D(this,(function(n){switch(n.label){case 0:return[4,G.process(t)];case 1:return e=n.sent(),[2,String(e)]}}))}))},exports.makeNormalizer=$e,exports.md2html=function(t){return $(void 0,void 0,void 0,(function(){var e;return D(this,(function(n){switch(n.label){case 0:return[4,Q.process(t)];case 1:return e=n.sent(),[2,String(e)]}}))}))},exports.normalizeArticleHTML=function(t){var e,n,r,i=(n=(e={}).placeholder,r=e.mentionSuggestion,[M,A,T,R.configure({placeholder:n}),P,z,N.configure({levels:[2,3]}),Be,J,S,b,v,O,C,I,E,x,Ae,Ne,Te,Oe,Ee.configure({suggestion:r})]);return $e(i)(t)},exports.normalizeCommentHTML=function(t){var e,n,r,i=(n=(e={}).placeholder,r=e.mentionSuggestion,[M,A,R.configure({placeholder:n}),P,z,Be,J,S,b,v,O,C,E,I,x,Ae,Ee.configure({suggestion:r})]);return $e(i)(t)},exports.sanitizeHTML=function(t){return $(void 0,void 0,void 0,(function(){var e;return D(this,(function(n){switch(n.label){case 0:return[4,X.process(t)];case 1:return e=n.sent(),[2,String(e)]}}))}))};
//# sourceMappingURL=index.cjs.map
